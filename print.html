<!DOCTYPE HTML>
<html lang="ja" class="sidebar-visible no-js latte">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Commentary of Dotfiles</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="このサイトでは、わたしが普段使っている WezTerm と Neovim の設定例 (dotfiles) を紹介しています🤗 - This site introduces WezTerm and Neovim dotfiles that I usually use.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./theme/catppuccin.css">
        <link rel="stylesheet" href="./theme/catppuccin-highlight.css">
        <link rel="stylesheet" href="./mdbook-admonish.css">
        <link rel="stylesheet" href="./override.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "macchiato" : "latte";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('latte')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">WezTerm</li><li class="chapter-item expanded "><a href="wezterm/installation.html"><strong aria-hidden="true">2.</strong> installation</a></li><li class="chapter-item expanded "><a href="wezterm/configuration.html"><strong aria-hidden="true">3.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="wezterm/window.html"><strong aria-hidden="true">3.1.</strong> Window</a></li><li class="chapter-item expanded "><a href="wezterm/shell.html"><strong aria-hidden="true">3.2.</strong> Shell Prompt</a></li><li class="chapter-item expanded "><a href="wezterm/font.html"><strong aria-hidden="true">3.3.</strong> Font</a></li><li class="chapter-item expanded "><a href="wezterm/frame.html"><strong aria-hidden="true">3.4.</strong> Window Frame</a></li><li class="chapter-item expanded "><a href="wezterm/keybind.html"><strong aria-hidden="true">3.5.</strong> Key Binding</a></li><li class="chapter-item expanded "><a href="wezterm/leader.html"><strong aria-hidden="true">3.6.</strong> Leader Key</a></li></ol></li><li class="chapter-item expanded "><a href="wezterm/format.html"><strong aria-hidden="true">4.</strong> Format</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="wezterm/window-title.html"><strong aria-hidden="true">4.1.</strong> Window Title</a></li><li class="chapter-item expanded "><a href="wezterm/tab.html"><strong aria-hidden="true">4.2.</strong> Tab</a></li></ol></li><li class="chapter-item expanded "><a href="wezterm/status.html"><strong aria-hidden="true">5.</strong> Status Bar</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="wezterm/left-status.html"><strong aria-hidden="true">5.1.</strong> Left Status</a></li><li class="chapter-item expanded "><a href="wezterm/right-status.html"><strong aria-hidden="true">5.2.</strong> Right Status</a></li></ol></li><li class="chapter-item expanded "><a href="wezterm/custom.html"><strong aria-hidden="true">6.</strong> Custom Event</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="wezterm/toggle-font.html"><strong aria-hidden="true">6.1.</strong> Toggle Font</a></li><li class="chapter-item expanded "><a href="wezterm/dpi-detection.html"><strong aria-hidden="true">6.2.</strong> DPI Detection</a></li><li class="chapter-item expanded "><a href="wezterm/window-decorations.html"><strong aria-hidden="true">6.3.</strong> Window Decorations</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Neovim</li><li class="chapter-item expanded "><a href="neovim/installation.html"><strong aria-hidden="true">7.</strong> installation</a></li><li class="chapter-item expanded "><a href="neovim/user-config.html"><strong aria-hidden="true">8.</strong> User Config</a></li><li class="chapter-item expanded "><a href="neovim/lua-module.html"><strong aria-hidden="true">9.</strong> Lua Module</a></li><li class="chapter-item expanded "><a href="neovim/options/options.html"><strong aria-hidden="true">10.</strong> Options</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="neovim/options/nvim_set_option.html"><strong aria-hidden="true">10.1.</strong> nvim_set_option</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="neovim/options/termguicolors.html"><strong aria-hidden="true">10.1.1.</strong> termguicolors</a></li><li class="chapter-item expanded "><a href="neovim/options/scrolloff.html"><strong aria-hidden="true">10.1.2.</strong> scrolloff</a></li><li class="chapter-item expanded "><a href="neovim/options/ignorecase-smartcase.html"><strong aria-hidden="true">10.1.3.</strong> ignorecase / smartcase</a></li><li class="chapter-item expanded "><a href="neovim/options/inccommand.html"><strong aria-hidden="true">10.1.4.</strong> inccommand</a></li><li class="chapter-item expanded "><a href="neovim/options/clipboard.html"><strong aria-hidden="true">10.1.5.</strong> clipboard</a></li></ol></li><li class="chapter-item expanded "><a href="neovim/options/nvim_win_set_option.html"><strong aria-hidden="true">10.2.</strong> nvim_win_set_option</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="neovim/options/number.html"><strong aria-hidden="true">10.2.1.</strong> number</a></li><li class="chapter-item expanded "><a href="neovim/options/cursorline.html"><strong aria-hidden="true">10.2.2.</strong> cusrorline</a></li><li class="chapter-item expanded "><a href="neovim/options/signcolumn.html"><strong aria-hidden="true">10.2.3.</strong> signcolumn</a></li><li class="chapter-item expanded "><a href="neovim/options/wrap-colorcolumn.html"><strong aria-hidden="true">10.2.4.</strong> wrap / colorcolumn</a></li></ol></li><li class="chapter-item expanded "><a href="neovim/options/nvim_buf_set_option.html"><strong aria-hidden="true">10.3.</strong> nvim_buf_set_option</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="neovim/options/tab.html"><strong aria-hidden="true">10.3.1.</strong> tabstop / shiftwidth / expandtab</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="neovim/au/automatic-commands.html"><strong aria-hidden="true">11.</strong> Automatic Command</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="neovim/au/nvim_create_autocmd.html"><strong aria-hidden="true">11.1.</strong> nvim_create_autocmd</a></li><li class="chapter-item expanded "><a href="neovim/au/nvim_create_augroup.html"><strong aria-hidden="true">11.2.</strong> nvim_create_augroup</a></li></ol></li><li class="chapter-item expanded "><a href="neovim/keybind.html"><strong aria-hidden="true">12.</strong> Key Binding</a></li><li class="chapter-item expanded "><a href="neovim/leader.html"><strong aria-hidden="true">13.</strong> Leader Key</a></li><li class="chapter-item expanded affix "><li class="part-title">...To Be Continued</li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <!--
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        -->
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frappé</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Commentary of Dotfiles</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/CoralPink/commentary" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>このサイトでは、わたしが普段使っている<code>WezTerm</code>と<code>Neovim</code>の設定例 (<code>dotfiles</code>) を紹介しています🤗</p>
<p>全ての設定を網羅しているわけではなく、あくまで自分で使っている設定に対してのコメントです。</p>
<p>もしこれが、見てくれた人のヒントになったり、何かの役に立ったりしたら嬉しいです😌</p>
<div id="admonition-default" class="admonition success">
<div>
<p><img src="goal.png" alt="goal.png" /></p>
<div style="text-align: right;font-style: italic;" >
    Screenshot of wezterm on macOS, running Neovim and etc...
</div>
</div>
</div>
<div id="admonition-default-1" class="admonition info">
<div>
<p>This site introduces <code>WezTerm</code> and <code>Neovim</code> <code>dotfiles</code> that I usually use.</p>
<p>But Japanese only for now. I want to make an English site too❗</p>
</div>
</div>
<div id="admonition-このサイトが想定している読者" class="admonition note">
<div class="admonition-title">
<p>このサイトが想定している読者</p>
<p><a class="admonition-anchor-link" href="introduction.html#admonition-このサイトが想定している読者"></a></p>
</div>
<div>
<p><code>WezTerm</code>セクションでは、目安として<code>Homebrew</code>などのパッケージマネージャーをコマンドで扱える程度を想定しています。
(ファイル操作から一歩踏み出せてるイメージ☺️)</p>
<p>ターミナルコマンドを使う場面は限られていますし、例示も全て行っているつもりではありますが、
コマンド操作を行ったことがないと、どうしても不安が残ります😓</p>
<p>その代わり、ファイルの編集自体は<code>Xcode</code>や<code>Visual Studio Code</code>などのGUIアプリケーションでも構いません。
これについては<code>3.Configuration</code>で示します。</p>
</div>
</div>
<div id="admonition-default-2" class="admonition note">
<div>
<p><code>Neovim</code>セクションでは、一転して<code>Neovim</code>自身でのファイル編集を前提としています。</p>
<p>全く初めてだと大変かもしれませんが、もし少しでも興味があったらチャレンジしてもらえると楽しめると思います☺️</p>
</div>
</div>
<h2 id="使用環境"><a class="header" href="#使用環境">使用環境</a></h2>
<p>わたしの使用する環境が<code>macOS</code>なので、説明やイメージも主にこれを使用しています。</p>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="introduction.html#admonition-warning"></a></p>
</div>
<div>
<p>必要なソフトウェアと設定さえ整っていれば、どのOSでも通用するはずですが、
100%自信を持っているわけではありません。その点はご了承ください。</p>
</div>
</div>
<h2 id="thanks"><a class="header" href="#thanks">Thanks</a></h2>
<p><strong>Thanks to application developers!! I enjoy using it💓</strong></p>
<div id="admonition-default-3" class="admonition info">
<div>
<p><a href="https://wezfurlong.org/wezterm/">WezTerm - Wez's Terminal Emulator</a></p>
<p><a href="https://neovim.io">Neovim - hyperextensible Vim-based text editor</a></p>
<p><a href="https://starship.rs">starship - cross-shell prompt</a></p>
</div>
</div>
<p><strong>And thanks to the developers of the applications used to create this website🤗</strong></p>
<div id="admonition-default-4" class="admonition info">
<div>
<p><a href="https://rust-lang.github.io/mdBook/">mdBook</a></p>
<p><a href="https://github.com/catppuccin/mdbook">Catppuccin for mdBook</a></p>
<p><a href="https://github.com/tommilligan/mdbook-admonish">mdbook-admonish</a></p>
<p><a href="https://www.deepl.com/translator">DeepL</a></p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>まずは<code>WezTerm</code>です。</p>
<p>インストールは<code>homebrew</code>などのパッケージ管理システムや、ホームページ上で提供されている実行ファイルをダウンロードする方法があります。</p>
<div id="admonition-install---wezs-terminal-emulatorhttpswezfurlongorgwezterminstallationhtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/installation.html">Install - Wez's Terminal Emulator</a></p>
<p><a class="admonition-anchor-link" href="wezterm/installation.html#admonition-install---wezs-terminal-emulatorhttpswezfurlongorgwezterminstallationhtml"></a></p>
</div>
<div>
<p>WezTerm is available pre-built for the major platforms and, because it is open source, you may also build it for yourself.</p>
<p>WezTermは主要なプラットフォーム用にあらかじめビルドされていますが、オープンソースであるため、自分でビルドすることも可能です。</p>
</div>
</div>
<p>環境に合わせて、好きな方法でインストールしてください😃</p>
<p>では、起動してみましょう。(ユーザー名だけちょっと雑に隠しますが気にしないでください。)</p>
<p><img src="wezterm/img/initial.png" alt="initial.heic" /></p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/installation.html#admonition-success"></a></p>
</div>
<div>
<p>動きましたね。
まだまだ味気ないですが、設定を重ねていくと面白みが増してきます。</p>
<p>少し補足すると、上のスクリーンショットは<code>WezTerm</code>上で<code>zsh</code>が動いている状態です。
シェルの設定なども含め、まだ何もいじっていない状態であればこんな感じになると思います<sup class="footnote-reference"><a href="#unix">1</a></sup>。</p>
<p>では、次から<code>WezTerm</code>の設定を行なっていきましょう。</p>
</div>
</div>
<div class="footnote-definition" id="unix"><sup class="footnote-definition-label">1</sup>
<p>Unix だと<code>bash</code>が動いているでしょうか。</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>特に難しいことを考えずに ホームフォルダに <code>.wezterm.lua</code> を置いても良いのですが、
後々ファイルを複数配置していきたくなるので、<code>$HOME/.config/wezterm</code>というディレクトリを作って、
そこに <code>wezterm.lua</code> を置くほうがおすすめです😊</p>
<p>以下のようにしてみましょう。</p>
<div id="admonition-homeconfigweztermweztermlua" class="admonition example">
<div class="admonition-title">
<p>$HOME/.config/wezterm/wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/configuration.html#admonition-homeconfigweztermweztermlua"></a></p>
</div>
<div>
<pre><code class="language-lua">return {

}
</code></pre>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/configuration.html#admonition-success"></a></p>
</div>
<div>
<p>最初はこんなものですね。できたら次のページへ進みましょう❗</p>
</div>
</div>
<p>もし手順が必要なら下で解説していきます😄</p>
<h2 id="手順"><a class="header" href="#手順">手順</a></h2>
<p>以下のコマンドを順に実行してください。</p>
<div id="admonition-ディレクトリを作る" class="admonition quote">
<div class="admonition-title">
<p>ディレクトリを作る</p>
<p><a class="admonition-anchor-link" href="wezterm/configuration.html#admonition-ディレクトリを作る"></a></p>
</div>
<div>
<pre><code class="language-sh">mkdir -p ~/.config/wezterm
</code></pre>
</div>
</div>
<div id="admonition-テキストを編集する以下の例ではvimを使用" class="admonition quote">
<div class="admonition-title">
<p>テキストを編集する(以下の例では<code>vim</code>を使用)</p>
<p><a class="admonition-anchor-link" href="wezterm/configuration.html#admonition-テキストを編集する以下の例ではvimを使用"></a></p>
</div>
<div>
<pre><code class="language-sh">vim ~/.config/wezterm/wezterm.lua
</code></pre>
</div>
</div>
<div id="admonition-gui-のエディタを使う場合" class="admonition note">
<div class="admonition-title">
<p>GUI のエディタを使う場合</p>
<p><a class="admonition-anchor-link" href="wezterm/configuration.html#admonition-gui-のエディタを使う場合"></a></p>
</div>
<div>
<p>GUI のエディタを使用したい場合は以下で出来ます。</p>
<p>ファイルを作る:</p>
<pre><code class="language-sh">touch ~/.config/wezterm/wezterm.lua
</code></pre>
<p>ファイルを開く:</p>
<pre><code>open ~/.config/wezterm/wezterm.lua
</code></pre>
<p>これで<code>lua</code>ファイルに関連付けられたアプリケーションが起動するはずです。</p>
<p>もし、こんなのが出てきたら</p>
<p><img src="wezterm/img/no-app.png" alt="no-app.png" /></p>
<p><code>アプリケーションを選択...</code>から普段使っているエディタを選びましょう。</p>
<p><code>Xcode</code>や<code>Visual Studio Code</code>などでもいけるはずです。
<img src="wezterm/img/select-app.png" alt="select-app.png" /></p>
</div>
</div>
<div id="admonition-success-1" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/configuration.html#admonition-success-1"></a></p>
</div>
<div>
<p>できましたね❗ それでは次のページへ進みましょう😊</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="window"><a class="header" href="#window">Window</a></h1>
<p>ここではウィンドウの設定を行なっていきます。</p>
<h2 id="color-schemes"><a class="header" href="#color-schemes">Color Schemes</a></h2>
<p>Wezterm では数多くのカラースキームを内蔵しているため、簡単に設定が可能です。</p>
<p>以下から好きなカラースキームを選んで指定します。</p>
<div id="admonition-color-schemeshttpswezfurlongorgweztermcolorschemesindexhtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/colorschemes/index.html">Color Schemes</a></p>
<p><a class="admonition-anchor-link" href="wezterm/window.html#admonition-color-schemeshttpswezfurlongorgweztermcolorschemesindexhtml"></a></p>
</div>
<div>
<p>735 Color schemes listed by first letter</p>
<p>735<sup class="footnote-reference"><a href="#a">1</a></sup>種類のカラースキーム一覧</p>
</div>
</div>
<p>お気に入りのカラースキームは見つかりましたか？</p>
<p>わたしは<code>Catppuccin Mocha</code>を愛用しているので、以下のようになりました🥰</p>
<div id="admonition-weztermlua" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/window.html#admonition-weztermlua"></a></p>
</div>
<div>
<pre><code class="language-lua">color_scheme = 'Catppuccin Mocha',
</code></pre>
</div>
</div>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/window.html#admonition-note"></a></p>
</div>
<div>
<p>ちなみに、このWebページのカラースキームも<code>Catppuccin</code>を使ってたりします。</p>
<p>セルフサービスなので、左上のブラシアイコンからお好みで淹れて<sup class="footnote-reference"><a href="#a">1</a></sup>みてください😄</p>
</div>
</div>
<h2 id="window_background_opacity"><a class="header" href="#window_background_opacity">window_background_opacity</a></h2>
<div id="admonition-colors--appearance---wezs-terminal-emulatorhttpswezfurlongorgweztermconfigappearancehtmlwindow-background-opacity" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/appearance.html#window-background-opacity">Colors &amp; Appearance - Wez's Terminal Emulator</a></p>
<p><a class="admonition-anchor-link" href="wezterm/window.html#admonition-colors--appearance---wezs-terminal-emulatorhttpswezfurlongorgweztermconfigappearancehtmlwindow-background-opacity"></a></p>
</div>
<div>
<p>If your Operating System provides Compositing support then WezTerm is able to specify the alpha channel value for the background content</p>
<p>オペレーティングシステムがコンポジットをサポートしている場合、WezTerm は背景コンテンツのアルファチャンネル値を指定することができます。</p>
</div>
</div>
アルファチャンネル値には 0.0 から 1.0 までの値を用います。
<p>透過値はお好みで。わたしはこんな感じで。</p>
<div id="admonition-weztermlua-1" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/window.html#admonition-weztermlua-1"></a></p>
</div>
<div>
<pre><code class="language-lua">window_background_opacity = 0.93,
</code></pre>
</div>
</div>
<h2 id="一旦確認"><a class="header" href="#一旦確認">一旦確認…</a></h2>
<p>さて、ここまでで<code>wezterm.lua</code>は以下のようになりました。</p>
<div id="admonition-weztermlua-2" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/window.html#admonition-weztermlua-2"></a></p>
</div>
<div>
<pre><code class="language-lua">return {
	color_scheme = &quot;Catppuccin Mocha&quot;,
	window_background_opacity = 0.93,
}
</code></pre>
</div>
</div>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="wezterm/window.html#admonition-warning"></a></p>
</div>
<div>
<p>ここまでの書き方が解りにくかったらごめんなさい...😢</p>
<p>wezterm.lua に記述する場合、基本的には return {} の中に記述していきます。</p>
</div>
</div>
<p><img src="wezterm/img/opacity.png" alt="opacity.png" /></p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/window.html#admonition-success"></a></p>
</div>
<div>
<p>カラースキームについては、白文字しかない状態だと「ちょっと何言ってるかわかんない」ですが、透過は確認できましたね😄</p>
<p>次は、せっかく設定したカラースキームを見たいので、少し脇に逸れてプロンプトを変えてみましょう。</p>
</div>
</div>
<div class="footnote-definition" id="a"><sup class="footnote-definition-label">1</sup>
<p>誤字じゃないです。<a href="https://ja.wikipedia.org/wiki/%E3%82%AB%E3%83%97%E3%83%81%E3%83%BC%E3%83%8E">カプチーノ</a>なので❗</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="shell-prompt"><a class="header" href="#shell-prompt">Shell Prompt</a></h1>
<p><code>WezTerm</code>の設定からは少し逸れますが、先にシェルプロンプトのカスタマイズをやってしまいましょう。</p>
<h2 id="starship"><a class="header" href="#starship">Starship</a></h2>
<p>技術系サイトを見ていると、こぞって紹介されている感のある<code>StarShip</code>です。</p>
<p>まあ、これは紹介したくなりますよね〜。導入が簡単なのに綺麗だし🥴</p>
<div id="admonition-starship-cross-shell-prompthttpsstarshiprs" class="admonition info">
<div class="admonition-title">
<p><a href="https://starship.rs/">StarShip Cross-Shell Prompt</a></p>
<p><a class="admonition-anchor-link" href="wezterm/shell.html#admonition-starship-cross-shell-prompthttpsstarshiprs"></a></p>
</div>
<div>
<p>The minimal, blazing-fast, and infinitely customizable prompt for any shell!</p>
<p>あらゆるシェルのための、最小限の、高速な、そして無限にカスタマイズ可能なプロンプト!</p>
</div>
</div>
ページ内の Get Started からインストール方法が確認できます。
<p>覗いてみると</p>
<pre><code>Prerequisites
- A Nerd Font installed and enabled in your terminal.

前提条件
- Nerd Fontがインストールされ、ターミナルで有効になっていること。
</code></pre>
<p>と書いてありますね。</p>
<p>本来なら「なんかめんどくさそうだな〜」となるところですが...、</p>
<p>なんと❗️<code>WezTerm</code>は<code>Nerd Font</code>を持っていて、しかも既に有効になっています❗️</p>
<div id="admonition-weztermnerdfontshttpswezfurlongorgweztermconfigluaweztermnerdfontshtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/wezterm/nerdfonts.html">wezterm.nerdfonts</a></p>
<p><a class="admonition-anchor-link" href="wezterm/shell.html#admonition-weztermnerdfontshttpswezfurlongorgweztermconfigluaweztermnerdfontshtml"></a></p>
</div>
<div>
<p>WezTerm includes Nerd Font Symbols Font as a default font fallback which means that these
special symbols are available even without requiring you to use a patched font.</p>
<p>WezTerm は Nerd Font Symbols Font をデフォルトのフォントのフォールバックとして含んでいます。
つまり、パッチを当てたフォントを使わなくてもこれらの特殊記号を利用することができます。</p>
</div>
</div>
<p>...とのことなので安心してください。入ってますよ☺️</p>
<p>とは言いつつ、わたしは別のフォントを使っているので<code>3.3 Font</code>で紹介したいな〜と思ってます。</p>
<h2 id="インストール"><a class="header" href="#インストール">インストール</a></h2>
<p>これは<code>Starship</code>の説明通りにやっていけば大丈夫ですね。</p>
<h3 id="step-1"><a class="header" href="#step-1">Step 1.</a></h3>
<p>ターミナルから</p>
<div id="admonition-command" class="admonition quote">
<div class="admonition-title">
<p>Command</p>
<p><a class="admonition-anchor-link" href="wezterm/shell.html#admonition-command"></a></p>
</div>
<div>
<pre><code class="language-sh">curl -sS https://starship.rs/install.sh | sh
</code></pre>
</div>
</div>
<p>と、やってもいいのですが、わたしは<code>Homebrew</code>でやっちゃいます。</p>
<div id="admonition-command-1" class="admonition quote">
<div class="admonition-title">
<p>Command</p>
<p><a class="admonition-anchor-link" href="wezterm/shell.html#admonition-command-1"></a></p>
</div>
<div>
<pre><code class="language-sh">brew install starship
</code></pre>
</div>
</div>
<p>いきなり説明通りから外れましたね！どんまい✨</p>
<h3 id="step-2"><a class="header" href="#step-2">Step 2.</a></h3>
<p><code>zsh</code>を使っている場合は<code>~/.zshrc</code>に以下を追記するだけです。</p>
<div id="admonition-zshrc" class="admonition example">
<div class="admonition-title">
<p>.zshrc</p>
<p><a class="admonition-anchor-link" href="wezterm/shell.html#admonition-zshrc"></a></p>
</div>
<div>
<pre><code class="language-sh">`eval &quot;$(starship init zsh)&quot;`
</code></pre>
</div>
</div>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/shell.html#admonition-note"></a></p>
</div>
<div>
<p>もし無かったら自分で作っちゃっていいやつです。</p>
</div>
</div>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="wezterm/shell.html#admonition-warning"></a></p>
</div>
<div>
<p>繰り返しますが「追記」です。先に記述されているものがあった場合、そのまま前か後ろに追記してください。</p>
</div>
</div>
<h3 id="step-3"><a class="header" href="#step-3">Step 3.</a></h3>
<p>コンフィグファイルについては、また別の機会に。</p>
<p><code>WezTerm</code>を一旦終了して再度起動しましょう。</p>
<p><img src="wezterm/img/starship.png" alt="starship.png" /></p>
<p><code>3.1 Window</code>で設定したカラースキームが適用されているのを確認できましたね。</p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/shell.html#admonition-success"></a></p>
</div>
<div>
<p>月も綺麗ですね💕 (<code>wezterm</code>ディレクトリに行くと手っ取り早く見られます。)</p>
<p>それでは<code>WezTerm</code>のお話に戻りましょう。</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="font"><a class="header" href="#font">Font</a></h1>
<p>これはもう、ほんとに好きなフォントでいいです。</p>
<p>以下に再掲しますが、<code>Starship</code>を使用する場合も<code>WezTerm</code>であれば<code>Nerd Font</code>を考慮する必要がありません😆</p>
<div id="admonition-weztermnerdfontshttpswezfurlongorgweztermconfigluaweztermnerdfontshtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/wezterm/nerdfonts.html">wezterm.nerdfonts</a></p>
<p><a class="admonition-anchor-link" href="wezterm/font.html#admonition-weztermnerdfontshttpswezfurlongorgweztermconfigluaweztermnerdfontshtml"></a></p>
</div>
<div>
<p>WezTerm includes Nerd Font Symbols Font as a default font fallback which means that these
special symbols are available even without requiring you to use a patched font.</p>
<p>WezTerm は Nerd Font Symbols Font をデフォルトのフォントのフォールバックとして含んでおり、
これはパッチされたフォントを使わなくてもこれらの特殊記号が利用可能であることを意味します。</p>
</div>
</div>
<p>ただ、環境にもよるかもしれませんが、デフォルトのままだと日本語がイマイチ...😢</p>
<p><img src="wezterm/img/font-roboto.png" alt="font-roboto.png" /></p>
<p>なんてことがあるので、次項に続くわけです。</p>
<h2 id="プログラミングフォント-firge-ファージ"><a class="header" href="#プログラミングフォント-firge-ファージ">プログラミングフォント Firge (ファージ)</a></h2>
<p>例として、わたしが普段お世話になっているフォントを紹介します。</p>
<div id="admonition-github---yuru7firgehttpsgithubcomyuru7firge" class="admonition info">
<div class="admonition-title">
<p><a href="https://github.com/yuru7/Firge">GitHub - yuru7/Firge</a></p>
<p><a class="admonition-anchor-link" href="wezterm/font.html#admonition-github---yuru7firgehttpsgithubcomyuru7firge"></a></p>
</div>
<div>
<p>Fira Mono と源真ゴシックを合成したプログラミングフォント Firge (ファージ)</p>
</div>
</div>
<p>「ダウンロードはこちら」というリンクから、お言葉に甘えて<code>FirgeNerd_v0.2.0.zip</code>をダウンロードします。ありがとー💕</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/font.html#admonition-note"></a></p>
</div>
<div>
<p><code>Nerd Font</code>いらないって言いながら<code>Nerd</code>とか言ってんの何なの⁉️ ってなっちゃうんですが、なんかごめんなさい。</p>
</div>
</div>
<h2 id="インストール-1"><a class="header" href="#インストール-1">インストール</a></h2>
<p>フォントのインストールは OS の作業になるので、<code>macOS</code>のやり方だけ軽く載せます。</p>
<p>...基本的にはどのOSでも、ダウンロードしてきたファイルを開けば「インストールしますか？」的なの出てきますよね。多分。</p>
<p>やればできる!!</p>
<p><img src="wezterm/img/font1.png" alt="font1.png" />
<img src="wezterm/img/font2.png" alt="font2.png" />
<img src="wezterm/img/font3.png" alt="font3.png" /></p>
<p>ほらできた🤗</p>
<h2 id="wezterm-設定"><a class="header" href="#wezterm-設定">WezTerm 設定</a></h2>
<p>で、このフォントを<code>WezTerm</code>に設定すれば良さそう。</p>
<div id="admonition-weztermlua" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/font.html#admonition-weztermlua"></a></p>
</div>
<div>
<pre><code class="language-lua">font = require(&quot;wezterm&quot;).font(&quot;Firge35Nerd Console&quot;),
</code></pre>
</div>
</div>
<div id="admonition-weztermfonthttpswezfurlongorgweztermconfigluaweztermfonthtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/wezterm/font.html">wezterm.font</a></p>
<p><a class="admonition-anchor-link" href="wezterm/font.html#admonition-weztermfonthttpswezfurlongorgweztermconfigluaweztermfonthtml"></a></p>
</div>
<div>
<p>The first parameter is the name of the font; the name can be one of the following types of names:</p>
<ul>
<li>The font family name, eg: &quot;JetBrains Mono&quot;. The family name doesn't include any style information (such as weight, stretch or italic), which can be specified via the attributes parameter. This is the recommended name to use for the font, as it the most compatible way to resolve an installed font.</li>
<li>The computed full name, which is the family name with the sub-family (which incorporates style information) appended, eg: &quot;JetBrains Mono Regular”.</li>
<li>(Since 20210502-154244-3f7122cb) The postscript name, which is an ostensibly unique name identifying a given font and style that is encoded into the font by the font designer.</li>
</ul>
<p>最初のパラメータはフォントの名前です。この名前は、以下のタイプの名前のいずれかになります。</p>
<ul>
<li>フォントファミリ名、例：&quot;JetBrains Mono 「JetBrains Mono&quot; のようなフォントファミリーの名前です。このファミリー名にはスタイル情報（ウェイト、ストレッチ、イタリックなど）は含まれませんが、これは属性パラメータで指定できます。これは、インストールされているフォントを解決するための最も互換性のある方法であるため、フォントに使用する推奨される名前です。</li>
<li>計算されたフルネームは、ファミリー名にサブファミリー（スタイル情報を含む）を追加したもので、例．例えば、「JetBrains Mono Regular」です。</li>
<li>(20210502-154244-3f7122cb 以降) ポストスクリプト名。これは、フォントデザイナーがフォントにエンコードした、与えられたフォントとスタイルを識別する表向きユニークな名前です。</li>
</ul>
</div>
</div>
<p>わたしは<code>Firge35NerdConsole-Regular.ttf</code>をインストールして、ファミリー名の<code>Firge35Nerd Console</code>で指定しています。</p>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/font.html#admonition-note-1"></a></p>
</div>
<div>
<p>ファミリー名は<code>Font Book</code>アプリケーションで確認できます。「識別子」項目の中ですね。</p>
<p>出ていない場合は「情報を確認する(<code>command + i</code>)」をポチッと。</p>
<p><img src="wezterm/img/font-info.png" alt="font-info.png" /></p>
</div>
</div>
<p>フォントサイズも指定できるので、一緒に入れておきましょう。</p>
<div id="admonition-weztermlua-1" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/font.html#admonition-weztermlua-1"></a></p>
</div>
<div>
<pre><code class="language-lua">font_size = 12.0,
</code></pre>
</div>
</div>
<div id="admonition-font_sizehttpswezfurlongorgweztermconfigluaconfigfont_sizehtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/config/font_size.html">font_size</a></p>
<p><a class="admonition-anchor-link" href="wezterm/font.html#admonition-font_sizehttpswezfurlongorgweztermconfigluaconfigfont_sizehtml"></a></p>
</div>
<div>
<p>Specifies the size of the font, measured in points.</p>
<p>You may use fractional point sizes, such as 13.3, to fine tune the size.</p>
<p>フォントのサイズをポイント数で指定します。</p>
<p>13.3 のような小数点のサイズを使用して、サイズを微調整することができます。</p>
</div>
</div>
<p>上の例はデフォルト値そのままですが、お好みで調整してください。</p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/font.html#admonition-success"></a></p>
</div>
<div>
<p>どうでしょう？明らかに日本語が綺麗になりました❗️</p>
<p><img src="wezterm/img/font-firge.png" alt="font-firge.png" /></p>
<p>やったね🤗</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="window-frame"><a class="header" href="#window-frame">Window Frame</a></h1>
<p>コンソールがいい感じになってきたので、次はウィンドウフレーム周りの設定をしていきましょう。</p>
<div id="admonition-window_frame---wezs-terminal-emulatorhttpswezfurlongorgweztermconfigluaconfigwindow_framehtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/config/window_frame.html">window_frame - Wez's Terminal Emulator</a></p>
<p><a class="admonition-anchor-link" href="wezterm/frame.html#admonition-window_frame---wezs-terminal-emulatorhttpswezfurlongorgweztermconfigluaconfigwindow_framehtml"></a></p>
</div>
<div>
<p>This setting is applicable primarily on Wayland systems when client side decorations are in use.</p>
<p>この設定は、主にクライアント側の装飾が使用されているWaylandシステムで適用されます。</p>
</div>
</div>
とのことなのですが、私はここはデフォルトでいいかなーって思ってるのでほぼ何もしていません。
<p>...いや、一回細かく変えてみたこともあったんですが、最終的にはデフォルトでいいかー😉ってなりました。</p>
<h2 id="font-1"><a class="header" href="#font-1">Font</a></h2>
<p>これもほぼデフォルトのままで、フォントサイズだけ変える程度にしています。</p>
<p>前回やっているフォント設定と同じですね。</p>
<div id="admonition-native-fancy-tab-bar-appearancehttpswezfurlongorgweztermconfigappearancehtmlnative-fancy-tab-bar-appearance" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/appearance.html#native-fancy-tab-bar-appearance">Native (Fancy) Tab Bar appearance</a></p>
<p><a class="admonition-anchor-link" href="wezterm/frame.html#admonition-native-fancy-tab-bar-appearancehttpswezfurlongorgweztermconfigappearancehtmlnative-fancy-tab-bar-appearance"></a></p>
</div>
<div>
<p>The following options affect the fancy tab bar:</p>
<p>次のオプションは、ファンシータブバーに影響します。</p>
</div>
</div>
<div id="admonition-weztermlua" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/frame.html#admonition-weztermlua"></a></p>
</div>
<div>
<pre><code class="language-lua">window_frame = {
  -- デフォルト値のままなので記述しなくても平気ですが、後で変えたくなった時にわかりやすいので。
  font = wezfont 'Roboto',
  -- サイズはだいぶ小さくしちゃってます。
  font_size = 8.0,
},
</code></pre>
</div>
</div>
<h2 id="fancy-or-retro"><a class="header" href="#fancy-or-retro">Fancy or Retro</a></h2>
<p>前項で、突然 &quot;ファンシータブバー&quot; という文言が出てきましたが、<code>WezTerm</code>のタブバーには、ファンシーとレトロの2種類があります。</p>
<div id="admonition-use_fancy_tab_barhttpswezfurlongorgweztermconfigluaconfiguse_fancy_tab_barhtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/config/use_fancy_tab_bar.html">use_fancy_tab_bar</a></p>
<p><a class="admonition-anchor-link" href="wezterm/frame.html#admonition-use_fancy_tab_barhttpswezfurlongorgweztermconfigluaconfiguse_fancy_tab_barhtml"></a></p>
</div>
<div>
<p>When set to true (the default), the tab bar is rendered in a native style with proportional fonts.</p>
<p>true（デフォルト）に設定すると、タブバーはプロポーショナルフォントを使用したネイティブスタイルでレンダリングされます。</p>
<p>When set to false, the tab bar is rendered using a retro aesthetic using the main terminal font.</p>
<p>false に設定すると、タブバーはメインのターミナルフォントを使用したレトロなスタイルで表示されます。</p>
</div>
</div>
<p>わたしはファンシー派かなぁ😆 なので何もしません。</p>
<p>レトロ派の方は以下を記述しましょう。</p>
<div id="admonition-weztermlua-1" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/frame.html#admonition-weztermlua-1"></a></p>
</div>
<div>
<pre><code class="language-lua">use_fancy_tab_bar = false
</code></pre>
</div>
</div>
<p>before:</p>
<p><img src="wezterm/img/window-before.png" alt="before" /></p>
<p>after:</p>
<p><img src="wezterm/img/window-after.png" alt="after" /></p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/frame.html#admonition-success"></a></p>
</div>
<div>
<p>全然中身ありませんでしたね😅 まあ、小休止ってことで。</p>
<p>次はキーバインドを変えてみましょう。</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="key-binding"><a class="header" href="#key-binding">Key Binding</a></h1>
<p>ここはちょっと難しいというか、どこまで<code>WezTerm</code>をメインに持ってくるのかみたいなところがあります。</p>
<p>例えば<code>tmux</code>。</p>
<p><code>WezTerm</code>自体が<code>tmux</code>と同等かそれ以上の機能を持っているので、
<code>WezTerm</code>に対して<code>tmux</code>と同じキーバインドを与えてしまえば、これは不要になるわけです。<sup class="footnote-reference"><a href="#a">1</a></sup></p>
<p>と言ってもわたしがローカルでしか使っていないから大丈夫なだけで、ネットワークを介して使う場合は困る事もあるかもしれませんし、
実際にデフォルトでは徹底的に他のソフトウェアとの衝突を避けています。</p>
<div id="admonition-default-shortcut--key-binding-assignmentshttpswezfurlongorgweztermconfigdefault-keyshtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/default-keys.html">Default Shortcut / Key Binding Assignments</a></p>
<p><a class="admonition-anchor-link" href="wezterm/keybind.html#admonition-default-shortcut--key-binding-assignmentshttpswezfurlongorgweztermconfigdefault-keyshtml"></a></p>
</div>
<div>
<p>The default key assignments are shown in the table.</p>
<p>デフォルトのキー割り当ては、表のとおりです。</p>
</div>
</div>
<h2 id="現在のキーバインド確認"><a class="header" href="#現在のキーバインド確認">現在のキーバインド確認</a></h2>
<p>まずは現在のキーバインドがどうなっているのかを確認します。</p>
<div id="admonition-show-keyshttpswezfurlongorgweztermclishow-keyshtmlwezterm-show-keys" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/cli/show-keys.html#wezterm-show-keys">show-keys</a></p>
<p><a class="admonition-anchor-link" href="wezterm/keybind.html#admonition-show-keyshttpswezfurlongorgweztermclishow-keyshtmlwezterm-show-keys"></a></p>
</div>
<div>
<p>Prints the complete set of key assignments based on your config file.</p>
<p>設定ファイルに基づいたキー割り当ての完全なセットを表示します。</p>
</div>
</div>
<p>実行してみましょう。<code>WezTerm</code>でそのまま<code>wezterm</code>コマンドを使えば良いです。</p>
<div id="admonition-command" class="admonition quote">
<div class="admonition-title">
<p>Command</p>
<p><a class="admonition-anchor-link" href="wezterm/keybind.html#admonition-command"></a></p>
</div>
<div>
<pre><code class="language-sh">wezterm show-keys
</code></pre>
</div>
</div>
<p><img src="wezterm/img/key-now.png" alt="key-now.png" /></p>
<p>そう、これが現在のキーバインドですね。</p>
<h2 id="設定を落とし込む"><a class="header" href="#設定を落とし込む">設定を落とし込む</a></h2>
<p>で、ここで提案なんですが、キーバインドを自分の設定ファイルに落とし込んじゃったらどうかな？と思うわけです。</p>
<p>それをやるにはどうすれば簡単かな〜っていう話になるんですけど、方法はすでにありました。</p>
<div id="admonition-command-1" class="admonition quote">
<div class="admonition-title">
<p>Command</p>
<p><a class="admonition-anchor-link" href="wezterm/keybind.html#admonition-command-1"></a></p>
</div>
<div>
<pre><code class="language-sh">wezterm show-keys --lua
</code></pre>
</div>
</div>
<p><img src="wezterm/img/key-now-lua.png" alt="key-now-lua.png" /></p>
<p>さすがですね☺️ もはやレールは存在していました。これを自分の設定に持っていけば良いだけです。</p>
<p>ということで、<code>keybinds.lua</code>とでもしてここに設定を落とし込みます。</p>
<p>これはもうプロっぽく片付けちゃいましょう。シェル芸というやつです✨</p>
<div id="admonition-command-2" class="admonition quote">
<div class="admonition-title">
<p>Command</p>
<p><a class="admonition-anchor-link" href="wezterm/keybind.html#admonition-command-2"></a></p>
</div>
<div>
<pre><code class="language-sh">wezterm show-keys --lua &gt; keybinds.lua
</code></pre>
</div>
</div>
<p><code>&gt;</code>を使って出力先をファイルにすると、もうこれだけで流し込めちゃうんですね。簡単😆</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/keybind.html#admonition-note"></a></p>
</div>
<div>
<p>あらかじめ<code>keybinds.lua</code>を作成しておく必要もありません😉</p>
</div>
</div>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="wezterm/keybind.html#admonition-warning"></a></p>
</div>
<div>
<p>むしろ同名ファイルが存在している場合は完全に上書きしちゃうみたいなので注意❗</p>
<p>また、上記例のファイル出力先は現在のディレクトリです。</p>
<p><code>~/.config/wezterm</code>に移動するか、出力先を<code>~/.config/wezterm/keybinds.lua</code>に指定してください。</p>
</div>
</div>
<h2 id="読み込み先を切り替える"><a class="header" href="#読み込み先を切り替える">読み込み先を切り替える</a></h2>
<p>ここまでは暗黙的にデフォルト設定が適用されていましたが、これからは自分で作った<code>keybinds.lua</code>を使っていきましょう。</p>
<div id="admonition-weztermlua" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/keybind.html#admonition-weztermlua"></a></p>
</div>
<div>
<pre><code class="language-lua">keys = require(“keybinds”).keys,
</code></pre>
</div>
</div>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/keybind.html#admonition-note-1"></a></p>
</div>
<div>
<p>このサイトではまだ取り扱っていませんが、
<a href="https://wezfurlong.org/wezterm/config/key-tables.html">Key Tables</a>
という機能があって、これを<code>keybinds.lua</code>内でカスタマイズしても、このままでは反映されません。</p>
<p>なのでごめんなさい😱 上のコードだけでは混乱の元になってました😭</p>
<p><code>keybinds.lua</code>内で<code>Key Tables</code>のカスタマイズをする場合、以下のコードも必要になります。</p>
<pre><code class="language-lua">key_tables = require('keybinds').key_tables,
</code></pre>
<p>これで、<code>keybinds.lua</code>内で編集した<code>Key Tables</code>がちゃんと反映されるようになります🥹</p>
</div>
</div>
<p>冒頭のリンクを再掲しますが、一番下にこのようにあります。</p>
<div id="admonition-default-key-assignmentshttpswezfurlongorgweztermconfigdefault-keyshtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/default-keys.html">Default Key Assignments</a></p>
<p><a class="admonition-anchor-link" href="wezterm/keybind.html#admonition-default-key-assignmentshttpswezfurlongorgweztermconfigdefault-keyshtml"></a></p>
</div>
<div>
<p>If you don't want the default assignments to be registered, you can disable all of them with this configuration; if you chose to do this, you must explicitly register every binding.</p>
<p>デフォルトの割り当てを登録したくない場合は、この設定ですべての割り当てを無効にできます。これを選択した場合は、すべてのバインディングを明示的に登録しなければなりません。</p>
</div>
</div>
<p>デフォルト設定は以下で完全に無効化されます。不安に感じるようであればスキップしても大丈夫です。</p>
<div id="admonition-weztermlua-1" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/keybind.html#admonition-weztermlua-1"></a></p>
</div>
<div>
<pre><code class="language-lua">disable_default_key_bindings = true,
</code></pre>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/keybind.html#admonition-success"></a></p>
</div>
<div>
<p>これでキーバインドの移行が完了しました。まあ、まだ中身は同じなんですけどね😅</p>
<p>さて、もう一つのポイントとして leader キーというものがあります。これについてはまた次回。</p>
</div>
</div>
<div class="footnote-definition" id="a"><sup class="footnote-definition-label">1</sup>
<p>実際、わたしも<code>WezTerm</code>を使う前は<code>iTerm2</code>の上で<code>tmux</code>を動かしていました。</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="leader-key"><a class="header" href="#leader-key">Leader Key</a></h1>
<p>さて、前回はキーバインドを落とし込んだわけですが、今回は<code>Leader</code>キーです。</p>
<div id="admonition-key-binding---wezs-terminal-emulatorhttpswezfurlongorgweztermconfigkeyshtmlleader-key" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/keys.html#leader-key">Key Binding - Wez's Terminal Emulator</a></p>
<p><a class="admonition-anchor-link" href="wezterm/leader.html#admonition-key-binding---wezs-terminal-emulatorhttpswezfurlongorgweztermconfigkeyshtmlleader-key"></a></p>
</div>
<div>
<p>A leader key is a a modal modifier key. If leader is specified in the configuration then pressing that key combination will enable a virtual LEADER modifier.</p>
<p>Leaderキーは、モーダルモディファイアキーです。Leaderキーが設定されている場合、そのキーの組み合わせを押すと、仮想的なリーダーモディファイアが有効になります。</p>
</div>
</div>
<p><code>Leader</code>キーという概念は<code>WezTerm</code>特有のものではく、<code>tmux</code>や<code>vim</code>など古参のソフトウェアでも用いられています。</p>
<p>WezTerm でのデフォルトは<code>CTRL-a</code>です。<sup class="footnote-reference"><a href="#other">1</a></sup></p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/leader.html#admonition-note"></a></p>
</div>
<div>
<p><code>CTRL-a</code> という表記は<code>control</code>キーと<code>a</code>キーを同時押しすることを示しています。</p>
</div>
</div>
<p>ということで、わたしはもうそのまま<code>CTRL-a</code>で設定しています。
デフォルトのままでいいやー、って場合は書かなくてもOKです。</p>
<div id="admonition-weztermlua" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/leader.html#admonition-weztermlua"></a></p>
</div>
<div>
<pre><code class="language-lua">leader = { key = 'a', mods = 'CTRL', timeout_milliseconds = 2000 },
</code></pre>
</div>
</div>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/leader.html#admonition-note-1"></a></p>
</div>
<div>
<p><code>timeout_milliseconds</code>のパラメータを変えていますが、これは後で触れます。デフォルトは<code>1000</code>です。</p>
</div>
</div>
<p><code>vim</code>や<code>tmux</code>等を使用する場合は、これとバッティングしていないかチェックしときましょう。</p>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="wezterm/leader.html#admonition-warning"></a></p>
</div>
<div>
<p>macOSでUS配列なのに日本語IME使うような環境<sup class="footnote-reference"><a href="#minority">2</a></sup>では<code>CTRL-Space</code>が入力ソースの切り替えに割り当てられています。
OSのショートカットキー等も含め、あらかじめ確認しておきましょう。</p>
<p>他のと被っちゃうと困っちゃいます。</p>
</div>
</div>
<h2 id="timeout_milliseconds"><a class="header" href="#timeout_milliseconds">timeout_milliseconds</a></h2>
<p>これは前項で挙げたマニュアルの文章を引用しますが、</p>
<div id="admonition-leader-keyhttpswezfurlongorgweztermconfigkeyshtmlleader-key" class="admonition note">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/keys.html#leader-key">Leader Key</a></p>
<p><a class="admonition-anchor-link" href="wezterm/leader.html#admonition-leader-keyhttpswezfurlongorgweztermconfigkeyshtmlleader-key"></a></p>
</div>
<div>
<p><code>LEADER</code> stays active until a keypress is registered (whether it matches a key binding or not),
or until it has been active for the duration specified by <code>timeout_milliseconds</code>, at which point it will automatically cancel itself.</p>
<p>LEADERはキーが登録されるまで（キーバインディングにマッチするかどうかに関わらず）、
あるいはtimeout_millisecondsで指定された時間だけアクティブになり、その時点で自動的にキャンセルされます。</p>
</div>
</div>
<p><code>Leader</code>キーが一回押されたら、とりあえず何か次のキーが押されるか、指定ミリ秒経過するまでは待つよ〜。ってことですね。</p>
<p>例えば、</p>
<div id="admonition-weztermlua-1" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/leader.html#admonition-weztermlua-1"></a></p>
</div>
<div>
<pre><code class="language-lua">{ key = 'u', mods = 'LEADER', action = act.CharSelect },
</code></pre>
</div>
</div>
<p>...と、やる場合、<code>CTRL-a</code> → <code>u</code>と順番にキーを押す必要があるわけですが、
デフォルトでは、<code>CTRL-a</code>から<code>u</code>を押すまでが 1000ミリ秒( = 1秒)以内で完結しないといけないわけです。</p>
<p>1秒を長いと見るか短いと見るかは人それぞれなので、これをお好みに調整できるのが、前項の<code>timeout_milliseconds</code>です。</p>
<h2 id="でもう一回キーバインド"><a class="header" href="#でもう一回キーバインド">で、もう一回キーバインド</a></h2>
<p>さて、皆さんはお気づきだろうか…。</p>
<p>デフォルトのキー設定では<code>Leader</code>キーなんて一切使われていないことに…😱</p>
<p>例えばこれ。</p>
<div id="admonition-default-keybinds" class="admonition quote">
<div class="admonition-title">
<p>Default KeyBinds</p>
<p><a class="admonition-anchor-link" href="wezterm/leader.html#admonition-default-keybinds"></a></p>
</div>
<div>
<pre><code class="language-lua">{ key = '&quot;', mods = 'ALT|CTRL', action = act.SplitVertical{ domain =  'CurrentPaneDomain' } },
{ key = '%', mods = 'ALT|CTRL', action = act.SplitHorizontal{ domain =  'CurrentPaneDomain' } },
</code></pre>
</div>
</div>
<div id="admonition-note-2" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/leader.html#admonition-note-2"></a></p>
</div>
<div>
<p><code>ALT|CTRL</code>は<code>Alt</code>キーと<code>Ctrl</code>キーを同時押しです。</p>
<p>さらに<code>&quot;</code>を押せと言われれば<code>Shift</code>キーを押しながら<code>'</code>です。<sup class="footnote-reference"><a href="#key">3</a></sup></p>
</div>
</div>
…なんか、難しくないですか？
<p>それだったら、下のようにしたほうが楽じゃないですか？</p>
<div id="admonition-keybindslua" class="admonition example">
<div class="admonition-title">
<p>keybinds.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/leader.html#admonition-keybindslua"></a></p>
</div>
<div>
<pre><code class="language-lua">{ key = '&quot;', mods = 'LEADER', action = act.SplitVertical { domain = 'CurrentPaneDomain' } },
{ key = '%', mods = 'LEADER', action = act.SplitHorizontal { domain = 'CurrentPaneDomain' } },
</code></pre>
</div>
</div>
<p><code>tmux</code>と同じキーバインドですね。ペイン操作も<code>WezTerm</code>に一任しちゃいます。</p>
<p><code>tmux</code>使ってないのに同等の機能が実現できちゃうんですよ⁉️？すごくないです?☺️</p>
<p>もしどこかで<code>tmux</code>を使うことがあっても同一操作なので迷わず使えます、たぶん❗</p>
<div id="admonition-note-3" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/leader.html#admonition-note-3"></a></p>
</div>
<div>
<p>さらにタイムリーなことに、<code>Copy Mode</code>の各種<code>jump</code>機能も実装されてました。(9/22時点では<code>nightly build</code>だけです。)</p>
<p><a href="https://github.com/wez/wezterm/commit/8458b2b62d90cbf3326c39ed5a72ef256588ebe3">update docs for new copy-mode functions</a></p>
<p><code>tmux</code>のキーバインドを完全に真似るのであれば、<code>CopyMode</code>に入るキーバインドはこれですね。</p>
<pre><code class="language-lua">  { key = '[', mods = 'LEADER', action = act.ActivateCopyMode },
</code></pre>
<p><code>jump</code>機能はデフォルトのままで<code>tmux</code>と同じキーバインドが割り当てられているようなので、そのままいけます。<sup class="footnote-reference"><a href="#copy-mode">4</a></sup></p>
</div>
</div>
<p>ということで、キーバインドは色々試してみてほしいです。</p>
<div id="admonition-enum-keyassignment---wezs-terminal-emulatorhttpswezfurlongorgweztermconfigluakeyassignmentindexhtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/keyassignment/index.html">enum: KeyAssignment - Wez's Terminal Emulator</a></p>
<p><a class="admonition-anchor-link" href="wezterm/leader.html#admonition-enum-keyassignment---wezs-terminal-emulatorhttpswezfurlongorgweztermconfigluakeyassignmentindexhtml"></a></p>
</div>
<div>
<p>A KeyAssignment represents a pre-defined function that can be applied to control the Window, Tab, Pane state typically when a key or mouse event is triggered.</p>
<p>KeyAssignment は、キーまたはマウス イベントがトリガーされたときに、通常 Window、Tab、Pane の状態を制御するために適用できる事前定義された関数を表します。</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/leader.html#admonition-success"></a></p>
</div>
<div>
<p>キーバインドについてはこのくらいでしょうか。次からは外観を変えていきたいと思います。</p>
</div>
</div>
<div class="footnote-definition" id="other"><sup class="footnote-definition-label">1</sup>
<p>tmux のデフォルトは <code>CTRL-b</code>、vimのデフォルトは<code>\</code>です。
ちょっと遠い位置に置かれていて大変なので、 Leaderキーのカスタマイズは一般的に行われているみたいです。
メジャーなカスタマイズ先は<code>CTRL-a</code>や、<code>CTRL-j</code>、<code>CTRL-,(カンマ)</code>、<code>CTRL-Space</code>あたりでしょうか？</p>
</div>
<div class="footnote-definition" id="minority"><sup class="footnote-definition-label">2</sup>
<p>色んな意味で少数派なんですけどね。わたしもこの環境です。</p>
</div>
<div class="footnote-definition" id="key"><sup class="footnote-definition-label">3</sup>
<p>USキーボードの場合。</p>
</div>
<div class="footnote-definition" id="copy-mode"><sup class="footnote-definition-label">4</sup>
<p><code>3.5 Keybind</code>で「いや、デフォルトのキーバインド無効にしたじゃないかー👿」と思われた方、ごもっともです...。
実は<code>copy-mode</code>のキーバインドには触れていませんでした。ちょっとこの辺、複雑ですよね...。また今度改編します。</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="format"><a class="header" href="#format">Format</a></h1>
<p>次はウィンドウタイトルとタブを飾り付けていこうかなーと思うのですが、
まずは<code>format.lua</code>とでもして、またファイルを作成しましょう。</p>
<div id="admonition-formatlua" class="admonition example">
<div class="admonition-title">
<p>format.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/format.html#admonition-formatlua"></a></p>
</div>
<div>
<pre><code class="language-lua">local wezterm = require 'wezterm'
</code></pre>
</div>
</div>
<p>で、これを<code>wezterm.lua</code>から呼び出します。</p>
<div id="admonition-weztermlua" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/format.html#admonition-weztermlua"></a></p>
</div>
<div>
<pre><code class="language-lua">require 'format'

-- ↓ ここまでで色々と記述してきたところ
return {
  -- 〜
}
</code></pre>
</div>
</div>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="wezterm/format.html#admonition-warning"></a></p>
</div>
<div>
<p>記述する位置は<code>return</code>節の外です。</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/format.html#admonition-success"></a></p>
</div>
<div>
<p>こんなのもう楽勝ですね。次に進みましょう。</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="window-title"><a class="header" href="#window-title">Window Title</a></h1>
<p><code>format.lua</code>に、以下のコードを追記していきましょう。<sup class="footnote-reference"><a href="#a">1</a></sup></p>
<div id="admonition-formatlua" class="admonition example">
<div class="admonition-title">
<p>format.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/window-title.html#admonition-formatlua"></a></p>
</div>
<div>
<pre><code class="language-lua">local wezterm = require 'wezterm'

local function BaseName(s)
  return string.gsub(s, '(.*[/\\])(.*)', '%2')
end

wezterm.on('format-window-title', function(tab)
  return BaseName(tab.active_pane.foreground_process_name)
end)
</code></pre>
</div>
</div>
<p>この節のポイントは<code>wezterm.on(event_name, callback)</code>です。</p>
<div id="admonition-on---wezs-terminal-emulatorhttpswezfurlongorgweztermconfigluaweztermonhtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/wezterm/on.html">on - Wez's Terminal Emulator</a></p>
<p><a class="admonition-anchor-link" href="wezterm/window-title.html#admonition-on---wezs-terminal-emulatorhttpswezfurlongorgweztermconfigluaweztermonhtml"></a></p>
</div>
<div>
<p>wezterm.on causes your specified callback to be called when event_name is emitted. Events can be emitted by wezterm itself, or through code/configuration that you specify.</p>
<p>wezterm.on は、event_name が発生したときに指定したコールバックを呼び出します。イベントは wezterm 自身によって、またはあなたが指定したコード/設定によって発行されます。</p>
</div>
</div>
<p>この例で言うと、<code>format-window-title</code>という名前のイベントが発生したら、ここで定義した<code>functtion</code>が呼ばれるという動作をします。</p>
<div id="admonition-format-window-title---wezs-terminal-emulatorhttpswezfurlongorgweztermconfigluawindow-eventsformat-window-titlehtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/window-events/format-window-title.html">format-window-title - Wez's Terminal Emulator</a></p>
<p><a class="admonition-anchor-link" href="wezterm/window-title.html#admonition-format-window-title---wezs-terminal-emulatorhttpswezfurlongorgweztermconfigluawindow-eventsformat-window-titlehtml"></a></p>
</div>
<div>
<p>The format-window-title event is emitted when the text for the window title needs to be recomputed.</p>
<p><code>format-window-title</code>イベントはウィンドウタイトルのテキストを再計算する必要がある場合に発行されます。</p>
</div>
</div>
<p>再計算と言うよりは再描画というニュアンスに近いでしょうか。</p>
<p>要するにこのイベントが発生した際にウィンドウタイトルとして表示するテキストを指定します。抜粋すると以下の部分ですね。</p>
<pre><code class="language-lua">function(tab)
  return BaseName(tab.active_pane.foreground_process_name)
end
</code></pre>
<p>無名関数というやつです。
これが<code>BaseName</code>関数にプロセス名を渡して、正規表現で加工された文字列を返しています。</p>
<p>わたしが正規表現の理解に乏しいので説明できませんが、この例では純粋に実行アプリケーション名だけを取り出しています...よね？</p>
<p>before:
<img src="wezterm/img/window-title-before.png" alt="window-title-before" /></p>
<p>after:
<img src="wezterm/img/window-title-after.png" alt="window-title-after" /></p>
<p>すみません、これ (↑) タイトルバーです...。 </p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/window-title.html#admonition-success"></a></p>
</div>
<div>
<p>スッキリしましたね。スッキリしすぎたかもしれません😆</p>
<p>まあ、これもお好みで調整してもらえればOKです。</p>
</div>
</div>
<div class="footnote-definition" id="a"><sup class="footnote-definition-label">1</sup>
<p>なんか偉そうでした。wez さんのサンプル、丸パクリです...。</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tab"><a class="header" href="#tab">Tab</a></h1>
<p>さて、引き続き<code>format.lua</code>に追記していきましょう。今回はタブタイトルです。</p>
<div id="admonition-formatlua" class="admonition example">
<div class="admonition-title">
<p>format.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/tab.html#admonition-formatlua"></a></p>
</div>
<div>
<pre><code class="language-lua">local HEADER = '' -- 文字化けしちゃってるかもしれませんが、アイコンフォント入ってます。

local SYMBOL_COLOR = { '#ffb2cc', '#a4a4a4' }
local FONT_COLOR = { '#dddddd', '#888888' }
local BACK_COLOR = '#2d2d2d'
local HOVER_COLOR = '#434343'

wezterm.on('format-tab-title', function(tab, tabs, panes, config, hover, max_width)
  local index = tab.is_active and 1 or 2

  local bg = hover and HOVER_COLOR or BACK_COLOR
  local zoomed = tab.active_pane.is_zoomed and '🔎 ' or ' '

  return {
    { Foreground = { Color = SYMBOL_COLOR[index] } },
    { Background = { Color = bg } },
    { Text = HEADER .. zoomed },

    { Foreground = { Color = FONT_COLOR[index] } },
    { Background = { Color = bg } },
    { Text = tab.active_pane.title },
  }
end)
</code></pre>
</div>
</div>
<p>これもウィンドウタイトルと同じように、<code>wezterm.on</code>を使って<code>format-tab-title</code>イベントの処理を書いています。</p>
<p>色は適宜調整してください。</p>
<div id="admonition-format-tab-titlehttpswezfurlongorgweztermconfigluawindow-eventsformat-tab-titlehtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/window-events/format-tab-title.html">format-tab-title</a></p>
<p><a class="admonition-anchor-link" href="wezterm/tab.html#admonition-format-tab-titlehttpswezfurlongorgweztermconfigluawindow-eventsformat-tab-titlehtml"></a></p>
</div>
<div>
<p>The format-tab-title event is emitted when the text for a tab title needs to be recomputed.</p>
<p>format-tab-title イベントは、タブタイトルのテキストを再計算する必要があるときに発行されます。</p>
</div>
</div>
<p>これもウィンドウタイトルとほぼ同じですね。</p>
<p>所々で状態によって表示するものを変えていますが、やっていることは<code>zoomed</code>と<code>hover</code>の可視化ですね🤩</p>
<h2 id="タブタイトル"><a class="header" href="#タブタイトル">タブタイトル</a></h2>
<p>上にある例では表示する内容は特に加工していませんが、前回作った<code>BaseName</code>に通すのもスッキリしてオススメです。</p>
<div id="admonition-example" class="admonition example">
<div class="admonition-title">
<p>Example</p>
<p><a class="admonition-anchor-link" href="wezterm/tab.html#admonition-example"></a></p>
</div>
<div>
<pre><code class="language-lua">return {

  〜

  { Text = BaseName(tab.active_pane.title) },
}
</code></pre>
</div>
</div>
<h2 id="zoomed"><a class="header" href="#zoomed">Zoomed</a></h2>
<p>ズーム中はタブに 🔎 アイコンを表示してます。 </p>
<div id="admonition-togglepanezoomstatehttpswezfurlongorgweztermconfigluakeyassignmenttogglepanezoomstatehtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/keyassignment/TogglePaneZoomState.html">TogglePaneZoomState</a></p>
<p><a class="admonition-anchor-link" href="wezterm/tab.html#admonition-togglepanezoomstatehttpswezfurlongorgweztermconfigluakeyassignmenttogglepanezoomstatehtml"></a></p>
</div>
<div>
<p>Toggles the zoom state of the current pane.
A Zoomed pane takes up all available space in the tab, hiding all other panes while it is zoomed.</p>
<p>現在のペインのズーム状態をトグルします。
ズームされたペインは、タブ内で利用可能な全てのスペースを占め、ズーム中は他のペインが全て非表示になります。</p>
</div>
</div>
<p>デフォルトのキーバインドだとズーム機能が割り当てられていないと思うので、<code>keybinds.lua</code>に入れておきましょう。</p>
<div id="admonition-keybindslua" class="admonition example">
<div class="admonition-title">
<p>keybinds.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/tab.html#admonition-keybindslua"></a></p>
</div>
<div>
<pre><code class="language-lua">{ key = 'Z', mods = 'CTRL', action = act.TogglePaneZoomState },
</code></pre>
</div>
</div>
<p>使い方としてはまあ、こんな感じになってたとして...</p>
<p><img src="wezterm/img/zoom-before.png" alt="zoom-before" /></p>
<p>上のペインにいる状態でズームすると...</p>
<p><img src="wezterm/img/zoom-after.png" alt="zoom-after" /></p>
<p>&quot;ズーム中は他のペインが全て非表示になります。&quot;というドキュメントどおり😏</p>
<p>左上に 🔎 アイコンが出ていることも確認できましたね。</p>
<p>もう一度同じ操作で戻ります。</p>
<p>(ペイン操作については<code>3.6 Leader Key</code>でふわっと話題にしました。)</p>
<h2 id="hover"><a class="header" href="#hover">Hover</a></h2>
<p>ホバー中は該当のタブ背景色を少し変えてます。</p>
<div id="admonition-hoverhttpswezfurlongorgweztermconfigluawindow-eventsformat-tab-titlehtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/window-events/format-tab-title.html">hover</a></p>
<p><a class="admonition-anchor-link" href="wezterm/tab.html#admonition-hoverhttpswezfurlongorgweztermconfigluawindow-eventsformat-tab-titlehtml"></a></p>
</div>
<div>
<p>true if the current tab is in the hover state</p>
<p>現在のタブがホバー状態である場合に true を返します。</p>
</div>
</div>
<h2 id="少しluaのお話"><a class="header" href="#少しluaのお話">少しluaのお話</a></h2>
<div id="admonition-example-1" class="admonition example">
<div class="admonition-title">
<p>Example</p>
<p><a class="admonition-anchor-link" href="wezterm/tab.html#admonition-example-1"></a></p>
</div>
<div>
<pre><code class="language-lua">local SYMBOL_COLOR = { '#ffb2cc', '#a4a4a4' }
local FONT_COLOR = { '#dddddd', '#888888' }

local index = tab.is_active and 1 or 2

{ Foreground = { Color = SYMBOL_COLOR[index] } },
</code></pre>
</div>
</div>
<p>lua の配列は<code>[1]</code>始まりなので、(Cとかは<code>[0]</code>から始まりますよね。)
三項演算子<code>local index = tab.is_active and 1 or 2</code>によって<code>SYMBOL_COLOR</code>配列と<code>FONT_COLOR</code>配列それぞれから採用する色を切り替えます。</p>
<p><code>else</code>節を消せるだけ消す書き方、わたしは好きなんですがどうでしょう😆</p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/tab.html#admonition-success"></a></p>
</div>
<div>
<p>だんだん洗練されてきましたね。いよいよ大詰めです。</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="status-bar"><a class="header" href="#status-bar">Status Bar</a></h1>
<p>今度はステータスバーを飾り付けちゃおっかなーと思います😆</p>
<p><code>status.lua</code>というファイルを追加しましょう。</p>
<div id="admonition-statuslua" class="admonition example">
<div class="admonition-title">
<p>status.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/status.html#admonition-statuslua"></a></p>
</div>
<div>
<pre><code class="language-lua">local wezterm = require 'wezterm'

wezterm.on('update-status', function(window, pane)
end)
</code></pre>
</div>
</div>
<p>もうお馴染みですね😉 <code>wezterm.lua</code>から読み込みましょう。</p>
<div id="admonition-weztermlua" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/status.html#admonition-weztermlua"></a></p>
</div>
<div>
<pre><code class="language-lua">require 'status'

-- ↓ ここまでで色々と記述してきたところ
return {
  -- 〜
}
</code></pre>
</div>
</div>
<p>さて、<code>wezterm.on</code>を利用して<code>update-status</code>イベントをフックします。</p>
<div id="admonition-update-statushttpswezfurlongorgweztermconfigluawindow-eventsupdate-statushtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/window-events/update-status.html">update-status</a></p>
<p><a class="admonition-anchor-link" href="wezterm/status.html#admonition-update-statushttpswezfurlongorgweztermconfigluawindow-eventsupdate-statushtml"></a></p>
</div>
<div>
<p>The update-status event is emitted periodically (based on the interval specified by the status_update_interval configuration value).</p>
<p>There is no defined return value for the event, but its purpose is to allow you the chance to carry out some activity and then ultimately call window:set_right_status or window:set_left_status.</p>
<p>update-status イベントは定期的に発行されます (status_update_interval 設定値で指定された間隔に基づく)。</p>
<p>このイベントの戻り値は定義されていませんが、その目的は、何らかの活動を行い、最終的に window:set_right_status または window:set_left_status を呼び出す機会を提供することです。</p>
</div>
</div>
<p>とのことなので、<code>wezterm.lua</code>の中でステータス更新間隔を指定しておきましょう。</p>
<div id="admonition-weztermlua-1" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/status.html#admonition-weztermlua-1"></a></p>
</div>
<div>
<pre><code>return {
  status_update_interval = 1000,
}
</code></pre>
</div>
</div>
<div id="admonition-status_update_intervalhttpswezfurlongorgweztermconfigluaconfigstatus_update_intervalhtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/config/status_update_interval.html">status_update_interval</a></p>
<p><a class="admonition-anchor-link" href="wezterm/status.html#admonition-status_update_intervalhttpswezfurlongorgweztermconfigluaconfigstatus_update_intervalhtml"></a></p>
</div>
<div>
<p>Specifies the number of milliseconds that need to elapse between triggering the update-right-status hook.</p>
<p>update-right-status フックのトリガーとなるまでに必要なミリ秒を指定します。</p>
</div>
</div>
<p>デフォルトは<code>1000ミリ秒(=1秒)</code>です。そのままで良ければ必要ありません。</p>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="wezterm/status.html#admonition-warning"></a></p>
</div>
<div>
<p>ドキュメントでは<code>update-right-status</code>となっていますが、前出の<code>update-status</code>が後継仕様となっているので、こちらを使っていきます。</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/status.html#admonition-success"></a></p>
</div>
<div>
<p>それでは次に進みましょう❗</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="left-status"><a class="header" href="#left-status">Left Status</a></h1>
<p>まずはステータスバーの左側を活用していきましょう😆</p>
<h2 id="キーボード状態"><a class="header" href="#キーボード状態">キーボード状態</a></h2>
<p>わたしが使っているのはキーボード状態です。ひとまずコードはこんな感じ。</p>
<div id="admonition-statuslua" class="admonition example">
<div class="admonition-title">
<p>status.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/left-status.html#admonition-statuslua"></a></p>
</div>
<div>
<pre><code class="language-lua">local DEFAULT_FG = { Color = '#9a9eab' }
local DEFAULT_BG = { Color = '#333333' }

local SPACE_1 = ' '
local SPACE_3 = '   '

local HEADER_KEY_NORMAL = { Foreground = DEFAULT_FG, Text = '' }
local HEADER_LEADER = { Foreground = { Color = '#ffffff' }, Text = '' }
local HEADER_IME = { Foreground = DEFAULT_FG, Text = 'あ' }

local function AddIcon(elems, icon)
  table.insert(elems, { Foreground = icon.Foreground })
  table.insert(elems, { Background = DEFAULT_BG })
  table.insert(elems, { Text = SPACE_1 .. icon.Text .. SPACE_3 })
end

local function GetKeyboard(elems, window)
  if window:leader_is_active() then
    AddIcon(elems, HEADER_LEADER)
    return
  end

  AddIcon(elems, window:composition_status() and HEADER_IME or HEADER_KEY_NORMAL)
end
</code></pre>
</div>
</div>
<p><code>SPACE_3</code>とかは自分でもちょっとマヌケだとは思ってますが、なんかごめんなさい...😿</p>
<p>まだ<code>update-status</code>と繋いでないので動きませんが、ここで一旦区切って補足します。</p>
<p>ここでは以下の状態を可視化します。</p>
<ul>
<li><code>leader</code>キーアクティブ</li>
<li>IME</li>
</ul>
<h2 id="leaderキーアクティブ"><a class="header" href="#leaderキーアクティブ">Leaderキーアクティブ</a></h2>
<p>まずは<code>leader</code>キーの状態を以下で取得します。</p>
<div id="admonition-windowleader_is_activehttpswezfurlongorgweztermconfigluawindowleader_is_activehtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/window/leader_is_active.html">window:leader_is_active</a></p>
<p><a class="admonition-anchor-link" href="wezterm/left-status.html#admonition-windowleader_is_activehttpswezfurlongorgweztermconfigluawindowleader_is_activehtml"></a></p>
</div>
<div>
<p>Returns true if the Leader Key is active in the window, or false otherwise.</p>
<p>リーダーキーがウィンドウ内でアクティブな場合はtrueを、そうでない場合はfalseを返します。</p>
</div>
</div>
<p>上のコード例では、<code>leader</code>キーがアクティブである場合はIMEよりも優先して表示します。</p>
<h2 id="ime状態"><a class="header" href="#ime状態">IME状態</a></h2>
<p>次にIME状態です。</p>
<div id="admonition-windowcomposition_statushttpswezfurlongorgweztermconfigluawindowcomposition_statushtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/window/composition_status.html">window:composition_status()</a></p>
<p><a class="admonition-anchor-link" href="wezterm/left-status.html#admonition-windowcomposition_statushttpswezfurlongorgweztermconfigluawindowcomposition_statushtml"></a></p>
</div>
<div>
<p>Returns a string holding the current dead key or IME composition text, or nil if the input layer is not in a composition state.</p>
<p>This is the same text that is shown at the cursor position when composing.</p>
<p>現在のデッドキーまたはIMEのコンポジションテキストを保持する文字列、または入力レイヤーがコンポジション状態でない場合はnilを返します。</p>
<p>これは、コンポジション時にカーソル位置に表示されるテキストと同じものです。</p>
</div>
</div>
`GetKeyboard()`では、`window:composition_status()`の結果が`nil`か否かでアイコンの色を変えてます。
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/left-status.html#admonition-note"></a></p>
</div>
<div>
<p>コンポジションって何だ？🤔と思われるかもしれませんが、わたしも思ってます。</p>
<p>でも、この状態を指すようです。</p>
<p><img src="wezterm/img/composition.png" alt="composition" /></p>
<p>ちょっとフライングしてますが、左上に<code>あ</code>と出てるのが<code>composition_status()</code>で<code>nil以外</code>が返ってきている状態です。</p>
<p>(<code>nil</code>でない場合は文字列が入りますが、この例では使用していません。)</p>
</div>
</div>
<p>さて、それでは<code>update-status</code>に繋ぎ込みましょう😄</p>
<div id="admonition-statuslua-1" class="admonition example">
<div class="admonition-title">
<p>status.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/left-status.html#admonition-statuslua-1"></a></p>
</div>
<div>
<pre><code class="language-lua">local function LeftUpdate(window, pane)
  local elems = {}

  GetKeyboard(elems, window)

  window:set_left_status(wezterm.format(elems))
end

wezterm.on('update-status', function(window, pane)
  LeftUpdate(window, pane)
end)
</code></pre>
</div>
</div>
<p>normal:</p>
<p><img src="wezterm/img/key-normal.png" alt="key-normal" /></p>
<p>leader key is active:</p>
<p><img src="wezterm/img/key-leader.png" alt="key-leader" /></p>
<p>composition:</p>
<p><img src="wezterm/img/key-ime.png" alt="key-ime" /></p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/left-status.html#admonition-success"></a></p>
</div>
<div>
<p>こんなもんですね。動きが出て楽しいですね😆 ...ね❗️ね❗️</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="right-status"><a class="header" href="#right-status">Right Status</a></h1>
<p>これはもう手厚いサンプルが既に用意されているので、この通りに書けばバッチリです😆 やったね❗️</p>
<div id="admonition-windowset_right_statusstringhttpswezfurlongorgweztermconfigluawindowset_right_statushtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/window/set_right_status.html">window:set_right_status(string)</a></p>
<p><a class="admonition-anchor-link" href="wezterm/right-status.html#admonition-windowset_right_statusstringhttpswezfurlongorgweztermconfigluawindowset_right_statushtml"></a></p>
</div>
<div>
<p>This method can be used to change the content that is displayed in the tab bar, to the right of the tabs and new tab button. </p>
<p>このメソッドを使用すると、タブバー内のタブと新規タブボタンの右側に表示される内容を変更することができます。</p>
</div>
</div>
ただ、わたしの設定例にお付き合いいただける方のために、もうちょっとだけ続きます。
<h2 id="get-parameter"><a class="header" href="#get-parameter">Get Parameter</a></h2>
<p>まずは wez さんのサンプルコードをほぼ丸写しですが、一つずつ機能を分けます。</p>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="wezterm/right-status.html#admonition-warning"></a></p>
</div>
<div>
<p>先に下記のコードを載せていますが、いくつか未定義なものがあるので、これだけだとエラーになっちゃいます。</p>
</div>
</div>
<div id="admonition-statuslua" class="admonition example">
<div class="admonition-title">
<p>status.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/right-status.html#admonition-statuslua"></a></p>
</div>
<div>
<pre><code class="language-lua">local function GetHostAndCwd(elems, pane)
  local uri = pane:get_current_working_dir()

  if not uri then
    return
  end

  local cwd_uri = uri:sub(8)
  local slash = cwd_uri:find '/'

  if not slash then
    return
  end

  local host = cwd_uri:sub(1, slash - 1)
  local dot = host:find '[.]'

  AddElement(elems, HEADER_HOST, dot and host:sub(1, dot - 1) or host)
  AddElement(elems, HEADER_CWD, cwd_uri:sub(slash))
end

local function GetDate(elems)
  AddElement(elems, HEADER_DATE, wezterm.strftime '%a %b %-d')
end

local function GetTime(elems)
  AddElement(elems, HEADER_TIME, wezterm.strftime '%H:%M')
end

local function GetBattery(elems, window)
  if not window:get_dimensions().is_full_screen then
    return
  end

  for _, b in ipairs(wezterm.battery_info()) do
    AddElement(elems, HEADER_BATTERY, string.format('%.0f%%', b.state_of_charge * 100))
  end
end
</code></pre>
</div>
</div>
<p>wez さんのサンプルでは一度に取得していた<code>date</code>と<code>time</code>も分けちゃってます。</p>
<p>程度は分かりませんが、非効率ではあると思われるのでお好みで😉</p>
<p>バッテリー表示については、わたしの場合はフルスクリーンの時だけ出しています。スクリーン状態は下記で取得できます。</p>
<div id="admonition-windowget_dimensionshttpswezfurlongorgweztermconfigluawindowget_dimensionshtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/window/get_dimensions.html">window:get_dimensions()</a></p>
<p><a class="admonition-anchor-link" href="wezterm/right-status.html#admonition-windowget_dimensionshttpswezfurlongorgweztermconfigluawindowget_dimensionshtml"></a></p>
</div>
<div>
<p>The table has the following fields:</p>
<ul>
<li>pixel_width: the width of the window in pixels</li>
<li>pixel_height: the height of the window in pixels</li>
<li>dpi: The DPI of the screen the window in on</li>
<li>is_full_screen: whether the window is in full screen mode</li>
</ul>
<p>テーブルには以下のフィールドがあります:</p>
<ul>
<li>pixel_width: ピクセル単位のウィンドウの幅</li>
<li>pixel_height: ピクセル単位で表したウィンドウの高さ</li>
<li>dpi: ウィンドウが表示されているスクリーンの DPI</li>
<li>is_full_screen: ウィンドウがフルスクリーンモードであるかどうか</li>
</ul>
</div>
</div>
<p>ここでは<code>is_full_screen</code>を使います。フルスクリーン時は<code>true</code>が返ります。</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/right-status.html#admonition-note"></a></p>
</div>
<div>
<p>OSからのフルスクリーン操作、もしくは
<code>WezTerm</code>の<a href="https://wezfurlong.org/wezterm/config/lua/keyassignment/ToggleFullScreen.html">ToggleFullScreen</a>
に反応します。</p>
<p><img src="wezterm/img/fullscreen.png" alt="fullscreen" /></p>
<p>(以前、<code>ToggleFullScreen</code>だと反応しないと書いていましたが、今見たらちゃんと動いてました☺️)</p>
</div>
</div>
<p>で、以下が足りていなかった定義です。</p>
<div id="admonition-statuslua-1" class="admonition example">
<div class="admonition-title">
<p>status.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/right-status.html#admonition-statuslua-1"></a></p>
</div>
<div>
<pre><code class="language-lua">-- ここもやっぱりアイコン入れてます
local HEADER_HOST = { Foreground = { Color = '#75b1a9' }, Text = '' }
local HEADER_CWD = { Foreground = { Color = '#92aac7' }, Text = '' }
local HEADER_DATE = { Foreground = { Color = '#ffccac' }, Text = '' }
local HEADER_TIME = { Foreground = { Color = '#bcbabe' }, Text = '' }
local HEADER_BATTERY = { Foreground = { Color = '#dfe166' }, Text = '' }

local function AddElement(elems, header, str)
  table.insert(elems, { Foreground = header.Foreground })
  table.insert(elems, { Background = DEFAULT_BG })
  table.insert(elems, { Text = header.Text .. SPACE_1 })

  table.insert(elems, { Foreground = DEFAULT_FG })
  table.insert(elems, { Background = DEFAULT_BG })
  table.insert(elems, { Text = str .. SPACE_3 })
end
</code></pre>
<p>(前のページで書いた定義も使用しているので、無かったら以下も追記してください。)</p>
<pre><code class="language-lua">local DEFAULT_FG = { Color = '#9a9eab' }
local DEFAULT_BG = { Color = '#333333' }

local SPACE_1 = ' '
local SPACE_3 = '   '
</code></pre>
</div>
</div>
<p>引っ張った割には特にコメントするところもないですね...。そのまま完成させちゃいましょう😊</p>
<div id="admonition-statuslua-2" class="admonition example">
<div class="admonition-title">
<p>status.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/right-status.html#admonition-statuslua-2"></a></p>
</div>
<div>
<pre><code class="language-lua">local function RightUpdate(window, pane)
  local elems = {}

  GetHostAndCwd(elems, pane)
  GetDate(elems)
  GetBattery(elems, window)
  GetTime(elems)

  window:set_right_status(wezterm.format(elems))
end

wezterm.on('update-status', function(window, pane)
  LeftUpdate(window, pane) -- 前回書いたコードはそのままで。
  RightUpdate(window, pane)
end)
</code></pre>
</div>
</div>
<p>さて、これでこんな感じになったはずなんですがどうでしょう❓(例によってユーザー名は雑に隠してます。)</p>
<p><img src="wezterm/img/right-status.png" alt="right-status" /></p>
<p>フルスクリーン時にはバッテリー表示がされていることも確認できます。
<img src="wezterm/img/right-status-full.png" alt="right-status" /></p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/right-status.html#admonition-success"></a></p>
</div>
<div>
<p>華やかになりましたね☺️ (まあ、ぶっちゃけそんな見ないんだけど...) </p>
<p>サンプル通りとはいえ、自分で書いたコードが動くんだから楽しい世界です。ほわほわ〜💕</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custom-event"><a class="header" href="#custom-event">Custom Event</a></h1>
<p>さて、一通り片付いたかな〜って感じなので、ここは付録みたいなものです🥳</p>
<p>お付き合いいただける方は<code>event.lua</code>とでもしてまたファイルを作成しましょう。</p>
<div id="admonition-eventlua" class="admonition example">
<div class="admonition-title">
<p>event.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/custom.html#admonition-eventlua"></a></p>
</div>
<div>
<pre><code class="language-lua">-- まだ何にもない。
</code></pre>
</div>
</div>
<p>これもまたお馴染みですが、<code>wezterm.lua</code>から呼び出しましょう。</p>
<div id="admonition-weztermlua" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/custom.html#admonition-weztermlua"></a></p>
</div>
<div>
<pre><code class="language-lua">require 'event'
</code></pre>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/custom.html#admonition-success"></a></p>
</div>
<div>
<p>もう何も言うことはありませんね😉 次に進みましょう❗</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="toggle-font"><a class="header" href="#toggle-font">Toggle Font</a></h1>
<p>ここではわたしが使っている機能実装を紹介します。</p>
<p>環境によっては全く必要ないと思いますので、その場合はスキップしてください😅</p>
<h2 id="まず前提"><a class="header" href="#まず前提">まず前提</a></h2>
<p>わたしのディスプレイ環境なんですが、MacBook と 4K を行ったり来たりして使っています。</p>
<p>だからなんだって言われるとキツイんですが、一番わかりやすいところでフォントサイズの問題があって、画面のスケールが違いすぎて大きすぎたり小さすぎたりしてしまう...😢</p>
<p><img src="wezterm/img/img-4k.png" alt="img-4k" /></p>
<p><img src="wezterm/img/img-mbp.png" alt="img-mbp" /></p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/toggle-font.html#admonition-note"></a></p>
</div>
<div>
<p>意図伝わりますでしょうか...😅</p>
<p>むしろツールバーをみてもらった方がわかりやすいかもしれません。アイコンとかフォントとか、サイズというか、スケール全然違うでしょ❓</p>
</div>
</div>
<p><a href="https://wezfurlong.org/wezterm/config/lua/keyassignment/DecreaseFontSize.html">DecreaseFontSize</a>・
<a href="https://wezfurlong.org/wezterm/config/lua/keyassignment/IncreaseFontSize.html">IncreaseFontSize</a>
を使ってサイズを上げ下げしてもいいんですが、ちょっとコレじゃない...😒</p>
<p>わたしはこれが結構ストレスになっていたので、 この問題を解消するのに有用なのが、次のフォント切り替え機能です😃</p>
<h2 id="フォントサイズ切り替え"><a class="header" href="#フォントサイズ切り替え">フォントサイズ切り替え</a></h2>
<p>この例では<code>toggle-font-size</code>というイベントを独自に作っています。</p>
<p><code>WezTerm</code>では、フォントサイズに限らず、元の設定を直接書き換えるのではなく、オーバーライドすることで変化させます。</p>
<div id="admonition-windowget_config_overrideshttpswezfurlongorgweztermconfigluawindowget_config_overrideshtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/window/get_config_overrides.html">window:get_config_overrides()</a></p>
<p><a class="admonition-anchor-link" href="wezterm/toggle-font.html#admonition-windowget_config_overrideshttpswezfurlongorgweztermconfigluawindowget_config_overrideshtml"></a></p>
</div>
<div>
<p>Returns a copy of the current set of configuration overrides that is in effect for the window.</p>
<p>ウィンドウに適用されている設定オーバーライドの現在のセットのコピーを返します。</p>
</div>
</div>
<div id="admonition-eventlua" class="admonition example">
<div class="admonition-title">
<p>event.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/toggle-font.html#admonition-eventlua"></a></p>
</div>
<div>
<pre><code class="language-lua">local wezterm = require 'wezterm'

wezterm.on('toggle-font-size', function(window, pane)
  local overrides = window:get_config_overrides() or {}
  overrides.font_size = not overrides.font_size and 10.0 or nil

  window:set_config_overrides(overrides)
end)
</code></pre>
</div>
</div>
<p>端的に言えば、以下の動作を交互に行っています。</p>
<ul>
<li>素の状態であれば、<code>font_size</code>を<code>10.0</code>でオーバーライド。</li>
<li>オーバーライドされているのであれば、<code>font_size</code>を<code>nil</code>としてオーバーライドを無効化 (素の状態に戻す)。</li>
</ul>
<p>これでフォントサイズの切り替えが実現できます。</p>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/toggle-font.html#admonition-note-1"></a></p>
</div>
<div>
<p>わたしは<code>wezterm.lua</code>の<code>font_size</code>を<code>14.0</code>にして、<code>14.0</code>と<code>10.0</code>を行ったり来たりできるように設定しています。
環境に合わせて調整してください。</p>
</div>
</div>
<p>独自イベントが呼び出されるようにするには<code>EmitEvent</code>を用います。</p>
<div id="admonition-emiteventhttpswezfurlongorgweztermconfigluakeyassignmentemiteventhtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/keyassignment/EmitEvent.html">EmitEvent</a></p>
<p><a class="admonition-anchor-link" href="wezterm/toggle-font.html#admonition-emiteventhttpswezfurlongorgweztermconfigluakeyassignmentemiteventhtml"></a></p>
</div>
<div>
<p>This action causes the equivalent of wezterm.emit(name, window, pane) to be called in the context of the current pane.</p>
<p>このアクションは、現在のペインのコンテキストで wezterm.emit(name, window, pane) と同等のアクションが呼び出されるようにします。</p>
</div>
</div>
<p>わたしはキーバインド<code>ctrl-f</code>をトリガーとして呼び出しています。</p>
<div id="admonition-keybindslua" class="admonition example">
<div class="admonition-title">
<p>keybinds.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/toggle-font.html#admonition-keybindslua"></a></p>
</div>
<div>
<pre><code class="language-lua">  { key = 'f', mods = 'CTRL', action = act.EmitEvent 'toggle-font-size' },
</code></pre>
</div>
</div>
<p>まあ、思いっきり手動なんですけどね😅 自動で出来たら面白いんですけどね。</p>
<div id="admonition-note-2" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/toggle-font.html#admonition-note-2"></a></p>
</div>
<div>
<p>あれ？dpi取得できるなら自動で出来るのかな。このサイト作りながら気づいてしまった...。</p>
<p>アウトプットはしてみるものですね❗次のページに書いちゃいます😆</p>
</div>
</div>
<p>素の状態: <sup class="footnote-reference"><a href="#big">1</a></sup>
<img src="wezterm/img/font-big.png" alt="font-big" /></p>
<p>切り替えた状態:
<img src="wezterm/img/font-small.png" alt="font-small" /></p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/toggle-font.html#admonition-success"></a></p>
</div>
<div>
<p>切り替えられましたね🤗</p>
<p>気持ちいい〜❗️</p>
</div>
</div>
<div class="footnote-definition" id="big"><sup class="footnote-definition-label">1</sup>
<p>さらにフォントサイズを大きくして説明用に誇張しています。が、まだなんか中途半端でしたね。</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dpi-detection"><a class="header" href="#dpi-detection">DPI Detection</a></h1>
<p>前回は手動でフォントサイズの切り替えを行いましたが、今回はこれを<code>dpi</code>の変更を検知して自動で切り替わるようにします。</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/dpi-detection.html#admonition-note"></a></p>
</div>
<div>
<p>今後の仕様追加・変更によって、より自然に実現できるかもしれませんね〜、などと書いていたら、</p>
<p><a href="https://wezfurlong.org/wezterm/config/lua/window-events/window-focus-changed.html">window-focus-changed</a>が実装されました🤩</p>
</div>
</div>
<p>ここでは、二つのプランとして紹介します。おすすめは Plan B です。</p>
<h2 id="実装---plan-a"><a class="header" href="#実装---plan-a">実装 - Plan A</a></h2>
<p>さて、これまでにも何度か出てきていた<code>wezterm.on</code>ですが、以下のような説明がありました。</p>
<div id="admonition-weztermonevent_name-callbackhttpswezfurlongorgweztermconfigluaweztermonhtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/wezterm/on.html">wezterm.on(event_name, callback)</a></p>
<p><a class="admonition-anchor-link" href="wezterm/dpi-detection.html#admonition-weztermonevent_name-callbackhttpswezfurlongorgweztermconfigluaweztermonhtml"></a></p>
</div>
<div>
<p>wezterm.on can register multiple callbacks for the same event; internally an ordered list of callbacks is maintained for each event.
When the event is emitted, each of the registered callbacks is called in the order that they were registered.</p>
<p>wezterm.on は、同じイベントに対して複数のコールバックを登録することができます; 内部的には、各イベントに対してコールバックの順序付きリストが維持されます。
イベントが発信されると、登録された各コールバックは、登録された順に呼び出されます。</p>
</div>
</div>
<p>これを踏まえた上で、<code>update-status</code>をもう一個作ります。<sup class="footnote-reference"><a href="#a">1</a></sup></p>
<div id="admonition-update-statushttpswezfurlongorgweztermconfigluawindow-eventsupdate-statushtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/window-events/update-status.html">update-status</a></p>
<p><a class="admonition-anchor-link" href="wezterm/dpi-detection.html#admonition-update-statushttpswezfurlongorgweztermconfigluawindow-eventsupdate-statushtml"></a></p>
</div>
<div>
<p>There is no defined return value for the event, but its purpose is to allow you the chance to carry out some activity and then ultimately call window:set_right_status or window:set_left_status.</p>
<p>このイベントの戻り値は定義されていませんが、その目的は、何らかの活動を行い、最終的に window:set_right_status または window:set_left_status を呼び出す機会を提供することです。</p>
</div>
</div>
<p>説明にもある通り、「最終的に<code>window:set_right_status</code>または<code>window:set_left_status</code>を呼び出す目的」のものであるため、
なんかコレじゃないとは思っていますが、他に方法が見つけられませんでした😢</p>
<p>それでは<code>event.lua</code>に追記していきます。</p>
<div id="admonition-eventlua" class="admonition example">
<div class="admonition-title">
<p>event.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/dpi-detection.html#admonition-eventlua"></a></p>
</div>
<div>
<pre><code class="language-lua">local DPI_CHANGE_NUM = 140
local DPI_CHANGE_FONT_SIZE = 10.0

local prev_dpi = 0

wezterm.on('trigger-dpi', function(window, dpi)
  local overrides = window:get_config_overrides() or {}
  overrides.font_size = dpi &gt;= DPI_CHANGE_NUM and DPI_CHANGE_FONT_SIZE or nil

  window:set_config_overrides(overrides)
end)

wezterm.on('update-status', function(window, pane)
  local dpi = window:get_dimensions().dpi

  if dpi == prev_dpi then
    return
  end

  wezterm.emit('trigger-dpi', window, dpi)

  prev_dpi = dpi
end)
</code></pre>
</div>
</div>
<p><code>dpi</code>と<code>font_size</code>周辺の値はわたしの環境にあわせてぼや〜っと決め打ちにしてるので適宜調整してください。</p>
<p>動作としては、<code>dpi</code>に変更があったらカスタムイベントの<code>trigger-dpi</code>を呼んでフォントサイズを切り替えます。
<code>trigger-dpi</code>自体は手動でフォントサイズを切り替える処理とほぼ同じですね☺️</p>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/dpi-detection.html#admonition-note-1"></a></p>
</div>
<div>
<p>理由はちょっとよくわからなかったのですが、</p>
<p>カスタムイベントに渡した<code>window</code>に対しての<code>get_config_overrides().dpi</code>が上手くいかなかったので、
<code>wezterm.emit('trigger-dpi', window, dpi)</code>として<code>dpi</code>も渡しています。</p>
</div>
</div>
<div id="admonition-note-2" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/dpi-detection.html#admonition-note-2"></a></p>
</div>
<div>
<p>わざわざカスタムイベントに分けなくても動くんですが、</p>
<p>やっぱり本来の目的に無いことをしているので、少しでも設計思想に近づけているつもりなんです...。</p>
</div>
</div>
<h2 id="実装---plan-b"><a class="header" href="#実装---plan-b">実装 - Plan B</a></h2>
<p>さて、Plan A よりも自然に目的を達成できそうな、これ。</p>
<div id="admonition-window-focus-changedhttpswezfurlongorgweztermconfigluawindow-eventswindow-focus-changedhtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/window-events/window-focus-changed.html">window-focus-changed</a></p>
<p><a class="admonition-anchor-link" href="wezterm/dpi-detection.html#admonition-window-focus-changedhttpswezfurlongorgweztermconfigluawindow-eventswindow-focus-changedhtml"></a></p>
</div>
<div>
<p>The window-focus-changed event is emitted when the focus state for a window is changed.</p>
<p>This event is fire-and-forget from the perspective of wezterm; it fires the event to advise of the config change, but has no other expectations.</p>
<p>window-focus-changed イベントは、ウィンドウのフォーカス状態が変更されたときに発行されます。</p>
<p>このイベントは wezterm の観点からは fire-and-forget です; それは設定変更を通知するためにイベントを発生させますが、それ以外のことは期待できません。</p>
</div>
</div>
<div id="admonition-note-3" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/dpi-detection.html#admonition-note-3"></a></p>
</div>
<div>
<p>10/12 時点では、nightly builds only となっていることに注意してください。</p>
</div>
</div>
<p>それでは満を持して😌</p>
<div id="admonition-eventlua-1" class="admonition example">
<div class="admonition-title">
<p>event.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/dpi-detection.html#admonition-eventlua-1"></a></p>
</div>
<div>
<pre><code class="language-lua">wezterm.on('window-focus-changed', function(window, pane)
  local dpi = window:get_dimensions().dpi

  if dpi == prev_dpi then
    return
  end

  local overrides = window:get_config_overrides() or {}
  overrides.font_size = dpi &gt;= DPI_CHANGE_NUM and DPI_CHANGE_FONT_SIZE or nil

  window:set_config_overrides(overrides)

  prev_dpi = dpi
end)
</code></pre>
</div>
</div>
<p>コードについては やっぱり<code>trigger-dpi</code>とほぼ同じなので割愛。</p>
<p>Plan A との比較では<code>update-status</code>を使わなくて良くなったのと、カスタムイベントの呼び出しも無くなりました。</p>
<p>ウィンドウをドラッグしたりウィンドウマネージャー等を使ってディスプレイを移した際に切り替わらないという欠点こそあるものの、
とても綺麗な実装になりました😄</p>
<div id="admonition-note-4" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/dpi-detection.html#admonition-note-4"></a></p>
</div>
<div>
<p>「欠点」と書いてしまいましたが、移動後にウィンドウのフォーカスを外すとフォントサイズが切り替わることが確認できるので、もちろん仕様に則した動作です。</p>
</div>
</div>
<h2 id="まとめ"><a class="header" href="#まとめ">まとめ</a></h2>
<p>上にも書きましたが、Plan B は10/12 時点で nightly builds only です。</p>
<p>それ以外はほとんど問題にならないと思われますが、
頻繁にディスプレイを切り替えるような使い方をする場合は Plan A の方が有用かもしれないので、ひとまず Tips として残しておきます。</p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/dpi-detection.html#admonition-success"></a></p>
</div>
<div>
<p>それにしても、実装がすごく簡単😆</p>
<p>既に用意されているロジックをつなぐだけ❗️</p>
</div>
</div>
<div class="footnote-definition" id="a"><sup class="footnote-definition-label">1</sup>
<p>ステータスバーの飾り付けの際にも使用しましたね。</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="window-decorations"><a class="header" href="#window-decorations">Window Decorations</a></h1>
<p>なんか、こんなものがあるらしい...🤔</p>
<div id="admonition-window_decorationshttpswezfurlongorgweztermconfigluaconfigwindow_decorationshtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/config/window_decorations.html">window_decorations</a></p>
<p><a class="admonition-anchor-link" href="wezterm/window-decorations.html#admonition-window_decorationshttpswezfurlongorgweztermconfigluaconfigwindow_decorationshtml"></a></p>
</div>
<div>
<p>Configures whether the window has a title bar and/or resizable border.</p>
<p>ウィンドウにタイトルバーとリサイズ可能なボーダーを設けるかどうかを設定する。</p>
</div>
</div>
<p>パラメータは、このように示されていますね。</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">flag</th><th style="text-align: left">description</th></tr></thead><tbody>
<tr><td style="text-align: left">&quot;NONE&quot;</td><td style="text-align: left">disables titlebar and border (borderless mode)<br>タイトルバーとボーダーを無効にします（ボーダーレスモード）。</td></tr>
<tr><td style="text-align: left">&quot;TITLE&quot;</td><td style="text-align: left">disable the resizable border and enable only the title bar<br>サイズ変更可能なボーダーを無効にし、タイトルバーのみを有効にします。</td></tr>
<tr><td style="text-align: left">&quot;RESIZE&quot;</td><td style="text-align: left">disable the title bar but enable the resizable border<br>タイトルバーを無効にし、サイズ変更可能なボーダーを有効にします。</td></tr>
<tr><td style="text-align: left">&quot;TITLE | RESIZE&quot;</td><td style="text-align: left">Enable titlebar and border. This is the default.<br>タイトルバーとボーダーを使用可能にします。これはデフォルトです。</td></tr>
</tbody></table>
</div>
<p>タイトルバーを無効にするのはなんか面白そう。</p>
<div id="admonition-weztermlua" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/window-decorations.html#admonition-weztermlua"></a></p>
</div>
<div>
<pre><code class="language-lua">window_decorations = 'RESIZE',
</code></pre>
</div>
</div>
<p><img src="wezterm/img/decorations.png" alt="decorations.png" /></p>
<p>...いいね❗🤩</p>
<p>あー、でも、わたしたまにマウス操作で最小化ボタン使いたくなることあんだよねー、ちょっと辛い😅</p>
<p>今回はごめんなさいかなー。</p>
<p>...。</p>
<p>...。</p>
<p>なんて言うわけないじゃん⁉️😝</p>
<h2 id="configuring-mouse-assignments"><a class="header" href="#configuring-mouse-assignments">Configuring Mouse Assignments</a></h2>
<div id="admonition-mouse-bindinghttpswezfurlongorgweztermconfigmousehtmlconfiguring-mouse-assignments" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/mouse.html#configuring-mouse-assignments">Mouse Binding</a></p>
<p><a class="admonition-anchor-link" href="wezterm/window-decorations.html#admonition-mouse-bindinghttpswezfurlongorgweztermconfigmousehtmlconfiguring-mouse-assignments"></a></p>
</div>
<div>
<p>You can define mouse actions using the mouse_bindings configuration section:</p>
<p>マウスアクションは、mouse_bindings設定セクションを使用して定義することができます:</p>
</div>
</div>
<p>またちょっとファイルを分けましょう。<code>mousebinds.lua</code>みたいな。</p>
<p>もうこのまま中身まで書いちゃいます😸</p>
<div id="admonition-mousebindslua" class="admonition example">
<div class="admonition-title">
<p>mousebinds.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/window-decorations.html#admonition-mousebindslua"></a></p>
</div>
<div>
<pre><code class="language-lua">local act = require('wezterm').action

return {
  mouse_bindings = {
    {
      event = { Down = { streak = 1, button = 'Left' } },
      mods = 'NONE',
      action = act.EmitEvent 'show-title-bar',
    },
  },
}
</code></pre>
</div>
</div>
<p>カスタムイベントは<code>event.lua</code>の方にまとめます。</p>
<div id="admonition-eventlua" class="admonition example">
<div class="admonition-title">
<p>event.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/window-decorations.html#admonition-eventlua"></a></p>
</div>
<div>
<pre><code class="language-lua">wezterm.on('show-title-bar', function(window, pane)
  local overrides = window:get_config_overrides() or {}

  overrides.window_decorations = 'TITLE | RESIZE'
  window:set_config_overrides(overrides)
end)
</code></pre>
</div>
</div>
<p>いつも通り、<code>wezterm.lua</code>から読み込みます。<code>keybinds</code>と同じ流れ😌</p>
<div id="admonition-weztermlua-1" class="admonition example">
<div class="admonition-title">
<p>wezterm.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/window-decorations.html#admonition-weztermlua-1"></a></p>
</div>
<div>
<pre><code class="language-lua">  mouse_bindings = require('mousebinds').mouse_bindings,
</code></pre>
</div>
</div>
<p>これで一回動かしてみましょう。ウィンドウをクリックすると...、</p>
<p><img src="wezterm/img/decorations2.png" alt="decorations2.png" /></p>
<p>タイトルバーが現れました。やったね😆</p>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="wezterm/window-decorations.html#admonition-tip"></a></p>
</div>
<div>
<p>例えば<code>Neovim</code>みたいな、マウス操作に対応しているアプリケーションを動かしてる時だと、
そちらに操作を奪われてしまうようで、タイトルバーは現れません。</p>
<p><code>Neovim</code>であれば、以下のようにすればマウス操作を無効化できるので、この状態ならバッチリです👍</p>
<pre><code>vim.opt.mouse = ''
</code></pre>
<p>ただ、マウス操作で手軽に文章を拾いたいことがあるので、わたしは入れてません🥳</p>
</div>
</div>
<p>でもこれだけだと、出したら出しっぱなしでなんか締まりませんね😮</p>
<p>やっぱり今回はごめんなさいかなー。</p>
<p>...。</p>
<p>...。</p>
<p>なんて言うわけないじゃん⁉️😝</p>
<h2 id="ここでも-window-focus-changed"><a class="header" href="#ここでも-window-focus-changed">ここでも window-focus-changed</a></h2>
<div id="admonition-eventlua-1" class="admonition example">
<div class="admonition-title">
<p>event.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/window-decorations.html#admonition-eventlua-1"></a></p>
</div>
<div>
<pre><code class="language-lua">function DisableWindowDecorations(window, interval)
  if interval then
    wezterm.sleep_ms(interval)
  end

  local overrides = window:get_config_overrides() or {}
  overrides.window_decorations = nil
  window:set_config_overrides(overrides)
end

wezterm.on('window-focus-changed', function(window, pane)
  if window:is_focused() then
    return
  end

  DisableWindowDecorations(window)
end)
</code></pre>
</div>
</div>
<p>はい。ウィンドウのフォーカスを外すと引っ込むようにしてみました。</p>
<p>あ、前のページでも挙げてましたが、<code>wezterm.on</code>は同じイベントがいくつ被っても平気です😉</p>
<p>こんなんなんぼあってもええですからね。</p>
<div id="admonition-weztermonevent_name-callbackhttpswezfurlongorgweztermconfigluaweztermonhtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/wezterm/on.html">wezterm.on(event_name, callback)</a></p>
<p><a class="admonition-anchor-link" href="wezterm/window-decorations.html#admonition-weztermonevent_name-callbackhttpswezfurlongorgweztermconfigluaweztermonhtml"></a></p>
</div>
<div>
<p>wezterm.on can register multiple callbacks for the same event; internally an ordered list of callbacks is maintained for each event.
When the event is emitted, each of the registered callbacks is called in the order that they were registered.</p>
<p>wezterm.on は、同じイベントに対して複数のコールバックを登録することができます; 内部的には、各イベントに対してコールバックの順序付きリストが維持されます。
イベントが発信されると、登録された各コールバックは、登録された順に呼び出されます。</p>
</div>
</div>
<p>え❓😮 <code>DisableWindowDecorations</code>にある<code>interval</code>は何かって❓</p>
<p>かなわんなあ。最初に記述した<code>show-title-bar</code>イベントに少しだけ手を加えましょ😄</p>
<div id="admonition-eventlua-2" class="admonition example">
<div class="admonition-title">
<p>event.lua</p>
<p><a class="admonition-anchor-link" href="wezterm/window-decorations.html#admonition-eventlua-2"></a></p>
</div>
<div>
<pre><code class="language-lua">-- これを追加して...、
local TITLE_BAR_DISPLAY_TIME = 3000

wezterm.on('show-title-bar', function(window, pane)
  local overrides = window:get_config_overrides() or {}

  overrides.window_decorations = 'TITLE | RESIZE'
  window:set_config_overrides(overrides)

  -- これも追加する
  DisableWindowDecorations(window, TITLE_BAR_DISPLAY_TIME)
end)
</code></pre>
</div>
</div>
<p>これで<code>TITLE_BAR_DISPLAY_TIME</code>時間経過後、勝手に消えるようになってるはずです。どうでしょう😆</p>
<p>え❓😮 <code>DisableWindowDecorations</code>にある<code>sleep_ms()</code>は何かって❓</p>
<p>かなわんなあ。ちょっと不自然な気がするけど、これしか無かってん...😿</p>
<div id="admonition-weztermsleep_msmillisecondshttpswezfurlongorgweztermconfigluaweztermsleep_mshtml" class="admonition info">
<div class="admonition-title">
<p><a href="https://wezfurlong.org/wezterm/config/lua/wezterm/sleep_ms.html">wezterm.sleep_ms(milliseconds)</a></p>
<p><a class="admonition-anchor-link" href="wezterm/window-decorations.html#admonition-weztermsleep_msmillisecondshttpswezfurlongorgweztermconfigluaweztermsleep_mshtml"></a></p>
</div>
<div>
<p>wezterm.sleep_ms suspends execution of the script for the specified number of milliseconds.
After that time period has elapsed, the script continues running at the next statement.</p>
<p>wezterm.sleep_ms は、指定されたミリ秒の間、スクリプトの実行を一時停止します。
その時間が経過した後、スクリプトは次の文で実行を継続する。</p>
</div>
</div>
<p>他になんかもっとええのあったら教えてな〜☺️</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="wezterm/window-decorations.html#admonition-note"></a></p>
</div>
<div>
<p>うちな〜、<code>Raycast</code><sup class="footnote-reference"><a href="#1">1</a></sup>の<code>WindowManagement</code>使てんねんけど、よーこんな感じできっちりウィンドウ詰めるやろ〜❓</p>
<p><img src="wezterm/img/deco-custom1.png" alt="deco-custom1.png" /></p>
<p>タイトルバー出すやろ〜❓</p>
<p><img src="wezterm/img/deco-custom2.png" alt="deco-custom2.png" /></p>
<p>そんでな〜、引っ込んだらこんなんなんねん。</p>
<p><img src="wezterm/img/deco-custom3.png" alt="deco-custom3.png" /></p>
<p>なんでやねん🫱</p>
</div>
</div>
<div id="admonition-default" class="admonition note">
<div>
<p>...あれ❓上の問題、出たり出なかったりする...。なにが違うねんな〜❗</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="wezterm/window-decorations.html#admonition-success"></a></p>
</div>
<div>
<p>なんか色々ありましたが、実際動かしてみたらこれ、すごい面白くないですか⁉️😆</p>
</div>
</div>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="https://www.raycast.com">https://www.raycast.com</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation-1"><a class="header" href="#installation-1">Installation</a></h1>
<p>さてさて、ここからは<code>Neovim</code>を扱っていきます。</p>
<p>これもやっぱり<code>Homebrew</code>や、ホームページ上で提供されている実行ファイルをダウンロードする方法があります。</p>
<div id="admonition-installing-neovimhttpsgithubcomneovimneovimwikiinstalling-neovim" class="admonition info">
<div class="admonition-title">
<p><a href="https://github.com/neovim/neovim/wiki/Installing-Neovim">Installing Neovim</a></p>
<p><a class="admonition-anchor-link" href="neovim/installation.html#admonition-installing-neovimhttpsgithubcomneovimneovimwikiinstalling-neovim"></a></p>
</div>
<div>
<p>You can install Neovim from download, package, or source in just a few seconds.</p>
<p>ダウンロード、パッケージ、ソースから、わずか数秒でNeovimをインストールすることができます。</p>
</div>
</div>
<p>わたしはと言うと、<code>Homebrew</code>から<code>development version</code>を使用しています。</p>
<p><code>WezTerm</code>もそうでしたが、<code>NeoVim</code>もそれ以上に活発なプロジェクトなのでなんか楽しいです😆</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/installation.html#admonition-note"></a></p>
</div>
<div>
<p>まあ、一般的には<code>stable release</code>ですよね〜😅</p>
</div>
</div>
<p>ここに書いてあることは全て<code>development version</code>で動かしていますが、
割と最近(2022/10)になって<code>stable release</code>が<code>v0.8.0</code>に更新されたこともあり、そんなに顕著な差が出ることはないと思ってます。</p>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="neovim/installation.html#admonition-warning"></a></p>
</div>
<div>
<p>なんて思ってましたが環境によっては結構ラグあるんですね...😿 (Oct 15 時点)</p>
<p><em><code>0.8.0</code>だよね〜❗の図↓:</em>
<img src="neovim/img/brew-info.png" alt="brew-info.png" /></p>
<p><em><code>0.7.2-3.el9</code>だって〜⁉️の図↓:</em>
<img src="neovim/img/rocky.png" alt="rocky.png" /></p>
<p>その後、Nov 1 時点で<code>0.8.0-0.el9</code>になってました❗</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/installation.html#admonition-success"></a></p>
</div>
<div>
<p>まあだいじょうぶ。なんとかなる😃</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="user-config"><a class="header" href="#user-config">User Config</a></h1>
<p>なんかもういつも通りですが、まずは設定ファイルを置くところから始めましょう。</p>
<div id="admonition-load-user-confighttpsneovimiodocuserstartinghtmlconfig" class="admonition info">
<div class="admonition-title">
<p><a href="https://neovim.io/doc/user/starting.html#config">Load user config</a></p>
<p><a class="admonition-anchor-link" href="neovim/user-config.html#admonition-load-user-confighttpsneovimiodocuserstartinghtmlconfig"></a></p>
</div>
<div>
<p>A file containing initialization commands is generically called a &quot;vimrc&quot; or config file.
It can be either Vimscript (&quot;init.vim&quot;) or Lua (&quot;init.lua&quot;), but not both. </p>
<p>初期化コマンドを含むファイルは一般に &quot;vimrc&quot; または config ファイルと呼ばれます。
Vimscript (&quot;init.vim&quot;)またはLua (&quot;init.lua&quot;)のどちらかになりますが、両方は使えません。</p>
</div>
</div>
<p>なんということでしょう❗<code>Vimscript</code>または<code>Lua</code>のどちらかを選ばなければなりません😩</p>
<p>...なんつって。白々しかったですよね〜😉</p>
<p>このサイトでは、<code>WezTerm</code>でも散々扱ってきた<code>Lua</code>を選択します。
(というか、わたしは<code>VimScript</code>扱えません。)</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/user-config.html#admonition-note"></a></p>
</div>
<div>
<p><code>Neovim</code>は<code>Vimscript</code>を扱えますが、後継の<code>Vim9 script</code>はサポートしないことが表明されているようです。</p>
<p>もしこれを扱いたい場合は <a href="https://www.vim.org">Vim</a> を使う必要があります。</p>
<p>詳しく調べたわけではありませんが、これから始めるなら<code>Neovim + Lua</code>か<code>Vim + Vim9 script</code>の2択じゃないでしょうか？</p>
</div>
</div>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="neovim/user-config.html#admonition-warning"></a></p>
</div>
<div>
<p>あと、これは結構強調しておきたいんですが、</p>
<p>「<code>Vimscript</code>ではああでしたが、<code>lua</code>ではこうでして❗」みたいな &quot;移行&quot; を目的とした書き方はしません。</p>
</div>
</div>
<p>わたし自身は <code>Neovim</code> → <code>WezTerm</code> という順番で<code>Lua</code>に触れてきましたが、難易度的には<code>Neovim</code>の方が高いと思ってます。</p>
<p>うん、このまま登っていきましょう。</p>
<h2 id="initlua"><a class="header" href="#initlua">init.lua</a></h2>
<p>前置きが少し長くなりました...。</p>
<p>冒頭のドキュメントでconfigファイルは以下の場所だよ😄と示されています。(<code>macOS</code>は<code>Unix</code>と同じ場所です。)</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">OS</th><th style="text-align: left">configファイル</th></tr></thead><tbody>
<tr><td style="text-align: left">Unix</td><td style="text-align: left">~/.config/nvim/init.vim	(or init.lua)</td></tr>
<tr><td style="text-align: left">Windows</td><td style="text-align: left">~/AppData/Local/nvim/init.vim	(or init.lua)</td></tr>
<tr><td style="text-align: left">$XDG_CONFIG_HOME</td><td style="text-align: left">$XDG_CONFIG_HOME/nvim/init.vim (or init.lua)</td></tr>
</tbody></table>
</div><div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/user-config.html#admonition-note-1"></a></p>
</div>
<div>
<p><code>$XDG_CONFIG_HOME</code>はちょっと影響範囲が広いので、このサイトでは扱いません。</p>
</div>
</div>
<p>では作っていきましょう😄</p>
<p><code>Windows</code>の場合は<code>~/AppData/Local/nvim</code>に読み替えてください。</p>
<div id="admonition-ディレクトリを作る" class="admonition quote">
<div class="admonition-title">
<p>ディレクトリを作る</p>
<p><a class="admonition-anchor-link" href="neovim/user-config.html#admonition-ディレクトリを作る"></a></p>
</div>
<div>
<pre><code class="language-sh">mkdir -p ~/.config/nvim
</code></pre>
</div>
</div>
<div id="admonition-initluaを作る" class="admonition quote">
<div class="admonition-title">
<p>init.luaを作る</p>
<p><a class="admonition-anchor-link" href="neovim/user-config.html#admonition-initluaを作る"></a></p>
</div>
<div>
<pre><code class="language-sh"># 先にディレクトリを移動しておく
cd ~/.config/nvim

# nvimを使ってinit.luaを作成する(touchでもいいんですけどね。)
# 中身はまだ無くてOKです。
nvim init.lua
</code></pre>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/user-config.html#admonition-success"></a></p>
</div>
<div>
<p>しれっと<code>nvim</code>を起動してますがもう解禁でいいですよね。</p>
<p>中身はまっさらですが、これから作っていきましょう😉</p>
</div>
</div>
<div id="admonition-default" class="admonition success">
<div>
<p>マサラは　まっしろ　はじまりのいろ</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lua-module"><a class="header" href="#lua-module">Lua Module</a></h1>
<p>なんと、これに関しては既に日本語に訳されたドキュメントが存在します。</p>
<p>登っていきましょうとか言っておいてなんですが、まずは掘り下げちゃいます。どんまい😆</p>
<div id="admonition-モジュールhttpsgithubcomwillelznvim-lua-guide-jablobmasterreadmejamdモジュール" class="admonition info">
<div class="admonition-title">
<p><a href="https://github.com/willelz/nvim-lua-guide-ja/blob/master/README.ja.md#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB">モジュール</a></p>
<p><a class="admonition-anchor-link" href="neovim/lua-module.html#admonition-モジュールhttpsgithubcomwillelznvim-lua-guide-jablobmasterreadmejamdモジュール"></a></p>
</div>
<div>
<p>Luaモジュールは、runtimepath内のlua/フォルダにあります
(ほとんどの場合、*nixでは~/.config/nvim/lua、Windowsでは~/AppData/Local/nvim/luaを意味します)。</p>
<p>このフォルダにあるファイルをLuaモジュールとしてrequire()できます。</p>
</div>
</div>
<h2 id="runtimepath"><a class="header" href="#runtimepath">runtimepath</a></h2>
<p>一個ずつ見ていきますが、<code>runtimepath</code>は<code>Neovim</code>で以下のコマンドを使用することで確認できます。</p>
<div id="admonition-runtimepathを確認" class="admonition quote">
<div class="admonition-title">
<p>runtimepathを確認</p>
<p><a class="admonition-anchor-link" href="neovim/lua-module.html#admonition-runtimepathを確認"></a></p>
</div>
<div>
<pre><code class="language-lua">:lua print(vim.inspect(vim.api.nvim_list_runtime_paths()))
</code></pre>
</div>
</div>
<p><img src="neovim/img/config-create.png" alt="config-create.png" /></p>
<p>いきなりちょっと複雑でしたね😅</p>
<p>頑張ってコマンドを打つと、出力の中に <code>&quot;~/.config/nvim&quot;</code>があるはずです。<sup class="footnote-reference"><a href="#not-config">1</a></sup></p>
<p>(上の例は<code>unix</code>なので<code>&quot;/home/utm-user/.config/nvim&quot;</code>)</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/lua-module.html#admonition-note"></a></p>
</div>
<div>
<p>補足しておくと、OSによってホームディレクトリは違いますが、<code>~</code>や<code>$HOME</code>を使ってアクセスできます。</p>
</div>
</div>
<p>ここに<code>lua</code>ディレクトリを作成することで、上に示されている「ほとんどの場合」に合致できます。</p>
<div id="admonition-luaディレクトリを作る" class="admonition quote">
<div class="admonition-title">
<p>luaディレクトリを作る</p>
<p><a class="admonition-anchor-link" href="neovim/lua-module.html#admonition-luaディレクトリを作る"></a></p>
</div>
<div>
<pre><code class="language-sh">mkdir ~/.config/nvim/lua
</code></pre>
</div>
</div>
<p>あと、<code>runtimepath</code>絡みでもう一つポイントがあります。</p>
<div id="admonition-runtime-fileshttpsgithubcomwillelznvim-lua-guide-jablobmasterreadmejamdruntime-files" class="admonition info">
<div class="admonition-title">
<p><a href="https://github.com/willelz/nvim-lua-guide-ja/blob/master/README.ja.md#runtime-files">Runtime files</a></p>
<p><a class="admonition-anchor-link" href="neovim/lua-module.html#admonition-runtime-fileshttpsgithubcomwillelznvim-lua-guide-jablobmasterreadmejamdruntime-files"></a></p>
</div>
<div>
<p>runtimepath内にある特定のフォルダからLuaファイルを自動的に読み込めます。 現在、次のフォルダがサポートされています。</p>
<ul>
<li>colors/</li>
<li>compiler/</li>
<li>ftplugin/</li>
<li>ftdetect/</li>
<li>indent/</li>
<li>plugin/</li>
<li>syntax/</li>
</ul>
</div>
</div>
<p>逆に言うと、<code>lua</code>ディレクトリは自動では読み込まないぞ❗ということですね。</p>
<p><code>lua</code>ディレクトリに置いたファイルは<code>~/.config/nvim/init.lua</code>から<code>require()</code>で読み込んでいきましょう。</p>
<h2 id="require"><a class="header" href="#require">require()</a></h2>
<p><code>require()</code>は<code>WezTerm</code>でも使いましたね。</p>
<p><code>WezTerm</code>の時は<code>wezterm.lua</code> と同じディレクトリにあるファイルを読み込むことにしか使用していませんでしたが、
もうちょっと高機能です。</p>
<div id="admonition-モジュールhttpsgithubcomwillelznvim-lua-guide-jablobmasterreadmejamdモジュール-1" class="admonition info">
<div class="admonition-title">
<p><a href="https://github.com/willelz/nvim-lua-guide-ja/blob/master/README.ja.md#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB">モジュール</a></p>
<p><a class="admonition-anchor-link" href="neovim/lua-module.html#admonition-モジュールhttpsgithubcomwillelznvim-lua-guide-jablobmasterreadmejamdモジュール-1"></a></p>
</div>
<div>
<p>次のLuaコードはmyluamodule.luaをロードします。:</p>
<pre><code class="language-lua">require('myluamodule')
</code></pre>
<p>.lua拡張子がないことに注意してください。</p>
<p>同様に、other_modules/anothermodule.lua のロードは次のように行います。:</p>
<pre><code class="language-lua">require('other_modules.anothermodule')
-- or
require('other_modules/anothermodule')
</code></pre>
<p>パスの区切りはドット.またはスラッシュ/で示されます。</p>
<p>フォルダにinit.luaが含まれている場合、ファイル名を指定せずにロードできます。</p>
</div>
</div>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="neovim/lua-module.html#admonition-tip"></a></p>
</div>
<div>
<p>最後の一文は、</p>
<pre><code class="language-lua">require('example') 
</code></pre>
<p>とした場合に<code>example/init.lua</code>をロードできるよ❗ってことですね。これは<code>Neovim</code>に限ったものではなく、<code>Lua</code>の仕様みたいです。</p>
<p>全く関係ないところでやってみてもこの説明で通用するものになりました。</p>
<p><img src="neovim/img/lua-example.png" alt="lua-example.png" /></p>
</div>
</div>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/lua-module.html#admonition-note-1"></a></p>
</div>
<div>
<p>ここから先、特に明記しない限りは<code>~/.config/nvim/lua</code>または<code>~/AppData/Local/nvim/lua</code>ディレクトリを前提としていきます😌</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/lua-module.html#admonition-success"></a></p>
</div>
<div>
<p>どう？この流れ🐮</p>
<p>能書きとしてはこんな感じじゃないでしょうか。</p>
<p>これだけ分かれば、あとはもうカスタマイズを書き加えていくだけですね😄</p>
</div>
</div>
<div class="footnote-definition" id="not-config"><sup class="footnote-definition-label">1</sup>
<p><code>~/.config/nvim</code>ディレクトリが存在しないと<code>runtimepath</code>からもいなくなるようです。ディレクトリの存在を事前に確認してる?🤔
<img src="neovim/img/config-not.png" alt="config-not" /></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="options"><a class="header" href="#options">Options</a></h1>
<p>じゃあ、いつも通りのところから始めていきます☺️</p>
<p><code>lua</code>ディレクトリに<code>options.lua</code>とでもしてファイルを作成しましょう。</p>
<div id="admonition-optionsluaを作る" class="admonition quote">
<div class="admonition-title">
<p>options.luaを作る</p>
<p><a class="admonition-anchor-link" href="neovim/options/options.html#admonition-optionsluaを作る"></a></p>
</div>
<div>
<pre><code class="language-sh">nvim options.lua
</code></pre>
</div>
</div>
<p>で、<code>init.lua</code>から<code>require()</code>するんでしたね。</p>
<div id="admonition-initlua" class="admonition example">
<div class="admonition-title">
<p>../init.lua</p>
<p><a class="admonition-anchor-link" href="neovim/options/options.html#admonition-initlua"></a></p>
</div>
<div>
<pre><code class="language-lua">require 'options'
</code></pre>
</div>
</div>
<p>もうバッチリですね🤗</p>
<h2 id="help"><a class="header" href="#help">help</a></h2>
<p>これ...、超重要なやつなんで...。</p>
<p>心して...! <code>Neovim</code>のコマンドから打ってください...!!</p>
<div id="admonition-default" class="admonition quote">
<div>
<pre><code>:h help
</code></pre>
<p>もしくは</p>
<pre><code>:help help
</code></pre>
</div>
</div>
<p><img src="neovim/options/img/help.png" alt="help.png" /></p>
<p><code>help</code>のヘルプが開きましたね🤣</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/options/options.html#admonition-note"></a></p>
</div>
<div>
<p>このサイトではヘルプコマンドを<code>:h</code>で表記していきますが、好きなほうでいいです😸</p>
</div>
</div>
<p>色々書いてありますが、とりあえずはこれだけ覚えていればOK❗重要だぞ😉❤️</p>
<div id="admonition-h-help" class="admonition info">
<div class="admonition-title">
<p>:h help</p>
<p><a class="admonition-anchor-link" href="neovim/options/options.html#admonition-h-help"></a></p>
</div>
<div>
<pre><code>:h[elp]                 Open a window and display the help file in read-only mode.
                        ウィンドウを開き、ヘルプファイルを読み込み専用で表示する。

                        Type |gO| to see the table of contents.
                        目次を見るには、gO (←大文字のアルファベットO) とタイプする。

:h[elp] {subject}	Like &quot;:help&quot;, additionally jump to the tag {subject}.
                        &quot;:help&quot; と同様だが、さらに {subject} というタグにジャンプする。

                        For example:   
                            :help options

                        If there is no full match for the pattern, or there
                        are several matches, the &quot;best&quot; match will be used.
                        A sophisticated algorithm is used to decide which
                        match is better than another one.

                        パターンに完全一致するものがない場合、あるいは複数一致するものがある場合は、
                        高度なアルゴリズムによって「最も」一致すると思われるパターンが使用される。
</code></pre>
</div>
</div>
<p><code>:h</code>でヘルプのトップページ、<code>:h {subject}</code>でヘルプを検索してヒットしたタグにジャンプ。ということですね。</p>
<p>今回は後者でした。<code>help</code>タグに直接飛びましたよね。</p>
<p>閉じるときは<code>:q</code>とか<code>:bd</code>でいいんですが、頑張りすぎて ぐちゃぐちゃ になっちゃう時があるので、
併せて<code>:helpc</code>(or <code>:helpclose</code>)も覚えておくと安心です☺️</p>
<div id="admonition-h-helpc" class="admonition info">
<div class="admonition-title">
<p>:h helpc</p>
<p><a class="admonition-anchor-link" href="neovim/options/options.html#admonition-h-helpc"></a></p>
</div>
<div>
<pre><code>:helpc[lose]    Close one help window, if there is one.
			    Vim will try to restore the window layout (including
			    cursor position) to the same layout it was before
			    opening the help window initially.

                ヘルプウィンドウがある場合、それを閉じる。
                Vim は、ウィンドウのレイアウト（カーソル位置も含む）を、
                最初にヘルプウィンドウを開く前と同じレイアウトに戻そうとする。
</code></pre>
</div>
</div>
<p>ヘルプの使い方さえわかってしまえば、もうこっちのもんですね🤗</p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/options/options.html#admonition-success"></a></p>
</div>
<div>
<p>おいっ❗</p>
</div>
</div>
<div id="admonition-default-1" class="admonition success">
<div>
<p>きみは　いま❗</p>
</div>
</div>
<div id="admonition-default-2" class="admonition success">
<div>
<p>nvimちほう　への</p>
<p>だいいっぽを　ふみだした❗</p>
</div>
</div>
<div id="admonition-default-3" class="admonition success">
<div>
<p>なんだったら　タウンマップで</p>
<p>かくにんして　ごらん❗</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nvim_set_option"><a class="header" href="#nvim_set_option">nvim_set_option</a></h1>
<pre><code>あ❗　やせいの

`nvim_set_option`が　とびだしてきた❗
</code></pre>
<p>なんか始まったぁ❗というのか、まだ続いてんのぉ❓というのかわかりませんが へっちゃらです😉</p>
<p>図鑑だとどうか分かりませんが、<code>help</code>なら今までに捕まえたことのないモンスターでも既に登録されています。
なんだったらバトル中でも確認できます。わーい😆</p>
<div id="admonition-h-nvim_set_option" class="admonition info">
<div class="admonition-title">
<p>:h nvim_set_option</p>
<p><a class="admonition-anchor-link" href="neovim/options/nvim_set_option.html#admonition-h-nvim_set_option"></a></p>
</div>
<div>
<pre><code>nvim_set_option({name}, {value})            nvim_set_option()
    Sets the global value of an option.
    オプションのグローバル値を設定する。

    Parameters:  
      • {name}   Option name
      • {value}  New option value

    パラメータ  
      • {name}   オプション名
      • {value}  新しいオプションの値
</code></pre>
</div>
</div>
<p><code>nvim_set_option</code>はグローバル値を設定できるタイプのモンスターみたいですね🤔</p>
<p>次のページから野生のオプションが飛び出してきそうな気配ですが、<code>help</code>と<code>nvim_set_option</code>がいれば &quot;グローバルどうろ&quot; も歩いて行けそうですね。</p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/options/nvim_set_option.html#admonition-success"></a></p>
</div>
<div>
<p>やったー❗</p>
<p><code>nvim_set_option</code>を　つかまえたぞ❗</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="termguicolors"><a class="header" href="#termguicolors">termguicolors</a></h1>
<p>それでは前項でGETした<code>nvim_set_option()</code>を使ってカスタマイズを進めていきましょう😸</p>
<p>掲題のお名前からある程度は推測できちゃうんですが、最初なのでまあ、のほほん☺️ と。</p>
<div id="admonition-h-termguicolors" class="admonition info">
<div class="admonition-title">
<p>:h termguicolors</p>
<p><a class="admonition-anchor-link" href="neovim/options/termguicolors.html#admonition-h-termguicolors"></a></p>
</div>
<div>
<pre><code>'termguicolors' 'tgc' 'notermguicolors' 'notgc'

'termguicolors' 'tgc'	boolean (default off)
                        global

	Enables 24-bit RGB color in the |TUI|.

	|TUI|で24ビットRGBカラーを有効にする。
</code></pre>
</div>
</div>
<div id="admonition-optionslua" class="admonition example">
<div class="admonition-title">
<p>options.lua</p>
<p><a class="admonition-anchor-link" href="neovim/options/termguicolors.html#admonition-optionslua"></a></p>
</div>
<div>
<pre><code class="language-lua">vim.api.nvim_set_option('termguicolors', true)
</code></pre>
</div>
</div>
<p>「24ビットRGBカラーを有効にする<code>global</code>なオプション、<code>termguicolors</code>もしくは<code>tgc</code><sup class="footnote-reference"><a href="#1">1</a></sup>は、<code>boolean</code>値(デフォルト<code>off</code>)だよ。」ってのがなんか伝わってきますね🤔</p>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="neovim/options/termguicolors.html#admonition-warning"></a></p>
</div>
<div>
<p>すごい今さらなんですけど、ヘルプとかドキュメントとか、わたしが勝手に抜粋した上で載っけてるので、一回は手元で開いてみてください😌</p>
</div>
</div>
<p>...わたしも全ての意味を理解しているわけではないのでこの辺で切り上げちゃうんですが、</p>
<p>「24ビットRGBカラーを使いたいから<code>on</code>にしちゃえー❗」っていうのが上の設定です。</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/options/termguicolors.html#admonition-note"></a></p>
</div>
<div>
<p>そのまま素直に<code>on</code>とか<code>off</code>って書いちゃうとエラーが出て悲しいので、<code>boolean</code>(<code>true</code>か<code>false</code>)で指定してください😉</p>
</div>
</div>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="neovim/options/termguicolors.html#admonition-tip"></a></p>
</div>
<div>
<p>ヘルプの1行目にあるのはコマンドですね。</p>
<p>頭に<code>no</code>がついてるのとかはなんかすごい無効化されそうな趣ですが、これらは<code>:set</code>コマンドから使うことができます。</p>
<pre><code># 無効化
:set notgc

# 有効化
:set tgc
</code></pre>
<p>一時的に設定を変えたくなった時などに便利です。</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/options/termguicolors.html#admonition-success"></a></p>
</div>
<div>
<p>こんな感じです。簡単でしょ😆</p>
<p>しばらくはこんなのが続きます。</p>
</div>
</div>
<div id="admonition-default" class="admonition success">
<div>
<p>タマムシ　にじいろ　ゆめの　いろ<sup class="footnote-reference"><a href="#2">2</a></sup></p>
</div>
</div>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>&quot;東京ガールズコレクション&quot;❓ってなる、ウケる〜🤣 ...そうでもないかぁ😮</p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p>このページで7色使えてたら面白かったんですけど、1色足りませんでしたね...。</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h2 id="scrolloff"><a class="header" href="#scrolloff">scrolloff</a></h2>
<p>さて、次はこんなのが飛び出してきました❗もはやルーティンですね😌</p>
<div id="admonition-h-scrolloff" class="admonition info">
<div class="admonition-title">
<p>:h scrolloff</p>
<p><a class="admonition-anchor-link" href="neovim/options/scrolloff.html#admonition-h-scrolloff"></a></p>
</div>
<div>
<pre><code>'scrolloff' 'so'
'scrolloff' 'so'    number	(default 0)
	                global or local to window |global-local|

	Minimal number of screen lines to keep above and below the cursor.
	This will make some context visible around where you are working.  If
	you set it to a very large value (999) the cursor line will always be
	in the middle of the window (except at the start or end of the file or
	when long lines wrap).

	カーソルの上下に表示する最小限のスクリーンライン数。
	これにより、作業している場所の周辺にあるコンテキストを表示することができる。もし
	非常に大きな値(999)を設定すると、カーソル行は常にウィンドウの中央に位置する。
    (ファイルの先頭または末尾、あるいは長い行が折り返される場合を除く)。
</code></pre>
</div>
</div>
<div id="admonition-optionslua" class="admonition example">
<div class="admonition-title">
<p>options.lua</p>
<p><a class="admonition-anchor-link" href="neovim/options/scrolloff.html#admonition-optionslua"></a></p>
</div>
<div>
<pre><code class="language-lua">vim.api.nvim_set_option('scrolloff', 4)
</code></pre>
</div>
</div>
<p>デフォルト値<code>0</code>の場合は、画面の上下端まで行かないと行スクロールしませんが、
<code>1</code>以上を指定すると指定行数分の余裕を持って手前でスクロールします。</p>
<p>下から数えて5行目の位置から<code>4</code>行目に移動しようとすると...、
<img src="neovim/options/img/scrolloff1.png" alt="scrolloff1.png" /></p>
<p>カーソル移動ではなく、本文が<code>行スクロール</code>する。</p>
<p><img src="neovim/options/img/scrolloff2.png" alt="scrolloff2.png" /></p>
<p>文字で説明するとイメージが難しいんですが、<code>0</code>の状態と比べて動かしてみれば、すぐに意味はわかると思います😸</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/options/scrolloff.html#admonition-note"></a></p>
</div>
<div>
<p>ヘルプには「グローバルもしくはローカルのウィンドウ」みたいな記述がありますが、この例ではグローバルに設定しています。</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/options/scrolloff.html#admonition-success"></a></p>
</div>
<div>
<p>もし文法だったりパラメータが間違っていた場合は起動時にエラーが出るはずです。</p>
<p>エラーが出ていなければ多分OKなので、どんどんいきましょう😆</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ignorecase--smartcase"><a class="header" href="#ignorecase--smartcase">ignorecase / smartcase</a></h1>
<p>この2つは検索に関するオプションなのでまとめていっちゃいます😆</p>
<div id="admonition-h-ignorecase" class="admonition info">
<div class="admonition-title">
<p>:h ignorecase</p>
<p><a class="admonition-anchor-link" href="neovim/options/ignorecase-smartcase.html#admonition-h-ignorecase"></a></p>
</div>
<div>
<pre><code>7. Ignoring case in a pattern					/ignorecase

If the 'ignorecase' option is on, the case of normal letters is ignored.
'smartcase' can be set to ignore case when the pattern contains lowercase
letters only.

ignorecase' オプションがオンの場合、通常の文字の大文字小文字は無視される。
smartcase' を指定すると、パターンが小文字のみである場合に大文字小文字を無視する。

Examples:
      pattern	'ignorecase'   'smartcase'   matches  

    	foo         off		    -	    foo
	    foo	    on		    -	    foo Foo FOO
	    Foo	    on		    off	    foo Foo FOO
	    Foo	    on		    on	    Foo
	    \cfoo	    -	            -	    foo Foo FOO
	    foo\C	    -	            -	    foo
</code></pre>
</div>
</div>
<div id="admonition-h-smartcase" class="admonition info">
<div class="admonition-title">
<p>:h smartcase</p>
<p><a class="admonition-anchor-link" href="neovim/options/ignorecase-smartcase.html#admonition-h-smartcase"></a></p>
</div>
<div>
<pre><code>'smartcase' 'scs' 'nosmartcase' 'noscs'

'smartcase' 'scs' boolean (default off)
			      global

    Override the 'ignorecase' option if the search pattern contains upper
    case characters.  Only used when the search pattern is typed and
    'ignorecase' option is on. 

    検索パターンが大文字を含む場合、'ignorecase' オプションを無効にする。
    検索パターンが入力され、'ignorecase' が on の時のみ使用される。
</code></pre>
</div>
</div>
<div id="admonition-optionslua" class="admonition example">
<div class="admonition-title">
<p>options.lua</p>
<p><a class="admonition-anchor-link" href="neovim/options/ignorecase-smartcase.html#admonition-optionslua"></a></p>
</div>
<div>
<pre><code class="language-lua">vim.api.nvim_set_option('ignorecase', true)
vim.api.nvim_set_option('smartcase', true)
</code></pre>
</div>
</div>
<p>これは実際に動かしてみましょう😉 まずは以下の文章を入れてみて下さい。</p>
<div id="admonition-文章例" class="admonition abstract">
<div class="admonition-title">
<p>文章例</p>
<p><a class="admonition-anchor-link" href="neovim/options/ignorecase-smartcase.html#admonition-文章例"></a></p>
</div>
<div>
<p>She's got a ticket to ride, but she don’t care.</p>
</div>
</div>
<p>「彼女がおれのことなんて気にも留めずに行っちゃうよ！」...っていう
<a href="https://en.wikipedia.org/wiki/Ticket_to_Ride_(song)">Ticket to Ride</a>の一節です。<sup class="footnote-reference"><a href="#1">1</a></sup></p>
<p>それでは小文字だけの<code>she</code>を検索してみます。検索には<code>/</code>で入れます。</p>
<pre><code>/she
</code></pre>
<p><img src="neovim/options/img/search-she1.png" alt="search-she1" /></p>
<p><code>She</code>と<code>she</code>の2つに反応しましたね。</p>
<p>じゃあ、次は 「大文字を含む場合」の<code>She</code>でやってみましょう。</p>
<pre><code>/She
</code></pre>
<p><img src="neovim/options/img/search-she2.png" alt="search-she1" /></p>
<p><code>She</code>だけに反応しましたね。</p>
<p>要は、「大文字が含まれていれば大小区別するけど、含まれてないなら大小無視します。」っていう設定をしたんです。</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/options/ignorecase-smartcase.html#admonition-note"></a></p>
</div>
<div>
<p>ちなみに、<code>/sHe</code>と検索すると<code>sHe</code>だけに反応します。</p>
<p>先頭かどうかに関わらず「大文字を含んでいるから」っていう理屈ですね。</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/options/ignorecase-smartcase.html#admonition-success"></a></p>
</div>
<div>
<p>なんか色々難しく書いてあるので不安になりますが、動かしてみれば簡単ですね☺️</p>
</div>
</div>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>あ❗これは<a href="https://en.wikipedia.org/wiki/Help!">HELP! - The Beatles</a> の収録曲ですね❗
なんかこの辺ヘルプばっかりじゃね⁉️ってなる、ウケる〜🤣 ...そうでもないかぁ😮</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inccommand"><a class="header" href="#inccommand">inccommand</a></h1>
<p>検索の次は置換ですよね〜😆</p>
<div id="admonition-h-inccommand" class="admonition info">
<div class="admonition-title">
<p>:h inccommand</p>
<p><a class="admonition-anchor-link" href="neovim/options/inccommand.html#admonition-h-inccommand"></a></p>
</div>
<div>
<pre><code>'inccommand' 'icm'

'inccommand' 'icm'	    string	(default &quot;nosplit&quot;)
			                global

	Possible values:
		nosplit	Shows the effects of a command incrementally in the
			buffer.
		split	Like &quot;nosplit&quot;, but also shows partial off-screen
			results in a preview window.

    受け取る値
        nosplit コマンドの効果をバッファにインクリメンタルに表示する。
        split   &quot;nosplit&quot; に加えて、画面外の結果を部分的にプレビューウィンドウに表示する。
</code></pre>
</div>
</div>
<div id="admonition-optionslua" class="admonition example">
<div class="admonition-title">
<p>options.lua</p>
<p><a class="admonition-anchor-link" href="neovim/options/inccommand.html#admonition-optionslua"></a></p>
</div>
<div>
<pre><code class="language-lua">vim.api.nvim_set_option('inccommand', 'split')
</code></pre>
</div>
</div>
<p>じゃあ、また動かしてみましょう。</p>
<div id="admonition-文章例" class="admonition abstract">
<div class="admonition-title">
<p>文章例</p>
<p><a class="admonition-anchor-link" href="neovim/options/inccommand.html#admonition-文章例"></a></p>
</div>
<div>
<p>She's got a ticket to ride, but she don’t care.</p>
</div>
</div>
<p>これ Karen が歌ったら面白いんじゃない？😆 ってなるのはなんかもう必然の Richard ですので、
<code>She</code>👩を<code>He</code>👨に変えます。<sup class="footnote-reference"><a href="#1">1</a></sup></p>
<p>置換操作は<code>:%s/{検索値}/{置換値}</code>とすると実行できます。</p>
<pre><code>:%s/She/He
</code></pre>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/options/inccommand.html#admonition-note"></a></p>
</div>
<div>
<p>改めて確認してわたしも初めて知ったんですが😅</p>
<p><code>%s</code>はファイル全体を示しているそうです。<code>s</code>とするとカーソル行に絞ってできるとか。へぇ〜😮</p>
</div>
</div>
<p>画面下にプレビューウィンドウが出るようになりました。</p>
<p><img src="neovim/options/img/replace1.png" alt="replace1.png" /></p>
<p>ちょっとこれだとあんまり威力を感じられないんですが、画面に収まってない部分もプレビューできるのが強みです。</p>
<p><img src="neovim/options/img/replace2.png" alt="replace2.png" /></p>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="neovim/options/inccommand.html#admonition-tip"></a></p>
</div>
<div>
<p>下のようになってたとして、(だいぶ強引ですが) 大文字を含まない<code>she</code>でやった場合にあれれー❓ってなるの気付きます？</p>
<p><img src="neovim/options/img/replace3.png" alt="replace3.png" /></p>
<p>そうです。3行目に<code>she</code>は2つあるのに、1つ取りこぼししちゃってます😱</p>
<p>実はこのやり方だと同じ行の中では最初にヒットしたところしか反応しません。</p>
<p>こういう場合は、</p>
<pre><code>:%s/she/he/g
</code></pre>
<p>...と、<code>g</code>オプションを追加してあげると期待通りの結果が得られます。</p>
<p><img src="neovim/options/img/replace4.png" alt="replace4.png" /></p>
<p>割とあるシチュエーションだと思うので、覚えておくと役に立ちます😉</p>
</div>
</div>
<div id="admonition-question" class="admonition question">
<div class="admonition-title">
<p>Question</p>
<p><a class="admonition-anchor-link" href="neovim/options/inccommand.html#admonition-question"></a></p>
</div>
<div>
<p>本当は、あと<code>but</code>を<code>and</code>に変えるらしいです。通例なんだって。...なんで❓😮</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/options/inccommand.html#admonition-success"></a></p>
</div>
<div>
<p>なんだか本題を忘れそうになりますが...。</p>
<p>プレビューウィンドウを表示する❗がこの項の目的でした😅</p>
<p>まあ気楽にいきましょう😸</p>
</div>
</div>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="http://www.richardandkarencarpenter.com/SN_TicketToRide.htm">The Carpenters</a> の
デビュー曲は<a href="https://en.wikipedia.org/wiki/Ticket_to_Ride_(song)">Ticket to Ride</a>のアレンジでした。これが1969年のお話。
Richard が<code>vi</code>とかで歌詞置換してたらウケる〜🤣 とか思って見たら<a href="https://ja.wikipedia.org/wiki/Vi">vi</a>ですら初版が1976年...。
<code>Neovim</code>どころか<code>Vim</code>どころか、<code>vi</code>ですら意外と新しい😲 ...そうでもないかぁ😮</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="clipboard"><a class="header" href="#clipboard">ClipBoard</a></h1>
<p>そうだそうだ。大事なものを忘れていました😅</p>
<div id="admonition-h-clipboard" class="admonition info">
<div class="admonition-title">
<p>:h clipboard</p>
<p><a class="admonition-anchor-link" href="neovim/options/clipboard.html#admonition-h-clipboard"></a></p>
</div>
<div>
<pre><code>Nvim has no direct connection to the system clipboard. Instead it depends on
a |provider| which transparently uses shell commands to communicate with the
system clipboard or any other clipboard &quot;backend&quot;.

Nvim は、システムのクリップボードに直接接続することはできない。
その代わり、システムのクリップボードや他のクリップボードの「バックエンド」と
通信するためにシェルコマンドを透過的に使用するプロバイダに依存する。

To ALWAYS use the clipboard for ALL operations (instead of interacting with
the '+' and/or '*' registers explicitly):  

クリップボードを常に使用する場合 ('+' や '*' を明示的に操作する代わりに以下のようにする):

set clipboard+=unnamedplus

See 'clipboard' for details and options.

詳細とオプションについては、「クリップボード」を参照。
</code></pre>
</div>
</div>
<p>これを設定しておくとクリップボードをシステムと共有できます☺️</p>
<p>要は、クリップボードを介して<code>Neovim</code>の文字列を他のアプリケーションに持って行ったり、来たりができるんですね❗便利😆</p>
<p>上のヘルプの中で、ほぼ答えは書いてくれてるんですが、詳細 (<code>options</code>の中にある<code>clipboard</code>) も確認してみましょう。</p>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="neovim/options/clipboard.html#admonition-tip"></a></p>
</div>
<div>
<p>今回、<code>provider の clipboard</code>と、<code>options の clipboard</code>を見たいのですが、</p>
<p>単純に<code>clipboard</code>とすると前者にしか飛べません。後者のように、コマンドを探す場合は<code>'</code>で囲うと一発で飛べます。</p>
<p>...確信は無いんですけどね😅</p>
<p>この先でもいくつか出てくるので、頭の片隅にでも置いといていただければ...。</p>
</div>
</div>
<div id="admonition-h-clipboard-1" class="admonition info">
<div class="admonition-title">
<p>:h 'clipboard'</p>
<p><a class="admonition-anchor-link" href="neovim/options/clipboard.html#admonition-h-clipboard-1"></a></p>
</div>
<div>
<pre><code>'clipboard' 'cb'	string	(default &quot;&quot;)
			            global

    This option is a list of comma-separated names.

    このオプションは、カンマで区切られた名前のリストである。
</code></pre>
</div>
</div>
<p>この先はレジスタの話が出てきて自信がない...😓</p>
<details id="admonition-unnamed--unnamedplus" class="admonition info">
<summary class="admonition-title">
<p>unnamed / unnamedplus</p>
<p><a class="admonition-anchor-link" href="neovim/options/clipboard.html#admonition-unnamed--unnamedplus"></a></p>
</summary>
<div>
<pre><code>
  These names are recognized:

  これらの名前は認識される。

						                        clipboard-unnamed
	unnamed
      When included, Vim will use the clipboard register '*'
			for all yank, delete, change and put operations which
			would normally go to the unnamed register.  When a
			register is explicitly specified, it will always be
			used regardless of whether &quot;unnamed&quot; is in 'clipboard'
			or not.  The clipboard register can always be
			explicitly accessed using the &quot;* notation.  Also see
			|clipboard|.

      これを含むと、Vim は通常 unnamed レジスタに行くような yank, delete, change, put 操作に対して、
      クリップボードレジスタ '*' を使用する。
      レジスタが明示的に指定された場合、'clipboard' に unnamed が入っているかどうかに関わらず、
      常にそのレジスタが使用される。 
      クリップボードレジスタは、常に「*」表記で明示的にアクセスすることができる。

						                    clipboard-unnamedplus
	unnamedplus
      A variant of the &quot;unnamed&quot; flag which uses the
			clipboard register '+' (|quoteplus|) instead of
			register '*' for all yank, delete, change and put
			operations which would normally go to the unnamed
			register.  When &quot;unnamed&quot; is also included to the
			option, yank and delete operations (but not put)
			will additionally copy the text into register
			'*'. See |clipboard|.

      unnamed&quot; フラグの亜種で、通常 unnamed レジスタに行くはずの yank, delete, change, put 操作すべてに対して、
      レジスタ '*' の代わりにクリップボードレジスタ '+' (|quoteplus|) を使用する。

      unnamed&quot; がオプションに含まれている場合、
      yank と delete 操作 (put は不可) は、さらにテキストをレジスタ '+' にコピーする。
</code></pre>
</div>
</details>
<p>なんかもうヘルプまみれですが、ここで確認しておきたいのは<code>clipboard</code>のデフォルト値ですね。</p>
<p>これを見ると<code>&quot;&quot;</code>となっているので、特に何も気にしないで、このように書いてしまって問題ないはずです😉</p>
<div id="admonition-optionslua" class="admonition example">
<div class="admonition-title">
<p>options.lua</p>
<p><a class="admonition-anchor-link" href="neovim/options/clipboard.html#admonition-optionslua"></a></p>
</div>
<div>
<pre><code class="language-lua">vim.api.nvim_set_option('clipboard', 'unnamedplus')
</code></pre>
</div>
</div>
<p>もしヘルプに従った書き方にしたい場合は、以下のようになると思います。</p>
<pre><code class="language-lua">vim.opt.clipboard:append 'unnamedplus'
</code></pre>
<div id="admonition-h-vimoptappend" class="admonition info">
<div class="admonition-title">
<p>:h vim.opt:append()</p>
<p><a class="admonition-anchor-link" href="neovim/options/clipboard.html#admonition-h-vimoptappend"></a></p>
</div>
<div>
<pre><code>  Append a value to string-style options. See |:set+=|

  文字列スタイルのオプションに値を追加する。参照: |:set+=|
</code></pre>
</div>
</div>
<p>もしかしたら<code>API</code>を通して<code>追加</code>する方法があるのかもしれないんですが、ちょっとわたしが知らなくて...。</p>
<p>とりあえずこの書き方でも同じ動作が実現できるので、お好みで😆</p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/options/clipboard.html#admonition-success"></a></p>
</div>
<div>
<p>全体のまとめに入っちゃうんですが、</p>
<p>こんな感じでオプションを一個一個確認していくと、デフォルトのままでいいなーって思うものがほとんどなので、
(デフォルト設定は基本書かない) わたしが使っているグローバルオプションなんてこんなもんです。☺️</p>
<p>次でローカルオプションというものが出てきますが、それもやっぱりわたしが書いているものだけなら大した数じゃないです。</p>
<p>またさらにその先でプラグインとか使い出すと、もうちょっとだけ増えるんですが、それはまたその時に🤗</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nvim_win_set_option"><a class="header" href="#nvim_win_set_option">nvim_win_set_option</a></h1>
<pre><code>あ❗　やせいの

`nvim_win_set_option`が　とびだしてきた❗
</code></pre>
<p>また来ましたね、このパターン😆</p>
<div id="admonition-h-nvim_win_set_option" class="admonition info">
<div class="admonition-title">
<p>:h nvim_win_set_option</p>
<p><a class="admonition-anchor-link" href="neovim/options/nvim_win_set_option.html#admonition-h-nvim_win_set_option"></a></p>
</div>
<div>
<pre><code>nvim_win_set_option({window}, {name}, {value})          *nvim_win_set_option()*
    Sets a window option value. Passing `nil` as value deletes the option
    (only works if there's a global fallback)

    window のオプション値を設定する。value として `nil` を渡すと、そのオプションが削除される。
    (グローバルフォールバックがある場合のみ動作する)

    Parameters:  
      • {window}  Window handle, or 0 for current window
      • {name}    Option name
      • {value}   Option value

      • {window}  ウィンドウのハンドル、またはカレントウィンドウの場合は0
      • {name}    オプション名
      • {value}   新しいオプションの値
</code></pre>
</div>
</div>
<p><code>nvim_win_set_option</code>は<code>window option</code>の値を設定できるタイプのモンスターみたいですね🤔</p>
<p>本質的な説明ではありませんが、<code>Window handle</code>を<code>0</code>としておけば<code>nvim_set_option</code>と同じ感覚で使えます。</p>
<p>(逆に、これ以上の説明はわたしのレベルでは出来ない、と言うのが正直なところです😓)</p>
<p>&quot;windowすいどう&quot; は波の穏やかな海ですが、<code>nvim_win_set_option</code>さえいれば &quot;かいパンやろう&quot;🙈とかそんなの関係なく進むことができそうです。</p>
<p>...なんで &quot;かいパンやろう&quot; を避けるのかって❓いや、それは...🙊</p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/options/nvim_win_set_option.html#admonition-success"></a></p>
</div>
<div>
<p>やったー❗</p>
<p><code>nvim_win_set_option</code>を　つかまえたぞ❗</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="number"><a class="header" href="#number">number</a></h1>
<p>まず飛び出してくるのはこれですね。</p>
<div id="admonition-h-number" class="admonition info">
<div class="admonition-title">
<p>:h 'number'</p>
<p><a class="admonition-anchor-link" href="neovim/options/number.html#admonition-h-number"></a></p>
</div>
<div>
<pre><code>				                        'number' 'nu' 'nonumber' 'nonu'

'number' 'nu'	    boolean     (default off)
                    local to window

    Print the line number in front of each line.  When the 'n' option is
    excluded from 'cpoptions' a wrapped line will not use the column of
    line numbers.
    Use the 'numberwidth' option to adjust the room for the line number.
    When a long, wrapped line doesn't start with the first character, '-'
    characters are put before the number.

    各行の前に行番号を表示する。 cpoptions' で 'n' オプションが除外されている場合、折り返し行では行番号の列は使用されない。
    numberwidth' オプションを使用して、行番号を表示するスペースを調整する。
    長い折り返し行が最初の文字で始まらない場合、'-' 文字が番号の前に置かれる。

</code></pre>
</div>
</div>
<p>これもやっぱり色々書いてあるんですが、わたしがここでやりたいことは行番号の表示です。</p>
<div id="admonition-optionslua" class="admonition example">
<div class="admonition-title">
<p>options.lua</p>
<p><a class="admonition-anchor-link" href="neovim/options/number.html#admonition-optionslua"></a></p>
</div>
<div>
<pre><code>vim.api.nvim_win_set_option(0, 'number', true)
</code></pre>
</div>
</div>
<p>人によっては<code>relativenumber</code>も気に入るかもしれません。</p>
<div id="admonition-h-relativenumber" class="admonition info">
<div class="admonition-title">
<p>:h relativenumber</p>
<p><a class="admonition-anchor-link" href="neovim/options/number.html#admonition-h-relativenumber"></a></p>
</div>
<div>
<pre><code>		                                'relativenumber' 'rnu' 'norelativenumber' 'nornu'

'relativenumber' 'rnu'  boolean     (default off)
                        local to window

    Show the line number relative to the line with the cursor in front of
    each line. Relative line numbers help you use the |count| you can
    precede some vertical motion commands (e.g. j k + -) with, without
    having to calculate it yourself. 

    各行の前にカーソルを置くと、その行からの相対行番号を表示する。
    相対的な行番号は、いくつかの垂直移動コマンド (例: j k + -) の前に付けることができる |count| を、
    自分で計算することなく使用するのに役立ちます。
</code></pre>
</div>
</div>
<p><code>number</code>と<code>relativenumber</code>を組み合わせた場合の動作も説明されています。</p>
<div id="admonition-h-number_relativenumber" class="admonition info">
<div class="admonition-title">
<p>:h number_relativenumber</p>
<p><a class="admonition-anchor-link" href="neovim/options/number.html#admonition-h-number_relativenumber"></a></p>
</div>
<div>
<pre><code>    The 'relativenumber' option changes the displayed number to be
    relative to the cursor.  Together with 'number' there are these
    four combinations (cursor in line 3):

    relativenumber' オプションは、表示される数字をカーソルからの相対位置に変更する。
    'number' と共に、以下の 4 つの組み合わせがある (カーソルは 3 行目にある)。

        'nonu'          'nu'            'nonu'          'nu'
        'nornu'         'nornu'         'rnu'           'rnu'

        |apple          |  1 apple      |  2 apple      |  2 apple
        |pear           |  2 pear       |  1 pear       |  1 pear
        |nobody         |  3 nobody     |  0 nobody     |3   nobody
        |there          |  4 there      |  1 there      |  1 there
</code></pre>
</div>
</div>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="neovim/options/number.html#admonition-tip"></a></p>
</div>
<div>
<p><code>number</code>と<code>relativenumber</code>を一緒に使うと、なんかビッグウェーブ🌊が巻き起こるので、一度は乗るっきゃないです😆</p>
<p><code>:set</code>コマンドで気軽に乗れます。</p>
<pre><code>-- number と relativenumber を一度で on にする
:set nu rnu
</code></pre>
<p><img src="neovim/options/img/relativenumber.png" alt="relativenumber.png" /></p>
<p>まあ、わたしにはクセが凄くて乗りこなせないんですけどね😉</p>
<pre><code>-- relativenumber だけ切っちゃう...
:set nornu
</code></pre>
</div>
</div>
<p>で、<code>numberwidth</code>も少し気になるんですが...、わたしは入れずにそのままにしてます。</p>
<div id="admonition-h-numberwidth" class="admonition info">
<div class="admonition-title">
<p>:h numberwidth</p>
<p><a class="admonition-anchor-link" href="neovim/options/number.html#admonition-h-numberwidth"></a></p>
</div>
<div>
<pre><code>'numberwidth' 'nuw'     number      (default: 4)
                        local to window

	Minimal number of columns to use for the line number.  Only relevant
	when the 'number' or 'relativenumber' option is set or printing lines
	with a line number. Since one space is always between the number and
	the text, there is one less character for the number itself.

    行番号に使用する最小限の列数。
    number' または 'relativenumber' オプションが設定されているとき、
    あるいは行番号を持つ行を印刷するときにのみ関係する。
    番号とテキストの間には常に空白が1つ入るので、番号自体の文字数は1つ少なくなる。
</code></pre>
</div>
</div>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/options/number.html#admonition-note"></a></p>
</div>
<div>
<p>「番号とテキストの間には常に空白が1つ入る」こともあって、</p>
<p>どちらかというと、表示を詰めるというよりは拡る用途で使用するするもの、...のような気がします。</p>
</div>
</div>
<p>あと、&quot;かいパ&quot;🙊 ...じゃなくて、<code>cpoptions</code>なんですが、こいつはなんか怖いので今のところは避けておきます。</p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/options/number.html#admonition-success"></a></p>
</div>
<div>
<p>潜ろうと思えば、すっごい深く潜れるんですが、それは&quot;なみのり&quot;ではなく&quot;ダイビング&quot;という別の技が必要になるので、
今のところはぷかぷか〜☺️🦭 ってしながら行番号を眺めてます。</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cursorline"><a class="header" href="#cursorline">cursorline</a></h1>
<p>さて、続いて飛び出してきました、</p>
<div id="admonition-h-cursorline" class="admonition info">
<div class="admonition-title">
<p>:h cursorline</p>
<p><a class="admonition-anchor-link" href="neovim/options/cursorline.html#admonition-h-cursorline"></a></p>
</div>
<div>
<pre><code>			            'cursorline' 'cul' 'nocursorline' 'nocul'

'cursorline' 'cul'  boolean     (default off)
                    local to window

	Highlight the text line of the cursor with CursorLine |hl-CursorLine|.
	Useful to easily spot the cursor.  Will make screen redrawing slower.
	When Visual mode is active the highlighting isn't used to make it
	easier to see the selected text.

    CursorLine |hl-CursorLine| でカーソルのあるテキスト行を強調表示します。
    カーソルを簡単に見つけるのに便利です。 ただし、画面の再描画が遅くなります。
    ビジュアルモードがアクティブなときは、選択テキストを見やすくするためにハイライトは使用されません。
</code></pre>
</div>
</div>
<div id="admonition-optionslua" class="admonition example">
<div class="admonition-title">
<p>options.lua</p>
<p><a class="admonition-anchor-link" href="neovim/options/cursorline.html#admonition-optionslua"></a></p>
</div>
<div>
<pre><code class="language-lua">vim.api.nvim_win_set_option(0, 'cursorline', true)
</code></pre>
</div>
</div>
<p>これは動かしてみれば一目瞭然ですね😉</p>
<p>before:</p>
<p><img src="neovim/options/img/cursorline-before.png" alt="cursorline1" /></p>
<p>after:</p>
<p><img src="neovim/options/img/cursorline-after.png" alt="cursorline2" /></p>
<p>しっかりと&quot;カーソルのあるテキスト行を強調表示&quot;してますね❗</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/options/cursorline.html#admonition-note"></a></p>
</div>
<div>
<p>少し気になるのは、「画面の再描画が遅くなります」という注意書きがされていることでしょうか...。</p>
<p>わざわざ書かれているぐらいなので、想像以上に重い処理なのかもしれない...😱</p>
<p>ご自身の環境と相談の上で、使うかどうかを決めて頂ければ😺</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/options/cursorline.html#admonition-success"></a></p>
</div>
<div>
<p>とはいえ、設定自体はこれだけですね。簡単😆</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="signcolumn"><a class="header" href="#signcolumn">signcolumn</a></h1>
<p>この段階で出てこられても、ちょっと説明に困る部分もあるんですが...。</p>
<p>まあ、外観に影響する部分なので、先にやっちゃうことにします😉</p>
<div id="admonition-h-signcolumn" class="admonition note">
<div class="admonition-title">
<p>:h signcolumn</p>
<p><a class="admonition-anchor-link" href="neovim/options/signcolumn.html#admonition-h-signcolumn"></a></p>
</div>
<div>
<pre><code>						            'signcolumn' 'scl'

'signcolumn' 'scl'      string      (default &quot;auto&quot;)
			            local to window

	When and how to draw the signcolumn. Valid values are:
    記号列をどのように描画するか。有効な値は以下の通り。

	    &quot;auto&quot;   	only when there is a sign to display
                        表示する sign がある場合のみ表示する

	    &quot;auto:[1-9]&quot;    resize to accommodate multiple signs up to the
                        指定された数まで複数のサインを収容するためにリサイズする
	                    
	    &quot;auto:[1-8]-[2-9]&quot;
                        resize to accommodate multiple signs up to the
                        given maximum number (maximum 9) while keeping
                        at least the given minimum (maximum 8) fixed
                        space. The minimum number should always be less
                        than the maximum number.

                        与えられた最小値（最大8）以上の固定スペースを維持しながら、
                        与えられた最大数（最大9）までの複数のサインを収容するためにリサイズする。
                        最小数は常に最大数より小さくなければならない。

	    &quot;no&quot;	        never
                        常に表示しない

	    &quot;yes&quot;           always
                        常に表示する

	    &quot;yes:[1-9]&quot;     always, with fixed space for signs up to the given number (maximum 9)
                        常に、与えられた数（最大9）までの標識のための固定スペースを持つ

	    &quot;number&quot;        display signs in the 'number' column. If the number
			            column is not present, then behaves like &quot;auto&quot;.
                        &quot;番号&quot; の欄に column を表示する。
                        番号列が存在しない場合は、&quot;auto&quot; と同じように動作する。
</code></pre>
</div>
</div>
<p>大まかにいえば3通りがあって、</p>
<ul>
<li>
<p><code>auto</code>(デフォルト)にしておくか...、</p>
</li>
<li>
<p><code>yes</code>か<code>no</code>で決め打つか...、</p>
</li>
<li>
<p>何か独特の雰囲気を持つ<code>number</code>か...、</p>
</li>
</ul>
<p>ですね。</p>
<p><code>auto</code>は表示と非表示が動的に切り替わるので、編集中にぺこぱこすることがあります。</p>
<p>わたしは固定しちゃう方が好きです😆</p>
<div id="admonition-optionslua" class="admonition example">
<div class="admonition-title">
<p>options.lua</p>
<p><a class="admonition-anchor-link" href="neovim/options/signcolumn.html#admonition-optionslua"></a></p>
</div>
<div>
<pre><code class="language-lua">vim.api.nvim_win_set_option(0, 'signcolumn', 'yes:1')
</code></pre>
</div>
</div>
<p><img src="neovim/options/img/sign-yes.png" alt="sign-yes.png" /></p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/options/signcolumn.html#admonition-note"></a></p>
</div>
<div>
<p><code>yes:1</code>と<code>yes</code>は見た感じ同じなんですが...、んー、なんか一応😅</p>
</div>
</div>
<p><code>number</code>はこんな感じになります。</p>
<p><img src="neovim/options/img/sign-number.png" alt="sign-number.png" /></p>
<p>上のスクリーンショットでは、<code>gitsigns.nvim</code><sup class="footnote-reference"><a href="#1">1</a></sup>というプラグイン<sup class="footnote-reference"><a href="#2">2</a></sup>を使用して、変更箇所を<code>signcolumn</code>に表示しています。</p>
<p>(▶︎ とか ▎の部分がそれです。)</p>
<p><code>yes</code>と比べて違いは明らかですね😆 行番号に優先してコラムを表示してます。</p>
<p>まあこれくらいなら、なんか見た目的に面白いなーと思うんですが、
<code>Untracked file</code>とか開くと行番号が全部隠れちゃうので、やっぱクセつよですよね...。</p>
<p><img src="neovim/options/img/sign-number-untracked.png" alt="sign-number-untracked.png" /></p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/options/signcolumn.html#admonition-success"></a></p>
</div>
<div>
<p>次は、上のスクリーンショットで一足早く登場してしまった<code>wrap</code>を片付けちゃいます😌</p>
</div>
</div>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="https://github.com/lewis6991/gitsigns.nvim">https://github.com/lewis6991/gitsigns.nvim</a></p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p>プラグインについてはこのサイトでも取り上げたいんですが、もうちょっとかかりそうです😓</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wrap--colorcolumn"><a class="header" href="#wrap--colorcolumn">wrap / colorcolumn</a></h1>
<p>前回使われていたスクリーンショットの中に、こんなのが見切れていました。</p>
<div id="admonition-optionslua" class="admonition example">
<div class="admonition-title">
<p>options.lua</p>
<p><a class="admonition-anchor-link" href="neovim/options/wrap-colorcolumn.html#admonition-optionslua"></a></p>
</div>
<div>
<pre><code class="language-lua">vim.api.nvim_win_set_option(0, 'wrap', false)
</code></pre>
</div>
</div>
<p>これは今までとは違うパターンで、デフォルトで有効にされているものを無効化してます。</p>
<p>なんか &quot;かいパ&quot;🙊 ...あ、いえ、なんでもないです😅</p>
<div id="admonition-h-wrap" class="admonition info">
<div class="admonition-title">
<p>:h wrap</p>
<p><a class="admonition-anchor-link" href="neovim/options/wrap-colorcolumn.html#admonition-h-wrap"></a></p>
</div>
<div>
<pre><code>    					    'wrap' 'nowrap'

'wrap'                  boolean (default on)
                        local to window

	This option changes how text is displayed.  It doesn't change the text
	in the buffer, see 'textwidth' for that.

    このオプションは、テキストの表示方法を変更する。
    バッファ内のテキストは変更されないので、それについては 'textwidth' を参照すること。

	When on, lines longer than the width of the window will wrap and
	displaying continues on the next line.  When off lines will not wrap
	and only part of long lines will be displayed.  When the cursor is
	moved to a part that is not shown, the screen will scroll
	horizontally.

    on の場合、ウィンドウの幅より長い行は折り返され、次の行に表示される。
    off の場合、行は折り返されず、長い行の一部分のみが表示される。
    表示されていない部分にカーソルを移動すると、画面が水平方向にスクロールする。
</code></pre>
</div>
</div>
<p>ぶっちゃけこれが必要になるのって、そもそもテキストが変なんじゃないかと思うので、わたしは無効化しちゃってます🙈</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/options/wrap-colorcolumn.html#admonition-note"></a></p>
</div>
<div>
<p>無効にする場合は<code>sidescroll</code>などを変えると便利になるよ❗...と、
<code>wrap</code>のヘルプに書いてくれているので、参考にしてみると良いと思います😉</p>
<pre><code>To make scrolling horizontally a bit more useful, try this:  
		:set sidescroll=5
		:set listchars+=precedes:&lt;,extends:&gt;
See 'sidescroll', 'listchars' and |wrap-off|.
</code></pre>
<p>...わたしは今気づいたので、また今度試してみます。</p>
</div>
</div>
<p>むしろ、変なファイルを作らないためのマナーに働きかけるものとして、<code>colorcolumn</code>を活用する方がいいと思います。</p>
<div id="admonition-h-colorcolumn" class="admonition info">
<div class="admonition-title">
<p>:h colorcolumn</p>
<p><a class="admonition-anchor-link" href="neovim/options/wrap-colorcolumn.html#admonition-h-colorcolumn"></a></p>
</div>
<div>
<pre><code>						    *'colorcolumn'* *'cc'*

'colorcolumn' 'cc'          string (default &quot;&quot;)
                            local to window

    'colorcolumn' is a comma-separated list of screen columns that are highlighted with
    ColorColumn |hl-ColorColumn|. Useful to align text.  Will make screen redrawing slower.

    'colorcolumn' はColorColumn |hl-ColorColumn| でハイライトされる画面列のカンマ区切りリストです。
    テキストを整列させるのに便利。ただ、画面の再描画が遅くなる。

    The screen column can be an absolute number, or a number preceded with '+' or '-',
    which is added to or subtracted from 'textwidth'. 

    スクリーンカラムは絶対値か、'+' または '-' で始まる数値で、'textwidth' に加算または減算される。
</code></pre>
</div>
</div>
<p>使い方としてはこんなんです。</p>
<pre><code class="language-lua">vim.api.nvim_win_set_option(0, 'colorcolumn', '100')
</code></pre>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="neovim/options/wrap-colorcolumn.html#admonition-warning"></a></p>
</div>
<div>
<p>パラメータが<code>string</code>となっているところに注意🤫</p>
</div>
</div>
<p>こんな感じで100文字目の列を教えてくれます。</p>
<p><img src="neovim/options/img/colorcolumn.png" alt="colorcolumn.png" /></p>
<p>ただ、これはなんか、再描画遅くなるとも書いてあるし😅 そんなに出しとく必要ある〜❓とか思っちゃうので、</p>
<div id="admonition-有効化100文字目にハイライト" class="admonition quote">
<div class="admonition-title">
<p>有効化(100文字目にハイライト)</p>
<p><a class="admonition-anchor-link" href="neovim/options/wrap-colorcolumn.html#admonition-有効化100文字目にハイライト"></a></p>
</div>
<div>
<pre><code>:set cc=100
</code></pre>
</div>
</div>
<div id="admonition-無効化" class="admonition quote">
<div class="admonition-title">
<p>無効化</p>
<p><a class="admonition-anchor-link" href="neovim/options/wrap-colorcolumn.html#admonition-無効化"></a></p>
</div>
<div>
<pre><code>:set cc=
</code></pre>
</div>
</div>
<p>...っていう運用にしていくのもいいんじゃないかな〜、なんて思ってるんですが、どうでしょう❓</p>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/options/wrap-colorcolumn.html#admonition-note-1"></a></p>
</div>
<div>
<p>パラメータが<code>string</code>なのに、なんで</p>
<pre><code>:set cc=100
</code></pre>
<p>...でいいんだよー⁉️ってなるじゃないですか❓わたしもなってます。</p>
<p>正直この辺りの理屈、よく分かってません...😓</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/options/wrap-colorcolumn.html#admonition-success"></a></p>
</div>
<div>
<p><code>window option</code>の設定は、ひとまずここまでです🤗</p>
<p>わたしもまだ色々試している最中の<code>Neovim</code>トレーナーなので、
気まぐれに増やしたり減ったりしていくかもしれませんが、ゆる〜くお付き合いください☺️</p>
<p>ただ、ローカルオプションとしてはまだ<code>buffer</code>というものがおりまして...🐃🐃🐃</p>
<p>ぶっちゃけ自信が無いところなんですが...、まあ、その辺りも含めて、また次回😉</p>
</div>
</div>
<div id="admonition-default" class="admonition success">
<div>
<p>いけ❗　いけるかぎり　どこまでも</p>
<p>せかいを　ひろげるのは　きみじしんさ</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nvim_buf_set_option"><a class="header" href="#nvim_buf_set_option">nvim_buf_set_option</a></h1>
<pre><code>bufferリ　ゾーンに　ようこそ❗
</code></pre>
<pre><code>この　ひろい　bufferリで

いろんな　モンスター　とりほうだいの

ゲームが　たった　５００円❗
</code></pre>
<pre><code>さっそく　やりますか❓
</code></pre>
<p>...なんだかいつもと違うパターンで始まりましたが、まあ...「はい😮」</p>
<pre><code>それでは・・・❗
５００円　いただきまーす❗
</code></pre>
<pre><code>ここでは　bufferリ　せんようの
APIを　つかいます❗

・・・　これです❗
</code></pre>
<div id="admonition-h-nvim_buf_set_option" class="admonition info">
<div class="admonition-title">
<p>:h nvim_buf_set_option</p>
<p><a class="admonition-anchor-link" href="neovim/options/nvim_buf_set_option.html#admonition-h-nvim_buf_set_option"></a></p>
</div>
<div>
<pre><code>nvim_buf_set_option({buffer}, {name}, {value})          *nvim_buf_set_option()*
    Sets a buffer option value. Passing `nil` as value deletes the option
    (only works if there's a global fallback)

    buffer のオプション値を設定する。value として `nil` を渡すと、そのオプションが削除される。
    (グローバルフォールバックがある場合のみ動作する)

    Parameters:  
      • {buffer}  Buffer handle, or 0 for current buffer
                  バッファハンドル、またはカレントバッファの場合は0。

      • {name}    Option name
                  オプション名

      • {value}   Option value
                  新しいオプションの値
</code></pre>
</div>
</div>
<p><code>buffer</code>専用ではありますが、やはりこの<code>API</code>も、
これまでに捕まえてきた<code>set_option</code>系と同じ、頼れるモンスターです☺️</p>
<pre><code>のこり　じかんが　なくなるか❗

APIが　なくなったら

メガホンで　しらせます❗
</code></pre>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/options/nvim_buf_set_option.html#admonition-success"></a></p>
</div>
<div>
<p>では......❗　ぐっど　らっく❗</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tabstop--shiftwidth--expandtab"><a class="header" href="#tabstop--shiftwidth--expandtab">tabstop / shiftwidth / expandtab</a></h1>
<p>さすがは &quot;bufferリゾーン&quot; ですね😆 いきなり &quot;みつごどりモンスター&quot; が飛び出してきました❗</p>
<h2 id="tabstop"><a class="header" href="#tabstop">tabstop</a></h2>
<div id="admonition-h-tabstop" class="admonition info">
<div class="admonition-title">
<p>:h tabstop</p>
<p><a class="admonition-anchor-link" href="neovim/options/tab.html#admonition-h-tabstop"></a></p>
</div>
<div>
<pre><code>                                'tabstop' 'ts'

'tabstop' 'ts'              number (default 8)
                            local to buffer

  Number of spaces that a &lt;Tab&gt; in the file counts for.  Also see
  the |:retab| command, and the 'softtabstop' option.

  ファイル中の&lt;Tab&gt;がカウントするスペースの数。
  |:retab| コマンドと 'softtabstop' オプションも参照のこと。

  Note: Setting 'tabstop' to any other value than 8 can make your file
  appear wrong in many places, e.g., when printing it.
  The value must be more than 0 and less than 10000.

  注意: 'tabstop' を 8 以外の値に設定すると、ファイルを印刷するときなど、多くの場所で間違って表示されることがある。
  値は0以上10000以下でなければならない。

  There are four main ways to use tabs in Vim:

  Vimでタブを使うには、主に4つの方法がある。
</code></pre>
</div>
</div>
<p><code>tabstop</code>は俗に言う &quot;タブ幅&quot; です。デフォルトのまま<code>8</code>ってなってると、古いファイルのような印象を持っちゃうんですが、実際のところはどうなのかな...🤔</p>
<p>単純にタブ幅だけを設定して終わりなら話は簡単なのですが、<code>Neovim</code>の場合、この先に出てくるオプションとやや複雑に絡み合っています😓</p>
<p>そのためなのか、ヘルプ (上の抜粋に含まない部分) ではこれらを適切に設定する4つの方法が示されています。</p>
<p>わたしが採用しているのは、オーソドックスな<code>2.</code>です☺️</p>
<div id="admonition-default" class="admonition info">
<div>
<pre><code>  2. Set 'tabstop' and 'shiftwidth' to whatever you prefer and use
  'expandtab'.  This way you will always insert spaces.  The
  formatting will never be messed up when 'tabstop' is changed.
  
  'tabstop' と 'shiftwidth' を好きなように設定し、'expandtab'を使用する。
  これで、常にスペースを挿入することができる。'tabstop'を変更しても、書式が乱れることはない。
</code></pre>
</div>
</div>
<p>「<code>expandtab</code>を使用すれば、<code>tabstop</code>と<code>shiftwidth</code>は好きにしちゃっていいよー。」...と読めますね。</p>
<p>一つずつ確認していきましょう😉</p>
<h2 id="shiftwidth"><a class="header" href="#shiftwidth">shiftwidth</a></h2>
<div id="admonition-h-shiftwidth" class="admonition info">
<div class="admonition-title">
<p>:h shiftwidth</p>
<p><a class="admonition-anchor-link" href="neovim/options/tab.html#admonition-h-shiftwidth"></a></p>
</div>
<div>
<pre><code>'shiftwidth' 'sw'		  number (default 8)
			                      local to buffer

  Number of spaces to use for each step of (auto)indent.  Used for
  |'cindent'|, |&gt;&gt;|, |&lt;&lt;|, etc.
  When zero the 'ts' value will be used.  Use the |shiftwidth()|
  function to get the effective shiftwidth value.

  オートインデントの各ステップに使用するスペースの数。 |cindent’|、 |&gt;&gt;、 |&lt;&lt; などに使用される。
  ゼロの場合、'ts'の値が使用されます。 有効な shiftwidth の値を得るには |shiftwidth()| 関数を使用する。
</code></pre>
</div>
</div>
<p><code>shiftwidth</code>を &quot;zero&quot; にすれば、<code>tabstop</code>と同じ値を使ってくれるそうです。</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/options/tab.html#admonition-note"></a></p>
</div>
<div>
<p>当たり前だー❗と思われるかもしれませんが、ヘルプで &quot;zero&quot; と言っているのは、<code>number</code>型の<code>0</code>です。</p>
</div>
</div>
<h2 id="タブ幅を決める"><a class="header" href="#タブ幅を決める">タブ幅を決める</a></h2>
<p>この2つを別の値に設定して活用するシチュエーション、ちょっとわたしでは想像が及ばないので、もう<code>0</code>にしちゃいます😅</p>
<p><code>tabstop</code>の方は、&quot;好きなように設定し&quot;というお言葉に甘えて、お好みの数値を入れましょう😆</p>
<div id="admonition-optionslua" class="admonition example">
<div class="admonition-title">
<p>options.lua</p>
<p><a class="admonition-anchor-link" href="neovim/options/tab.html#admonition-optionslua"></a></p>
</div>
<div>
<pre><code class="language-lua">vim.api.nvim_buf_set_option(0, 'tabstop', 2)
vim.api.nvim_buf_set_option(0, 'shiftwidth', 0)
</code></pre>
</div>
</div>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/options/tab.html#admonition-note-1"></a></p>
</div>
<div>
<p>わたしは<code>2</code>にしていますが、<code>4</code>の方が広く使われているかもしれません。</p>
</div>
</div>
<h2 id="expandtab"><a class="header" href="#expandtab">expandtab</a></h2>
<p>その上で、&quot;<code>expandtab</code>を使用する&quot;んでしたね。</p>
<div id="admonition-optionslua-1" class="admonition example">
<div class="admonition-title">
<p>options.lua</p>
<p><a class="admonition-anchor-link" href="neovim/options/tab.html#admonition-optionslua-1"></a></p>
</div>
<div>
<pre><code class="language-lua">vim.api.nvim_buf_set_option(0, 'expandtab', true)
</code></pre>
</div>
</div>
<div id="admonition-h-expandtab" class="admonition info">
<div class="admonition-title">
<p>:h expandtab</p>
<p><a class="admonition-anchor-link" href="neovim/options/tab.html#admonition-h-expandtab"></a></p>
</div>
<div>
<pre><code>                                        'expandtab' 'et' 'noexpandtab' 'noet'

'expandtab' 'et'                    boolean (default off)
                                    local to buffer

	In Insert mode: Use the appropriate number of spaces to insert a
	&lt;Tab&gt;.  Spaces are used in indents with the '&gt;' and '&lt;' commands and
	when 'autoindent' is on.  To insert a real tab when 'expandtab' is
	on, use CTRL-V&lt;Tab&gt;.  See also |:retab| and |ins-expandtab|.

  挿入モードの場合: &lt;Tab&gt;を挿入する際に、適切な数のスペースを使用します。
  スペースは '&gt;' と '&lt;' コマンドによるインデントと 'autoindent' がオンのときに使用されます。
  expandtab' がオンの時に本当のタブを挿入するには、CTRL-V&lt;Tab&gt; を使用する。
  |:retab| と |ins-expandtab| も参照のこと。
</code></pre>
</div>
</div>
<p>このオプションが、&quot;常にスペースを挿入することができる&quot; ...の、部分を担っているんですね☺️</p>
<h3 id="autoindent"><a class="header" href="#autoindent">autoindent</a></h3>
<p>ちなみに、<code>expandtab</code>のヘルプの中に出てきた<code>autoindent</code>を少し見てみると...、</p>
<div id="admonition-h-autoindent" class="admonition info">
<div class="admonition-title">
<p>:h autoindent</p>
<p><a class="admonition-anchor-link" href="neovim/options/tab.html#admonition-h-autoindent"></a></p>
</div>
<div>
<pre><code>			                              'autoindent' 'ai' 'noautoindent' 'noai'

'autoindent' 'ai'                   boolean (default on)
			                        local to buffer

	Copy indent from current line when starting a new line (typing &lt;CR&gt;
	in Insert mode or when using the &quot;o&quot; or &quot;O&quot; command).

  改行時に現在行のインデントをコピーする
  （挿入モード、&lt;CR&gt;を入力したとき、または &quot;o&quot; や &quot;O&quot; コマンドを使用したとき）。
</code></pre>
</div>
</div>
<p>これはデフォルト<code>on</code>なので特に触らなくても平気でしょう。</p>
<p>よーし、これで全ての設定が終わったぞ❗やったね❗❗</p>
<h2 id="フィナーレ"><a class="header" href="#フィナーレ">フィナーレ...❓</a></h2>
<p>...って思うじゃないですか😮</p>
<p>実はこれだけだと、起動直後に開いたバッファでしか設定したオプションが有効になりません...。</p>
<div id="admonition-note-2" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/options/tab.html#admonition-note-2"></a></p>
</div>
<div>
<p>例えば、単純に<code>nvim</code>って起動して、そこから<code>:e abc.txt</code>とかして開いたバッファでタブを入力してみると...❓</p>
</div>
</div>
<p>どうしよー😭ってなるんですけど、泣かなくて大丈夫。解決策はちゃんとあるから🤗</p>
<pre><code>アナウンス『ピンポーン❗
じかんが　きました❗
</code></pre>
<pre><code>アナウンス『bufferリ　ゲーム
おわり　でーす❗
</code></pre>
<div id="admonition-question" class="admonition question">
<div class="admonition-title">
<p>Question</p>
<p><a class="admonition-anchor-link" href="neovim/options/tab.html#admonition-question"></a></p>
</div>
<div>
<p>入り口のおじさん、メガホンで知らせるって言ってなかった❓メガホン...なのかぁ❓</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/options/tab.html#admonition-success"></a></p>
</div>
<div>
<p><code>10. Options</code>章は...❗ なんと...❗</p>
<p>これで終わりです😮</p>
<p>ビックリするぐらい中途半端なので、すごく悩むところではあるんですが...、
でも<code>Options</code>というカテゴリでやると不自然になっちゃうんで、やっぱり思い切って章を跨いじゃいます😆</p>
<p>次回、<code>buffer</code>解決編に続く。続くったら続く...🐃🐃🐃</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="automatic-commands"><a class="header" href="#automatic-commands">Automatic commands</a></h1>
<p>さて、新章開幕です😉</p>
<p><code>10.3.1</code>節で残った問題を解決するべく、向かうのは...。</p>
<div id="admonition-h-autocmd" class="admonition info">
<div class="admonition-title">
<p>:h autocmd</p>
<p><a class="admonition-anchor-link" href="neovim/au/automatic-commands.html#admonition-h-autocmd"></a></p>
</div>
<div>
<p>You can specify commands to be executed automatically when reading or writing a file,
when entering or leaving a buffer or window, and when exiting Vim.</p>
<p>ファイルの読み書き、バッファやウィンドウへの入出時、
Vim の終了時に自動的に実行されるコマンドを指定することができる。</p>
<p>WARNING: Using autocommands is very powerful, and may lead to unexpected side effects.</p>
<p>警告：オートコマンドは非常に強力であり、使用すれば予期せぬ副作用をもたらす可能性がある。</p>
</div>
</div>
<p>やだ...、急に怖い😱</p>
<p>でも、この<code>very powerful</code>な<code>autocmd</code>と戦って勝たなければ、&quot;ヴィムバッジ&quot; は手に入りません❗</p>
<p>一人じゃ心細いところですが...大丈夫❗だってあなたは一人じゃない🤗</p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/au/automatic-commands.html#admonition-success"></a></p>
</div>
<div>
<p>おーっす❗</p>
<p>みらいの　チャンピオン❗</p>
</div>
</div>
<div id="admonition-default" class="admonition success">
<div>
<p>おれは　トレーナーじゃないが</p>
<p>アドバイスは　できるぜ❗</p>
</div>
</div>
<div id="admonition-default-1" class="admonition success">
<div>
<p>しんじろよ❗</p>
</div>
</div>
<div id="admonition-default-2" class="admonition success">
<div>
<p>しんじれば</p>
<p>チャンピオンも　ゆめ　じゃない❗</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nvim_create_autocmd"><a class="header" href="#nvim_create_autocmd">nvim_create_autocmd</a></h1>
<p>いつだっておじさんは熱くアドバイスしてくれます☺️</p>
<div id="admonition-h-nvim_create_autocmd" class="admonition info">
<div class="admonition-title">
<p>:h nvim_create_autocmd</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_autocmd.html#admonition-h-nvim_create_autocmd"></a></p>
</div>
<div>
<pre><code>nvim_create_autocmd({event}, {*opts})                   nvim_create_autocmd()
                                        Create an |autocommand|

    The API allows for two (mutually exclusive) types of actions to be
    executed when the autocommand triggers: a callback function (Lua or
    Vimscript), or a command (like regular autocommands).

    このAPIでは、オートコマンドのトリガー時に実行されるアクションとして、
    コールバック関数（LuaまたはVimscript）、またはコマンド（通常のオートコマンドと同様）の
    2種類（相互に排他的）を指定することができる。
</code></pre>
<pre><code class="language-lua">    -- Example using callback:

      local myluafun = function() print(&quot;This buffer enters&quot;) end

      vim.api.nvim_create_autocmd({&quot;BufEnter&quot;, &quot;BufWinEnter&quot;}, {
        pattern = {&quot;*.c&quot;, &quot;*.h&quot;},
        callback = myluafun,
      })
</code></pre>
</div>
</div>
<p>ヘルプではもっと色々なサンプル付きで説明されていますが、今回はここで切り上げます😅</p>
<h2 id="autocmd"><a class="header" href="#autocmd">autocmd</a></h2>
<p>現時点で<code>autocmd</code>がどのように登録されているのかは、以下のコマンドを実行してみると確認できます。</p>
<div id="admonition-quote" class="admonition quote">
<div class="admonition-title">
<p>Quote</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_autocmd.html#admonition-quote"></a></p>
</div>
<div>
<pre><code>:au
</code></pre>
<p>または</p>
<pre><code>:autocmd
</code></pre>
</div>
</div>
<p><img src="neovim/au/img/aucmd-before.png" alt="aucmd-before" /></p>
<p>こんな感じに出てきたでしょうか。</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_autocmd.html#admonition-note"></a></p>
</div>
<div>
<p>スクリーンショットの環境が突然変わったことは気にしないでください😺</p>
</div>
</div>
<p>ここに、自分で作った<code>autocmd</code>を追加して「全てのバッファに対して<code>tab</code>関連の設定をするぞ❗」というのが
この節の趣旨であり、これこそが10.3.1節の問題を解決する方法です。</p>
<p>準備はよろしいでしょうか？</p>
<p>...OK❓</p>
<p>OKね...❗</p>
<p>それでは、例によって一つずつ確認していきます。</p>
<h2 id="event"><a class="header" href="#event">event</a></h2>
<p>まずは<code>event</code>なんですが、<code>autocmd-events</code>がこれでしょう🤔</p>
<div id="admonition-h-autocmd-events" class="admonition info">
<div class="admonition-title">
<p>:h autocmd-events</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_autocmd.html#admonition-h-autocmd-events"></a></p>
</div>
<div>
<pre><code>5. Events           autocmd-events E215 E216

You can specify a comma-separated list of event names.  No white space can be
used in this list.  The command applies to all the events in the list.

イベント名のリストをカンマ区切りで指定することができる。
このリストには空白を使用できない。コマンドは、リスト内のすべてのイベントに適用される。
</code></pre>
</div>
</div>
<p>で、上の例で使用されていた<code>BufEnter</code>と<code>BufWinEnter</code>だけ抜粋すると以下です。</p>
<div id="admonition-h-bufenter" class="admonition info">
<div class="admonition-title">
<p>:h BufEnter</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_autocmd.html#admonition-h-bufenter"></a></p>
</div>
<div>
<pre><code>BufEnter        After entering a buffer.  Useful for setting
                options for a file type.  Also executed when
                starting to edit a buffer.

                バッファに入った後。
                ファイルタイプに応じたオプションを設定するのに便利。
                また、バッファの編集を開始するときにも実行される。
</code></pre>
</div>
</div>
<div id="admonition-h-bufwinenter" class="admonition info">
<div class="admonition-title">
<p>:h BufWinEnter</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_autocmd.html#admonition-h-bufwinenter"></a></p>
</div>
<div>
<pre><code>BufWinEnter     After a buffer is displayed in a window.  This
                may be when the buffer is loaded (after
                processing modelines) or when a hidden buffer
                is displayed (and is no longer hidden).

                バッファがウィンドウに表示された後。
                これは、バッファが読み込まれたとき (モデリング処理後) か、
                非表示のバッファが表示されたとき(そして非表示でなくなったとき) かもしれない。

                Not triggered for |:split| without arguments,
                since the buffer does not change, or :split
                with a file already open in a window.
                Triggered for &quot;:split&quot; with the name of the
                current buffer, since it reloads that buffer.

                引数なしの |:split| や、
                すでにウィンドウで開いているファイルとの :split では、バッファは変更されないためトリガーされない。
                現在のバッファの名前を指定した &quot;:split&quot; では、バッファを再読み込みするためトリガーが発生する。
</code></pre>
</div>
</div>
<h2 id="pattern"><a class="header" href="#pattern">pattern</a></h2>
<p>次は<code>pattern</code>です。これは<code>file-pattern</code>として説明されています😌</p>
<div id="admonition-h-file-pattern" class="admonition info">
<div class="admonition-title">
<p>:h file-pattern</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_autocmd.html#admonition-h-file-pattern"></a></p>
</div>
<div>
<pre><code>The pattern is interpreted like mostly used in file names:
このパターンは、ファイル名によく使われるものと同じように解釈される。

  *         matches any sequence of characters; Unusual: includes path separators
  ?         matches any single character
  \?        matches a '?'
  .         matches a '.'
  ~         matches a '~'
  ,         separates patterns
  \,        matches a ','
  { }       like \( \) in a |pattern|
  ,         inside { }: like \| in a |pattern|
  \}        literal }
  \{        literal {
  \\\{n,m\} like \{n,m} in a |pattern|
  \         special meaning like in a |pattern|
  [ch]      matches 'c' or 'h'
  [^ch]     match any character but 'c' and 'h'
</code></pre>
</div>
</div>
<h2 id="callback"><a class="header" href="#callback">callback</a></h2>
<p>最後に<code>callback</code>ですが、これは<code>nvim_create_autocmd</code>の中に記述が見つかります。</p>
<div id="admonition-h-nvim_create_autocmd-1" class="admonition info">
<div class="admonition-title">
<p>:h nvim_create_autocmd</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_autocmd.html#admonition-h-nvim_create_autocmd-1"></a></p>
</div>
<div>
<pre><code>Lua function which is called when this autocommand is triggered. Cannot be used with {command}.

このオートコマンドが起動した際に呼び出されるLua関数です。{コマンド}とは併用できない。
</code></pre>
</div>
</div>
<h2 id="実践"><a class="header" href="#実践">実践</a></h2>
<p>これらを踏まえて、改めて今回やりたいことを明確にすると、</p>
<ul>
<li><code>event</code>: バッファに入った際に</li>
<li><code>pattern</code>: 全てのファイル(パターン)に対して</li>
<li><code>callback</code>: <code>nvim_buf_set_option</code>を通して<code>tab</code>関連の設定をする</li>
</ul>
<p>...に、なります。</p>
<p><code>event</code>については、ヘルプ内で例示を行ってくれているので、そのまま採用します。(助かったぁ😆)</p>
<p>あとはもう、<code>pattern</code>は簡単だし、<code>callback</code>は既に書いたコードを持ってくれば良いだけですね😉</p>
<div id="admonition-optionslua" class="admonition example">
<div class="admonition-title">
<p>options.lua</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_autocmd.html#admonition-optionslua"></a></p>
</div>
<div>
<pre><code class="language-lua">vim.api.nvim_create_autocmd({ 'BufEnter', 'BufWinEnter' }, {
  pattern = '*',
  callback = function()
    -- 10.3.1 節で書いたコードをここに移動する
    vim.api.nvim_buf_set_option(0, 'tabstop', 2)
    vim.api.nvim_buf_set_option(0, 'shiftwidth', 0)
    vim.api.nvim_buf_set_option(0, 'expandtab', true)
  end,
})
</code></pre>
</div>
</div>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_autocmd.html#admonition-note-1"></a></p>
</div>
<div>
<p><code>BufWinEnter</code>が必要になるのかが判然としませんが...、どうなんだろう😅</p>
</div>
</div>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_autocmd.html#admonition-tip"></a></p>
</div>
<div>
<p><code>pattern</code>のデフォルトは<code>'*'</code>らしいので、実は省略できちゃいます😉</p>
</div>
</div>
<p>それでは、<code>nvim</code>を再起動して、もう一度<code>:au</code>を実行してみましょう...。</p>
<p><img src="neovim/au/img/aucmd-after.png" alt="aucmd-after" /></p>
<p><code>options.lua</code>に書いたイベントが登録されていることが確認できましたね❗</p>
<p>編集画面に戻って適当にタブ入力をしてみてください。タブ幅の設定は反映されていますか❓</p>
<p>...されてますよね⁉️</p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_autocmd.html#admonition-success"></a></p>
</div>
<div>
<p>ここまで来れば、とりあえずは期待する動作が得られているはずです😆</p>
<p>...、あ、えっと、&quot;とりあえず&quot; と言っているのには理由があって...。</p>
<p>でも、なんだか長くなってきたので、もう一回だけ続く...❗🙀</p>
<p>(疲れたらちゃんと休憩とってね☕)</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nvim_create_augroup"><a class="header" href="#nvim_create_augroup">nvim_create_augroup</a></h1>
<p>うん。まず何よりもはっきりさせておきたいのは、<code>au</code>というのは<code>autocmd</code>の先頭2文字からきているようですね。</p>
<p>いや、なんか...、どうしても三太郎CMを思い浮かべてしまうので...🍑</p>
<p>...え❓ わたしだけ😧⁉️ 絶対嘘だ❗</p>
<div id="admonition-h-nvim_create_augroup" class="admonition info">
<div class="admonition-title">
<p>:h nvim_create_augroup</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_augroup.html#admonition-h-nvim_create_augroup"></a></p>
</div>
<div>
<pre><code>nvim_create_augroup({name}, {*opts})                   *nvim_create_augroup()*
    Create or get an autocommand group |autocmd-groups|.
    オートコマンドグループを作成または取得する。

    Parameters:  
      • {name}  String: The name of the group
                        グループの名前

      • {opts}  Dictionary Parameters
                • clear (bool) optional: defaults to true. Clear existing
                  commands if the group already exists |autocmd-groups|.

                  デフォルトはtrue。グループが既に存在する場合、そのコマンドをクリアする。

    Return:  
        Integer id of the created group.
        作成されたグループの整数値 ID

    See also:  
        |autocmd-groups|
</code></pre>
</div>
</div>
<p><code>See also</code>って言われてるんで見ておきましょう😺</p>
<div id="admonition-h-autocmd-groups" class="admonition info">
<div class="admonition-title">
<p>:h autocmd-groups</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_augroup.html#admonition-h-autocmd-groups"></a></p>
</div>
<div>
<pre><code>Autocommands can be put together in a group. 
This is useful for removing or executing a group of autocommands.

オートコマンドは、グループとしてまとめることができる。
これは、オートコマンドのグループを削除したり実行したりするのに便利。
</code></pre>
</div>
</div>
<h2 id="augroup"><a class="header" href="#augroup">augroup</a></h2>
<p>オートコマンドは以下で確認できます。まずは現状を確認します😌</p>
<div id="admonition-quote" class="admonition quote">
<div class="admonition-title">
<p>Quote</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_augroup.html#admonition-quote"></a></p>
</div>
<div>
<pre><code>:aug
</code></pre>
<p>または</p>
<pre><code>:augroup
</code></pre>
</div>
</div>
<p><img src="neovim/au/img/augroup-before.png" alt="augroup-before.png" /></p>
<p>こんな感じですね😌</p>
<h2 id="グループid"><a class="header" href="#グループid">グループID</a></h2>
<p>それでは話を進めるんですが、さっきのヘルプ中に、コードが例示されていましたね。</p>
<div id="admonition-h-nvim_create_augroup-1" class="admonition info">
<div class="admonition-title">
<p>:h nvim_create_augroup</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_augroup.html#admonition-h-nvim_create_augroup-1"></a></p>
</div>
<div>
<pre><code>To get an existing group id, do:  
既存のグループ ID を取得するには、次のようにする。 

    local id = vim.api.nvim_create_augroup(&quot;MyGroup&quot;, {
        clear = false
    })
</code></pre>
</div>
</div>
<p>&quot;既存の&quot;って言われると、「なんで😮❓」ってなるんですけど、
&quot;オートコマンドグループを作成または取得する。&quot;という最初の文言を信じることにしましょう。<code>create_augroup</code>なんだし❗</p>
<p>パラメータは<code>name</code>には自分で決めたグループ名を、<code>opts</code>は...。更に話が長くなっちゃうんで空っぽ(デフォルト)にしときましょう。</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_augroup.html#admonition-note"></a></p>
</div>
<div>
<p><code>opts</code>は<code>clear</code>オプションを含んでいますが、
「なんでわざわざ<code>augroup</code>作らなきゃダメなの❓」っていう疑問と密接な関係がありそうです。</p>
<p>なんとな〜く察するに、「二重登録を防ぐためにある程度まとめて制御できた方がいいでしょ❓」的なことらしいんですが...、
わたしはいまひとつわかってません❗</p>
<p>ちなみに<code>clear</code>のデフォルト値は<code>true</code>なので安全は担保されてます。(意味を理解していれば、なんでしょうけどね😅)</p>
</div>
</div>
<p>ってことで、こんな感じのコードになるのかな。</p>
<p>グループの命名規則がわかりませんが、とりあえず雰囲気で...🤫</p>
<pre><code class="language-lua">local id = vim.api.nvim_create_augroup(&quot;buffer_set_options&quot;, {})
</code></pre>
<p>これを<code>nvim_create_autocmd</code>に組み込むので、もう一回ヘルプを確認します。</p>
<div id="admonition-h-nvim_create_autocmd" class="admonition info">
<div class="admonition-title">
<p>:h nvim_create_autocmd</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_augroup.html#admonition-h-nvim_create_autocmd"></a></p>
</div>
<div>
<pre><code>  • {opts} Dictionary of autocommand options:
    • group (string|integer) optional: the autocommand group name or id to match against.
      マッチするオートコマンドグループ名または ID。
</code></pre>
</div>
</div>
<p><code>nvim_create_augroup</code>が返してくれる<code>ID</code>をそのまま渡せば良さそうですね。</p>
<h2 id="実践-1"><a class="header" href="#実践-1">実践</a></h2>
<p>じゃあ、こんな感じでどうかな😆</p>
<div id="admonition-optionslua" class="admonition example">
<div class="admonition-title">
<p>options.lua</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_augroup.html#admonition-optionslua"></a></p>
</div>
<div>
<pre><code class="language-lua">-- local to buffer options:
vim.api.nvim_create_autocmd({ 'BufEnter', 'BufWinEnter' }, {
  pattern = '*',

  -- groupを追加する
  group = vim.api.nvim_create_augroup('buffer_set_options', {}),

  callback = function()
    vim.api.nvim_buf_set_option(0, 'expandtab', true)
    vim.api.nvim_buf_set_option(0, 'tabstop', 2)
    vim.api.nvim_buf_set_option(0, 'shiftwidth', 0)
  end,
})
</code></pre>
</div>
</div>
<p><img src="neovim/au/img/augroup-after.png" alt="augroup-after.png" /></p>
<p><code>buffer_set_options</code>の姿を確認できましたね❗これでもう完璧です😆</p>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_augroup.html#admonition-note-1"></a></p>
</div>
<div>
<p>実はわたし、<code>autocmd</code>とか今まで全く触ってきてなくて、ず〜っと</p>
<pre><code class="language-lua">-- なぜかうまく行く呪文 (2つ目以降のbufferもへーき)
vim.opt.tabstop = 2
</code></pre>
<p>とかして誤魔化してたんです。</p>
<p>でも、この辺りのページを作るにあたって考え直して、ようやく見栄えのするコードに辿り着けたので、なんかホッとしてます☺️</p>
<p>(...公開後に思いっきり書き直してますけどね😅 ここほんと怖い...。)</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/au/nvim_create_augroup.html#admonition-success"></a></p>
</div>
<div>
<p>つよい　トレーナーに　なったな❗</p>
</div>
</div>
<div id="admonition-default" class="admonition success">
<div>
<p>おまえが　ｎｖｉｍ　チャンピオン</p>
<p>をめざす❗　といっても</p>
</div>
</div>
<div id="admonition-default-1" class="admonition success">
<div>
<p>だれも　わらわない❗　おうえんするぜ</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="key-binding-1"><a class="header" href="#key-binding-1">Key Binding</a></h1>
<p>この章ではキーバインドに触れていきます。</p>
<p>基本的には、やり方というか、テンプレートというか、そういうことだけ書いているつもりです😉</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-note"></a></p>
</div>
<div>
<p>ある程度は実用性のある例を提示しようとすると、どうしても自分で使ってる設定が出てきちゃうんですが、
中身はそんなに気にしないでもらえればいいかなーと思ってます。</p>
<p>こんなの、ほんと個人の感覚に依るんで❗</p>
</div>
</div>
<p>ってことで、まずはやっぱりいつも通りですが、
<code>lua</code>ディレクトリに<code>keybinds.lua</code>とかなんとかでファイルを作成しておきましょう。</p>
<div id="admonition-keybindsluaを作る" class="admonition quote">
<div class="admonition-title">
<p>keybinds.luaを作る</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-keybindsluaを作る"></a></p>
</div>
<div>
<pre><code>nvim keybinds.lua
</code></pre>
</div>
</div>
<p>で、もちろん<code>init.lua</code>から読み込むように以下を追記します。</p>
<div id="admonition-initlua" class="admonition example">
<div class="admonition-title">
<p>../init.lua</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-initlua"></a></p>
</div>
<div>
<pre><code class="language-lua">require 'options'
</code></pre>
</div>
</div>
<p>変わり映えのしないルーティンですが、これが基本なので...。</p>
<p>まあ、のんびりいこーよ☺️</p>
<h2 id="keymapset"><a class="header" href="#keymapset">keymap.set()</a></h2>
<div id="admonition-h-keymapset" class="admonition info">
<div class="admonition-title">
<p>:h keymap.set</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-h-keymapset"></a></p>
</div>
<div>
<pre><code>set({mode}, {lhs}, {rhs}, {opts})                           vim.keymap.set()
    Add a new |mapping|. Examples:
    新しい|mapping|を追加します。

    Parameters:
      • {mode}  string|table Same mode short names as |nvim_set_keymap()|. Can
                also be list of modes to create mapping on multiple modes.

                |nvim_set_keymap()| と同じモードのショートネーム。
                複数のモードに対してマッピングを作成するために、モードのリストを指定することもできる。

      • {lhs}   (string) Left-hand side |{lhs}| of the mapping.
                マッピングの左辺|{lhs}|。

      • {rhs}   string|function Right-hand side |{rhs}| of the mapping. Can
                also be a Lua function.

                マッピングの右辺|{rhs}|。Luaの関数でも可。

      • {opts}  (table|nil) A table of |:map-arguments|.
                • Accepts options accepted by the {opts} parameter in
                  |nvim_set_keymap()|, with the following notable differences:
                  • replace_keycodes: Defaults to `true` if &quot;expr&quot; is `true`.
                  • noremap: Always overridden with the inverse of &quot;remap&quot; (see below).

                • In addition to those options, the table accepts the
                  following keys:
                  • buffer: (number or boolean) Add a mapping to the given
                    buffer. When `0` or `true`, use the current buffer.
                  • remap: (boolean) Make the mapping recursive. This is the
                    inverse of the &quot;noremap&quot; option from |nvim_set_keymap()|.
                    Defaults to `false`.

                • |nvim_set_keymap()| の {opts} パラメータで受け付けられるオプションを受け付けるが、以下の顕著な違いがある。
                  • replace_keycodes: replace_keycodes: &quot;expr&quot; が `true` の場合、デフォルトは `true` 。
                  • noremap: noremap: &quot;remap &quot;の逆で常にオーバーライドされる(下記参照)。

                • これらのオプションに加え、テーブルでは以下のキーを受け付ける。
                  • buffer: (number or boolean) 与えられたバッファにマッピングを追加する。
                    '0` または `true` の場合、現在のバッファを使用する。
                  • remap: (boolean) マッピングを再帰的に行う。これは |nvim_set_keymap()| の &quot;noremap&quot; オプションの逆バージョンである。
                    デフォルトは `false` 。

    See also:
        |nvim_set_keymap()|
</code></pre>
</div>
</div>
<p><code>{mode}</code>の<code>short names</code>はこっち。</p>
<div id="admonition-h-nvim_set_keymap" class="admonition info">
<div class="admonition-title">
<p>:h nvim_set_keymap</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-h-nvim_set_keymap"></a></p>
</div>
<div>
<pre><code>    Parameters:
      • {mode}  Mode short-name (map command prefix: &quot;n&quot;, &quot;i&quot;, &quot;v&quot;, &quot;x&quot;, …) or
                &quot;!&quot; for |:map!|, or empty string for |:map|.
</code></pre>
</div>
</div>
<p><a href="https://neovim.discourse.group/t/what-exactly-changed-in-nvim-get-keymap/1881">Neovim Discourse</a>の会話を盗み見た🤫感じだと、
<code>vim.keymap.set()</code>は<code>vim.api.nvim_set_keymap()</code>の<code>Syntactic sugar</code><sup class="footnote-reference"><a href="#1">1</a></sup>だと思われます。</p>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-note-1"></a></p>
</div>
<div>
<p>ここまでひたすら<code>vim.api</code>を使用してきたので、<code>vim.api.nvim_set_keymap()</code>を使用する方が統一感は出そうなんですが、記述が難しくなってしまうのは避けたい...。</p>
<p>...と、言うわけで<code>vim.keymap.set()</code>を使って行くことにします😉</p>
</div>
</div>
<h2 id="customize"><a class="header" href="#customize">Customize</a></h2>
<p>実際に動かしてみましょう☺️</p>
<p>この先に出てくる、<code>&lt;Up&gt;</code>とか<code>&lt;C-…&gt;</code>だったりの表記が、どのキーを指しているのか❓などの一覧は<code>key-notation</code>として説明されています。</p>
<div id="admonition-h-key-notation" class="admonition info">
<div class="admonition-title">
<p>:h key-notation</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-h-key-notation"></a></p>
</div>
<div>
<pre><code>					                            key-notation key-codes keycodes
These names for keys are used in the documentation.
They can also be used with the &quot;:map&quot; command.

これらのキーの名前は、ドキュメントで使用されています。
これらは &quot;:map&quot; コマンドで使用することもできます。
</code></pre>
</div>
</div>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-tip"></a></p>
</div>
<div>
<p>上のヘルプの内容とは少し離れますが、<code>:map</code>コマンドを使用すると現在のキー設定が一覧できます。</p>
<pre><code>:map
</code></pre>
<p><img src="neovim/img/keymap-before.png" alt="keymap-before.png" /></p>
</div>
</div>
<h3 id="割り当て"><a class="header" href="#割り当て">割り当て</a></h3>
<div id="admonition-keybindslua" class="admonition example">
<div class="admonition-title">
<p>keybinds.lua</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-keybindslua"></a></p>
</div>
<div>
<pre><code class="language-lua">vim.keymap.set('n', '&lt;Up&gt;', '&lt;C-y&gt;')
vim.keymap.set('n', '&lt;Down&gt;', '&lt;C-e&gt;')
</code></pre>
</div>
</div>
<p>これを記述してから再起動すると、方向キーの上下でスクロールするようになっているはずです。
(適当に2行以上入力してから試してください。)</p>
<p>上のコードが何をしているかと言うと、</p>
<pre><code>ノーマルモードの時に, &lt;上&gt;キーが入力されたら, &lt;Ctrl+y&gt;キーの操作として受け付けるぞぉ❗
ノーマルモードの時に, &lt;下&gt;キーが入力されたら, &lt;Ctrl+e&gt;キーの操作として受け付けるぞぉ❗
</code></pre>
<p>ってことですね。</p>
<p>「<code>キー操作に機能</code>を割り当てる」と言うよりは、「<code>キー操作にリンク先のキー</code>を割り当てる 」というニュアンスかもしれません。</p>
<div id="admonition-note-2" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-note-2"></a></p>
</div>
<div>
<p>ヘルプの中で、「右辺には<code>lua</code>関数でも可。」の部分に当たる「<code>キー操作に機能</code>を割り当てる」については、14章で😉</p>
</div>
</div>
<p>ここでは一度、実際に動くことを確認してもらいたかったので<code>keybinds.lua</code>のサンプルとして提示しましたが、</p>
<p>「こんな感じね〜」を掴めたら削除してもらって構いません。</p>
<p>この後は雰囲気だけ味わってもらえればいいかな〜、ぐらいで流します。軽〜く眺めてください😌</p>
<div id="admonition-note-3" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-note-3"></a></p>
</div>
<div>
<p>この先、いくつか例示はしますが、ご自身の環境に組み入れるかどうかは任意で❗</p>
</div>
</div>
<h3 id="入れ替え"><a class="header" href="#入れ替え">入れ替え</a></h3>
<p>「相互に操作を入れ替える」みたいなパターンも、たったこれだけ😸</p>
<div id="admonition-default" class="admonition quote">
<div>
<pre><code class="language-lua">vim.keymap.set('n', ';', ':')
vim.keymap.set('n', ':', ';')
</code></pre>
</div>
</div>
<p><code>:</code>は説明が長くなるので省略してしまうんですが、<code>;</code>でコマンドモードに入れるようになります。</p>
<h3 id="無効化"><a class="header" href="#無効化">無効化</a></h3>
<p>無効化するパターンもあります。</p>
<div id="admonition-default-1" class="admonition quote">
<div>
<pre><code class="language-lua">vim.keymap.set('n', 'ZZ', '&lt;NOP&gt;')
vim.keymap.set('n', 'ZQ', '&lt;NOP&gt;')
</code></pre>
</div>
</div>
<p><code>&lt;NOP&gt;</code>についてはヘルプに記載されていましたね。</p>
<div id="admonition-h-key-notation-1" class="admonition info">
<div class="admonition-title">
<p>:h key-notation</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-h-key-notation-1"></a></p>
</div>
<div>
<pre><code>&lt;NOP&gt;   no-op: do nothing (useful in mappings)	&lt;Nop&gt;
               何もしない（マッピングで有効）
</code></pre>
</div>
</div>
<p><code>ZZ</code>は保存してウィンドウを閉じる、<code>ZQ</code>は保存しないで終了、...というのがデフォルトの動作ですが、これをそれぞれ無効化しています。</p>
<p>いや、なんか...、ノーマルモードから終了なんて、急すぎて怖くないですか...😱</p>
<h3 id="モード"><a class="header" href="#モード">モード</a></h3>
<p>ここまでは全てノーマルモードでの例でしたが、もちろん他のモードでのカスタマイズもできます。</p>
<div id="admonition-default-2" class="admonition quote">
<div>
<pre><code class="language-lua">vim.keymap.set('i', 'jj', '&lt;Esc&gt;')
</code></pre>
</div>
</div>
<p>これを入れると、<code>jj</code>と連打するだけでインサートモードから抜けられるようになります。</p>
<div id="admonition-warning" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-warning"></a></p>
</div>
<div>
<p>...自分は使っておいてアレですが、使わないで済むならそれに越したことはないと思ってる設定です。</p>
<p>わたし自身はデフォルトで割り当てられている<code>&lt;Ctrl&gt;[</code>への脱却を試みてるんですが、だいぶ苦労してます...😅</p>
</div>
</div>
<p><code>{mode}</code>(第一パラメータ)をもう少し詳しく見ると、こんな感じです。</p>
<div id="admonition-h-map-table" class="admonition info">
<div class="admonition-title">
<p>:h map-table</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-h-map-table"></a></p>
</div>
<div>
<pre><code>              map-table
         Mode  | Norm | Ins | Cmd | Vis | Sel | Opr | Term | Lang |
Command        +------+-----+-----+-----+-----+-----+------+------+
[nore]map      | yes  |  -  |  -  | yes | yes | yes |  -   |  -   |
n[nore]map     | yes  |  -  |  -  |  -  |  -  |  -  |  -   |  -   |
[nore]map!     |  -   | yes | yes |  -  |  -  |  -  |  -   |  -   |
i[nore]map     |  -   | yes |  -  |  -  |  -  |  -  |  -   |  -   |
c[nore]map     |  -   |  -  | yes |  -  |  -  |  -  |  -   |  -   |
v[nore]map     |  -   |  -  |  -  | yes | yes |  -  |  -   |  -   |
x[nore]map     |  -   |  -  |  -  | yes |  -  |  -  |  -   |  -   |
s[nore]map     |  -   |  -  |  -  |  -  | yes |  -  |  -   |  -   |
o[nore]map     |  -   |  -  |  -  |  -  |  -  | yes |  -   |  -   |
t[nore]map     |  -   |  -  |  -  |  -  |  -  |  -  | yes  |  -   |
l[nore]map     |  -   | yes | yes |  -  |  -  |  -  |  -   | yes  |
</code></pre>
<p><code>Vimscript</code>準拠の表記になっていますが、先頭文字がそれぞれ<code>vim.keymap.set</code>の<code>{mode}</code>に対応しています。</p>
</div>
</div>
<p>冒頭の例で言うと、<code>'i'</code>はインサートモードを指しています。</p>
<p>また、複数のモードに対して適用するのであれば以下のようになります。</p>
<div id="admonition-default-3" class="admonition quote">
<div>
<pre><code class="language-lua">vim.keymap.set({ 'n', 'v' }, 'p', 'p`]')
</code></pre>
</div>
</div>
<p><code>{ 'n', 'v' }</code>はノーマルモードとビジュアルモードに適用する、というものになっています。</p>
<div id="admonition-note-4" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-note-4"></a></p>
</div>
<div>
<p>上の表を参照するとわかる通り、正確にはさらにセレクトモードにも適用されることになります。</p>
</div>
</div>
<h2 id="まとめ-1"><a class="header" href="#まとめ-1">まとめ</a></h2>
<p>改めて<code>:map</code>で確認してみると、こんな感じで設定した内容が反映されていることが確認できます。</p>
<p><img src="neovim/img/keymap-after.png" alt="keymap-after.png" /></p>
<div id="admonition-question" class="admonition question">
<div class="admonition-title">
<p>Question</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-question"></a></p>
</div>
<div>
<p>insert モードの内容が表示されないのは...なんで❓😮</p>
</div>
</div>
<p>キーカスタマイズに関しては、Web上で色々な人が実用的なアイデアを公開しているので、色々試してみると良いです☺️</p>
<div id="admonition-tip-1" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-tip-1"></a></p>
</div>
<div>
<p>上のスクリーンショットにも入っているんですが、これとかは結構便利です。</p>
<pre><code class="language-lua">vim.keymap.set('n', 'x', '&quot;_x')
vim.keymap.set('n', 'X', '&quot;_X')
vim.keymap.set('n', 's', '&quot;_s')
</code></pre>
<p>これらは「1文字消して〜」の操作ですが、こうすると消した文字をレジスタに入れず、純粋に文字を消すだけの動作になります。</p>
<p>...って、ちょっと紹介したい欲が出てしまった🙀</p>
</div>
</div>
<div id="admonition-warning-1" class="admonition warning">
<div class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-warning-1"></a></p>
</div>
<div>
<p>念のために明示しておくんですが、このページに挙げた例もWebなどでわたしが見たアイデアをマネしてます。</p>
<p>実際に誰をマネしているのかがもう分からなくなっているので、ちゃんと参照元を示せない点は、ごめんなさい🥹</p>
<p>「これはわたしが発案してます😆」みたいに見えちゃうのは絶対に望んでないです。</p>
</div>
</div>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/keybind.html#admonition-success"></a></p>
</div>
<div>
<p>ほんとしつこいようなんですけど、キーマップのカスタマイズは個人の感覚に依るので、根拠らしい根拠も出てこないですよね😅</p>
<p>この章では雰囲気だけ掴めれば、充分です😉</p>
<p>ただ、もう少し進むと「もう嫌❗🙀」ってなるぐらい実用的なキーカスタマイズに触れて行くことになります。</p>
</div>
</div>
<div id="admonition-default-4" class="admonition success">
<div>
<div style="text-align: center">
<p>KEYMAP WILL RETURN</p>
<p>キーマップは帰ってくる</p>
</div>
</div>
</div>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><code>Syntactic sugar</code>については <a href="https://ja.wikipedia.org/wiki/%E7%B3%96%E8%A1%A3%E6%A7%8B%E6%96%87">https://ja.wikipedia.org/wiki/糖衣構文</a> に丸投げします😃</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="leader-key-1"><a class="header" href="#leader-key-1">Leader Key</a></h1>
<p>前章でキーマップをやったので、この章では<code>Leader</code>キーを設定しておきましょう。</p>
<h2 id="nvim_set_var"><a class="header" href="#nvim_set_var">nvim_set_var</a></h2>
<p>突然ですが、ここでニューヒーローをお迎えします❗その名も<code>nvim_set_var</code>❗😆</p>
<div id="admonition-h-nvim_set_var" class="admonition info">
<div class="admonition-title">
<p>:h nvim_set_var</p>
<p><a class="admonition-anchor-link" href="neovim/leader.html#admonition-h-nvim_set_var"></a></p>
</div>
<div>
<pre><code>nvim_set_var({name}, {value})               nvim_set_var()
    Sets a global (g:) variable.

    グローバル(g:)変数を設定する。

    Parameters:  
      • {name}   Variable name
      • {value}  Variable value
</code></pre>
</div>
</div>
<p>すごくシンプル❗かぁっくいー❤️ </p>
<p>章のタイトル飾れるだけの力があるのに、なんか無理やりの登場となってしまいました😅</p>
<p>...ただ、この後も出番はかなり限られてくると思われます。</p>
<p>能力の高さゆえ、守備範囲が広大すぎて地球だけに居られない Captain Marvel<sup class="footnote-reference"><a href="#1">1</a></sup> みたいですね❗</p>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="neovim/leader.html#admonition-tip"></a></p>
</div>
<div>
<p>これは10章に入れるかどうか悩んだところですが、</p>
<pre><code class="language-lua">vim.api.nvim_set_var('loaded_python3_provider', 0)
</code></pre>
<p>のような使い方もできます。</p>
<p>(ここでは中身に触れないんですが) これから環境構築するぞー❗って時にやる設定ではないなー🤔</p>
<p>...と、思ったので登場できませんでしたが、一通り構築が終わったら改めて登場する予定です。たぶん。</p>
<p>ん⁉️ やっぱり、Endgame だろうがなんだろうが遅れてやってくる Captain Marvel みたいですね❗</p>
</div>
</div>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/leader.html#admonition-note"></a></p>
</div>
<div>
<p>これ、本題と全然関係ないけど、へぇ〜😮ってなるやつ。</p>
<p>John Lennon が &quot;The Continuing Story Of Bungalow Bill - The Beatles (White Album)&quot; の歌詞に入れてたり、</p>
<p>Disney+ の &quot;The Beatles: Get Back&quot; の中で発言してたりする「Captain Marvel」って、Shazam<sup class="footnote-reference"><a href="#2">2</a></sup> のことらしいよ😉</p>
<p>(※ このサイトでは Brie Larson のイメージだけで進んでます。)</p>
</div>
</div>
<h2 id="mapleader"><a class="header" href="#mapleader">mapleader</a></h2>
<div id="admonition-h-mapleader" class="admonition info">
<div class="admonition-title">
<p>:h mapleader</p>
<p><a class="admonition-anchor-link" href="neovim/leader.html#admonition-h-mapleader"></a></p>
</div>
<div>
<pre><code>            &lt;Leader&gt; mapleader
To define a mapping which uses the &quot;g:mapleader&quot; variable, the special string
&quot;&lt;Leader&gt;&quot; can be used.  It is replaced with the string value of
&quot;g:mapleader&quot;.  If &quot;g:mapleader&quot; is not set or empty, a backslash is used
instead.

変数 &quot;g:mapleader &quot;を使用するマッピングを定義すると、&quot;&lt;Leader&gt;&quot;という特殊な文字列を使用することができる。
これは &quot;g:mapleader &quot;の文字列値と置き換えられる。

g:mapleader &quot;が設定されていない場合や空の場合は、代わりにバックスラッシュが使われる。
</code></pre>
</div>
</div>
<p>VimScriptの書き方だと思われますが、<code>g:</code>というのが<code>global</code>で、<code>mapleader</code>が変数名ですね 🤔</p>
<p>これはなんかもう<code>nvim_set_var</code>が強すぎるので楽勝です❤️</p>
<div id="admonition-keybindslua" class="admonition example">
<div class="admonition-title">
<p>keybinds.lua</p>
<p><a class="admonition-anchor-link" href="neovim/leader.html#admonition-keybindslua"></a></p>
</div>
<div>
<pre><code class="language-lua">vim.api.nvim_set_var('mapleader', '\\')
</code></pre>
</div>
</div>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/leader.html#admonition-note-1"></a></p>
</div>
<div>
<p>例がややこしくなってしまいましたが、
1文字目の<code>\</code>は<code>エスケープシーケンス</code>として入っているものなので、<code>\</code>(2文字目) だけが設定されます。</p>
</div>
</div>
<p>上の例はデフォルトと同じ<code>\</code>になっていますが、ここを好きなキーに変えることができます。</p>
<div id="admonition-tip-1" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="neovim/leader.html#admonition-tip-1"></a></p>
</div>
<div>
<p><code>WezTerm</code>の時にも挙げましたが、メジャーなのはこの辺でしょうか😌</p>
<p>↓ スペースを入れてます。<code>:map</code>ではないからっていう理屈だと思うんだけど<code>&lt;Space&gt;</code>だとうまくいかない。</p>
<pre><code class="language-lua">vim.api.nvim_set_var('mapleader', ' ')
</code></pre>
<p>↓ メジャーなんだけど、<code>,</code>は Neovim がデフォルトで機能を割り当てていることに注意。
<code>vim.keymap.set</code>で他のキーに<code>,</code>を割り当てるなど、少し考慮が必要。</p>
<pre><code class="language-lua">vim.api.nvim_set_var('mapleader', ',')
</code></pre>
<p>↓ 2文字以上を入れても良いみたいなので、何か可能性があるような無いような。</p>
<pre><code class="language-lua">vim.api.nvim_set_var('mapleader', 'map')
</code></pre>
</div>
</div>
<p><code>Neovim</code>は単独で使用するキーを指定します。(<code>WezTerm</code>は<code>Ctrl</code>キーと同時押しするキーを指定していました。)</p>
<p>なので「<code>Space</code>キーにするとOSのショートカットと被っちゃうかもよ ❗」ということは無くなりましたが、
<code>,</code>にしちゃうと<code>Neovim</code>の中で被ってるよって話が出てきちゃってます😧</p>
<p>わたしは最近まで<code>,</code>で使用していましたが、そこまで使用頻度が高いわけでもなかったので<code>\</code>に戻しました。</p>
<p>US配列であれば、ゆーて<code>return</code>キーの上ってだけですからね😅</p>
<p>(配列は勿論、形状とかも含めて、使用するキーボードに依るので一概には言えないんですけどね。)</p>
<div id="admonition-note-2" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="neovim/leader.html#admonition-note-2"></a></p>
</div>
<div>
<p>ここで言いたいのは、「変えた方がいいよー」って人もいるんだけど、「変えてない人もいるよー」ってことです。
自由ってことです。</p>
</div>
</div>
<div id="admonition-tip-2" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="neovim/leader.html#admonition-tip-2"></a></p>
</div>
<div>
<p><code>leader</code>キーの確認はコマンドからできます。</p>
<pre><code>:echo mapleader
</code></pre>
<p><img src="neovim/img/leader.png" alt="leader.png" /></p>
<p>設定前に実行するとエラーが出てしまいますが、特に害はありません。</p>
</div>
</div>
<h2 id="maplocalleader"><a class="header" href="#maplocalleader">maplocalleader</a></h2>
<p><code>Neovim</code>には<code>Local Leader</code>というものもあります。</p>
<div id="admonition-keybindslua-1" class="admonition example">
<div class="admonition-title">
<p>keybinds.lua</p>
<p><a class="admonition-anchor-link" href="neovim/leader.html#admonition-keybindslua-1"></a></p>
</div>
<div>
<pre><code>              &lt;LocalLeader&gt; maplocalleader
&lt;LocalLeader&gt; is just like &lt;Leader&gt;, except that it uses &quot;maplocalleader&quot;
instead of &quot;mapleader&quot;.  &lt;LocalLeader&gt; is to be used for mappings which are
local to a buffer.

 &lt;LocalLeader&gt; は &lt;Leader&gt; と同じであるが、&quot;mapleader&quot; の代わりに &quot;maplocalleader&quot; を使用する点が異なる。
 &lt;LocalLeader&gt; は、バッファにローカルに存在するマッピングに使用される。

In a global plugin &lt;Leader&gt; should be used and in a filetype plugin
&lt;LocalLeader&gt;.  &quot;mapleader&quot; and &quot;maplocalleader&quot; can be equal.  Although, if
you make them different, there is a smaller chance of mappings from global
plugins to clash with mappings for filetype plugins.  For example, you could
keep &quot;mapleader&quot; at the default backslash, and set &quot;maplocalleader&quot; to an
underscore.

グローバルプラグインでは &lt;Leader&gt; を使用し、ファイル型プラグインでは&lt;LocalLeader&gt; を使用する。
&quot;mapleader&quot; と &quot;maplocalleader&quot; は同じ意味である。

しかし、別々にした方が、global プラグインのマッピングと filetype プラグインの マッピングがぶつかる可能性が低くなる。
例えば、&quot;mapleader &quot;をデフォルトのバックスラッシュのままにして、&quot;maplocalleader &quot;をアンダースコアに設定することができる。
</code></pre>
</div>
</div>
<p>こっちはなんか<code>_</code>がメジャーらしい...🤔</p>
<div id="admonition-keybindslua-2" class="admonition example">
<div class="admonition-title">
<p>keybinds.lua</p>
<p><a class="admonition-anchor-link" href="neovim/leader.html#admonition-keybindslua-2"></a></p>
</div>
<div>
<pre><code class="language-lua">vim.api.nvim_set_var('maplocalleader', '_')
</code></pre>
</div>
</div>
<p>もちろん<code>mapleader</code>と同じように、好きなキーを割り当てられます。</p>
<p>プラグインを使い出すと爆発的に機能が増えるので、補佐的に設定しておくのが良いと思います。
(単純に考えて、使えるショートカットが 2 倍に増えるので。)</p>
<p>ただ、あくまでも必須ではないです。<code>mapleader</code>と違って、こちらはデフォルトでも設定されていません。</p>
<div id="admonition-tip-3" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="neovim/leader.html#admonition-tip-3"></a></p>
</div>
<div>
<p>これもやっぱりコマンドから確認ができます。</p>
<pre><code>:echo maplocalleader
</code></pre>
<p>これも設定前に実行するとエラーが出てしまいますが、やっぱり害はありません。</p>
</div>
</div>
<h2 id="まとめ-2"><a class="header" href="#まとめ-2">まとめ</a></h2>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="neovim/leader.html#admonition-success"></a></p>
</div>
<div>
<p>あともうひとつだけ章を挟んだら、いよいよプラグインが登場します。</p>
<p>これもやっぱり「もう嫌❗🙀」ってなるぐらい<code>Leader</code>キーに触れられます。</p>
<p>...備えておきましょう❗</p>
</div>
</div>
<div id="admonition-default" class="admonition success">
<div>
<div style="text-align: center">
<p>LEADER KEY AND CAPTAIN MARVEL WILL RETURN</p>
<p>リーダーキーとキャプテン・マーベルは帰ってくる</p>
</div>
</div>
</div>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="https://ja.wikipedia.org/wiki/%E3%82%AD%E3%83%A3%E3%83%97%E3%83%86%E3%83%B3%E3%83%BB%E3%83%9E%E3%83%BC%E3%83%99%E3%83%AB_(%E3%83%9E%E3%83%BC%E3%83%99%E3%83%AB%E3%83%BB%E3%82%B3%E3%83%9F%E3%83%83%E3%82%AF)">Captain Marvel (Marvel Comics)</a></p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p><a href="https://ja.wikipedia.org/wiki/%E3%82%AD%E3%83%A3%E3%83%97%E3%83%86%E3%83%B3%E3%83%BB%E3%83%9E%E3%83%BC%E3%83%99%E3%83%AB_(DC%E3%82%B3%E3%83%9F%E3%83%83%E3%82%AF%E3%82%B9)">Captain Marvel (DC Comics)</a></p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
